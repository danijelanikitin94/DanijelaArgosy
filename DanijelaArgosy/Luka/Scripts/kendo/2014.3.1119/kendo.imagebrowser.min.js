(function(n,t){t(["./kendo.filebrowser"],n)})(function(){return function(n,t){function d(n,i){return n!==t&&n.match(/\/$/)||(n=(n||"")+"/"),n+i}function g(n){if(!n)return"";var t=" bytes";return n>=1073741824?(t=" GB",n/=1073741824):n>=1048576?(t=" MB",n/=1048576):n>=1024&&(t=" KB",n/=1024),Math.round(n*100)/100+t}var i=window.kendo,nt=i.ui.Widget,c=i.ui.FileBrowser,o=n.isPlainObject,r=n.proxy,s=n.extend,tt=i.support.placeholder,l=i.support.browser,h=i.isFunction,w=/(^\/|\/$)/g,a="error",u=".kendoImageBrowser",f="name",v="size",e="type",b={field:e,dir:"asc"},k=i.template('<li class="k-tile-empty"><strong>${text}<\/strong><\/li>'),y,p;s(!0,i.data,{schemas:{imagebrowser:{data:function(n){return n.items||n||[]},model:{id:"name",fields:{name:"name",size:"size",type:"type"}}}}});s(!0,i.data,{transports:{imagebrowser:i.data.RemoteTransport.extend({init:function(t){i.data.RemoteTransport.fn.init.call(this,n.extend(!0,{},this.options,t))},_call:function(t,r){r.data=n.extend({},r.data,{path:this.options.path()});h(this.options[t])?this.options[t].call(this,r):i.data.RemoteTransport.fn[t].call(this,r)},read:function(n){this._call("read",n)},create:function(n){this._call("create",n)},destroy:function(n){this._call("destroy",n)},update:function(){},options:{read:{type:"POST"},update:{type:"POST"},create:{type:"POST"},destroy:{type:"POST"}}})}});y=l.msie&&l.version<8?function(n){return n.offsetTop}:function(t){return t.offsetTop-n(t).height()};p=c.extend({init:function(n,t){var i=this;t=t||{};c.fn.init.call(i,n,t);i.element.addClass("k-imagebrowser")},options:{name:"ImageBrowser",fileTypes:"*.png,*.gif,*.jpg,*.jpeg"},value:function(){var r=this,u=r._selectedItem(),n,t=r.options.transport.imageUrl;if(u&&u.get(e)==="f")return n=d(r.path(),u.get(f)).replace(w,""),t&&(n=h(t)?t(n):i.format(t,encodeURIComponent(n))),n},_fileUpload:function(n){var t=this,e=t.options,o=e.fileTypes,c=new RegExp(("("+o.split(",").join(")|(")+")").replace(/\*\./g,".*."),"i"),u=n.files[0].name,s=f,h=v,r;if(c.test(u))if(n.data={path:t.path()},r=t._createFile(u),r){r._uploading=!0;t.upload.one("success",function(n){delete r._uploading;r.set(s,n.response[t._getFieldName(s)]);r.set(h,n.response[t._getFieldName(h)]);t._tiles=t.listView.items().filter("["+i.attr("type")+"=f]");t._scroll()})}else n.preventDefault();else n.preventDefault(),t._showMessage(i.format(e.messages.invalidFileType,u,o))},_content:function(){var t=this;t.list=n('<ul class="k-reset k-floats k-tiles" />').appendTo(t.element).on("scroll"+u,r(t._scroll,t)).on("dblclick"+u,"li",r(t._dblClick,t));t.listView=new i.ui.ListView(t.list,{dataSource:t.dataSource,template:t._itemTmpl(),editTemplate:t._editTmpl(),selectable:!0,autoBind:!1,dataBinding:function(n){t.toolbar.find(".k-delete").parent().addClass("k-state-disabled");(n.action==="remove"||n.action==="sync")&&n.preventDefault()},dataBound:function(){t.dataSource.view().length?(t._tiles=this.items().filter("["+i.attr("type")+"=f]"),t._scroll()):this.wrapper.append(k({text:t.options.messages.emptyFolder}))},change:r(t._listViewChange,t)})},_dataSource:function(){var n=this,u=n.options,t=u.transport,h=s({},b),c={field:f,dir:"asc"},l,e={type:t.type||"imagebrowser",sort:[h,c]};o(t)&&(t.path=r(n.path,n),e.transport=t);o(u.schema)?e.schema=u.schema:t.type&&o(i.data.schemas[t.type])&&(l=i.data.schemas[t.type]);n.dataSource&&n._errorHandler?n.dataSource.unbind(a,n._errorHandler):n._errorHandler=r(n._error,n);n.dataSource=i.data.DataSource.create(e).bind(a,n._errorHandler)},_loadImage:function(t){var e=this,c=n(t),l=e.dataSource.getByUid(c.attr(i.attr("uid"))),o=l.get(f),r=e.options.transport.thumbnailUrl,s=n("<img />",{alt:o}),a="?";if(!l._uploading){s.hide().on("load"+u,function(){n(this).prev().remove().end().addClass("k-image").fadeIn()});c.find(".k-loading").after(s);h(r)?r=r(e.path(),encodeURIComponent(o)):(r.indexOf("?")>=0&&(a="&"),r=r+a+"path="+e.path()+encodeURIComponent(o));s.attr("src",r);t.loaded=!0}},_scroll:function(){var n=this;n.options.transport&&n.options.transport.thumbnailUrl&&(clearTimeout(n._timeout),n._timeout=setTimeout(function(){var r=n.list.outerHeight(),t=n.list.scrollTop(),i=t+r;n._tiles.each(function(){var r=y(this),u=r+this.offsetHeight;return(r>=t&&r<i||u>=t&&u<i)&&n._loadImage(this),r>i?!1:void 0});n._tiles=n._tiles.filter(function(){return!this.loaded})},250))},_itemTmpl:function(){var t=this,n='<li class="k-tile" '+i.attr("uid")+'="#=uid#" ';return n+=i.attr("type")+'="${'+e+'}">',n+="#if("+e+' == "d") { #',n+='<div class="k-thumb"><span class="k-icon k-folder"><\/span><\/div>',n+="#}else{#",n+=t.options.transport&&t.options.transport.thumbnailUrl?'<div class="k-thumb"><span class="k-icon k-loading"><\/span><\/div>':'<div class="k-thumb"><span class="k-icon k-file"><\/span><\/div>',n+="#}#",n+="<strong>${"+f+"}<\/strong>",n+="#if("+e+' == "f") { # <span class="k-filesize">${this.sizeFormatter('+v+")}<\/span> #}#",n+="<\/li>",r(i.template(n),{sizeFormatter:g})}});i.ui.plugin(p)}(window.kendo.jQuery),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});
//# sourceMappingURL=kendo.imagebrowser.min.js.map
