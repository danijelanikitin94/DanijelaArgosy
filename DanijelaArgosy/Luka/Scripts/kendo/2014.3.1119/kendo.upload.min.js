(function(n,t){t(["./kendo.core"],n)})(function(){return function(n,t){function nt(t){return n.map(tt(t),function(n){return n.name}).join(", ")}function tt(n){var t=n[0];return t.files?it(t.files):[{name:at(t.value),extension:rt(t.value),size:null}]}function it(t){return n.map(t,function(n){return lt(n)})}function lt(n){var t=n.name||n.fileName;return{name:i.htmlEncode(t),extension:rt(t),size:n.size||n.fileSize,rawFile:n}}function rt(n){var t=n.match(ct);return t?t[0]:""}function at(n){var t=n.lastIndexOf("\\");return t!=-1?n.substr(t+1):n}function p(t,r){var u=i.guid();return n.map(t,function(n){return n.uid=r?i.guid():u,n})}function ut(t,i,r){if(i._supportsRemove()){var u=t.data("fileNames"),f=n.map(u,function(n){return n.name});i._submitRemove(f,r,function(n,r,f){i._removeFileEntry(t);i.trigger(l,{operation:"remove",files:u,response:n,XMLHttpRequest:f})},function(n){i.trigger(o,{operation:"remove",files:u,XMLHttpRequest:n});b("Server response: "+n.responseText)})}}function ft(t,i,r){var u=!1,f="";try{f=n.parseJSON(et(t));u=!0}catch(e){r()}u&&i(f)}function et(n){return(typeof n=="undefined"||n==="")&&(n="{}"),n}function ot(n){n.stopPropagation();n.preventDefault()}function st(n,t,i,r){var u,f;n.on("dragenter"+t,function(){i();f=new Date;u||(u=setInterval(function(){var n=new Date-f;n>100&&(r(),clearInterval(u),u=null)},100))}).on("dragover"+t,function(){f=new Date})}function ht(n){return n.is(".k-file-progress, .k-file-success, .k-file-error")}function r(t){return n(t.target).closest(".k-file")}function w(){var i={},r=n("meta[name=csrf-token]").attr("content"),u=n("meta[name=csrf-param]").attr("content");return n("input[name^='__RequestVerificationToken']").each(function(){i[this.name]=this.value}),u!==t&&r!==t&&(i[u]=r),i}var i=window.kendo,e=i.ui.Widget,b=i.logToConsole,ct=/\.([^\.]+)$/,u=".kendoUpload",h="select",c="upload",l="success",o="error",k="complete",s="cancel",d="progress",f="remove",a=e.extend({init:function(t,r){var f=this,o,s,h;e.fn.init.call(f,t,r);f.name=t.name;f.multiple=f.options.multiple;f.localization=f.options.localization;o=f.element;f.wrapper=o.closest(".k-upload");f.wrapper.length===0&&(f.wrapper=f._wrapInput(o));f._activeInput(o);f.toggle(f.options.enabled);s=f._ns=u+"-"+i.guid();o.closest("form").on("submit"+s,n.proxy(f._onParentFormSubmit,f)).on("reset"+s,n.proxy(f._onParentFormReset,f));f.options.async.saveUrl?(f._module=f._supportsFormData()?new y(f):new v(f),f._async=!0,h=f.options.files,h.length>0&&f._renderInitialFiles(h)):f._module=new g(f);f._supportsDrop()&&f._setupDropZone();f.wrapper.on("click",".k-upload-action",n.proxy(f._onFileAction,f)).on("click",".k-upload-selected",n.proxy(f._onUploadSelected,f));f.element.val()&&f._onInputChange({target:f.element})},events:[h,c,l,o,k,s,d,f],options:{name:"Upload",enabled:!0,multiple:!0,showFileList:!0,template:"",files:[],async:{removeVerb:"POST",autoUpload:!0,withCredentials:!0},localization:{select:"Select files...",cancel:"Cancel",retry:"Retry",remove:"Remove",uploadSelectedFiles:"Upload files",dropFilesHere:"drop files here to upload",statusUploading:"uploading",statusUploaded:"uploaded",statusWarning:"warning",statusFailed:"failed",headerStatusUploading:"Uploading...",headerStatusUploaded:"Done"}},setOptions:function(n){var t=this,i=t.element;e.fn.setOptions.call(t,n);t.multiple=t.options.multiple;i.attr("multiple",t._supportsMultiple()?t.multiple:!1);t.toggle(t.options.enabled)},enable:function(n){n=typeof n=="undefined"?!0:n;this.toggle(n)},disable:function(){this.toggle(!1)},toggle:function(n){n=typeof n=="undefined"?n:!n;this.wrapper.toggleClass("k-state-disabled",n);this.element.prop("disabled",n)},destroy:function(){var t=this;n(document).add(n(".k-dropzone",t.wrapper)).add(t.wrapper.closest("form")).off(t._ns);n(t.element).off(u);e.fn.destroy.call(t)},_addInput:function(t){if(t[0].nodeType){var i=this,r=t.clone().val("");r.insertAfter(i.element).data("kendoUpload",i);n(i.element).hide().attr("tabindex","-1").removeAttr("id").off(u);i._activeInput(r);i.element.focus()}},_activeInput:function(t){var i=this,r=i.wrapper;i.element=t;t.attr("multiple",i._supportsMultiple()?i.multiple:!1).attr("autocomplete","off").on("click"+u,function(n){r.hasClass("k-state-disabled")&&n.preventDefault()}).on("focus"+u,function(){n(this).parent().addClass("k-state-focused")}).on("blur"+u,function(){n(this).parent().removeClass("k-state-focused")}).on("change"+u,n.proxy(i._onInputChange,i)).on("keydown"+u,n.proxy(i._onInputKeyDown,i))},_onInputKeyDown:function(n){var r=this,t=r.wrapper.find(".k-upload-action:first");n.keyCode===i.keys.TAB&&t.length>0&&(n.preventDefault(),t.focus())},_onInputChange:function(t){var i=this,r=n(t.target),u=p(i._inputFiles(r),i._isAsyncNonBatch()),f=i.trigger(h,{files:u});if(f)i._addInput(r),r.remove();else i._module.onSelect({target:r},u)},_onDrop:function(t){var e=t.originalEvent.dataTransfer,i=this,r=e.files,u=p(it(r),i._isAsyncNonBatch()),f;if(ot(t),r.length>0&&(f=i.trigger(h,{files:u}),!f))i._module.onSelect({target:n(".k-dropzone",i.wrapper)},u)},_isAsyncNonBatch:function(){return this._async&&!this.options.async.batch||!1},_renderInitialFiles:function(t){var e=this,i=0,u,r;for(t=p(t,!0),i=0;i<t.length;i++)u=t[i],r=e._enqueueFile(u.name,{fileNames:[u]}),r.addClass("k-file-success").data("files",[t[i]]),n(".k-progress",r).width("100%"),n(".k-upload-status",r).prepend("<span class='k-upload-pct'>100%<\/span>"),e._fileAction(r,f)},_prepareTemplateData:function(n,t){for(var u=t.fileNames,i={},f=0,r=0,r=0;r<u.length;r++)f+=u[r].size;return i.name=n,i.size=f,i.files=t.fileNames,i},_prepareDefaultFileEntryTemplate:function(t,i){var r="",u=n("<li class='k-file'><span class='k-progress'><\/span><span class='k-icon'><\/span><span class='k-filename' title='"+t+"'>"+t+"<\/span><strong class='k-upload-status'><\/strong><\/li>");return i.fileNames.length!=1||!i.fileNames[0].extension||(r=i.fileNames[0].extension.substring(1),n(".k-icon",u).addClass("k-i-"+r)),u},_enqueueFile:function(t,r){var u=this,s,f,c=r.fileNames[0].uid,e=n(".k-upload-files",u.wrapper),l=u.options,o=l.template,h;if(e.length===0&&(e=n("<ul class='k-upload-files k-reset'><\/ul>").appendTo(u.wrapper),u.options.showFileList||e.hide(),u.wrapper.removeClass("k-upload-empty")),s=n(".k-file",e),o?(h=u._prepareTemplateData(t,r),o=i.template(o),f=n("<li class='k-file'>"+o(h)+"<\/li>"),f.find(".k-upload-action").addClass("k-button k-button-bare")):f=u._prepareDefaultFileEntryTemplate(t,r),f.attr(i.attr("uid"),c).appendTo(e).data(r),u._async||n(".k-progress",f).width("100%"),!u.multiple&&s.length>0)u._module.onRemove({target:n(s,u.wrapper)});return f},_removeFileEntry:function(t){var u=this,i=t.closest(".k-upload-files"),r,f;t.remove();r=n(".k-file",i);f=n(".k-file-success, .k-file-error",i);f.length===r.length&&this._hideUploadButton();r.length===0&&(i.remove(),u.wrapper.addClass("k-upload-empty"),u._hideHeaderUploadstatus())},_fileAction:function(n,t){var i={remove:"k-delete",cancel:"k-cancel",retry:"k-retry"},r={remove:"k-i-close",cancel:"k-i-close",retry:"k-i-refresh"};i.hasOwnProperty(t)&&(this._clearFileAction(n),this.options.template?n.find(".k-upload-action").addClass("k-button k-button-bare").append("<span class='k-icon "+r[t]+" "+i[t]+"' title='"+this.localization[t]+"'><\/span>").show():(n.find(".k-upload-status .k-upload-action").remove(),n.find(".k-upload-status").append(this._renderAction(i[t],this.localization[t],r[t]))))},_fileState:function(t,i){var r=this.localization,f={uploading:{text:r.statusUploading},uploaded:{text:r.statusUploaded},failed:{text:r.statusFailed}},u=f[i];u&&n(".k-icon:not(.k-delete, .k-cancel, .k-retry)",t).text(u.text)},_renderAction:function(t,i,r){return t!==""?n("<button type='button' class='k-button k-button-bare k-upload-action'><span class='k-icon "+r+" "+t+"' title='"+i+"'><\/span><\/button>"):n("<button type='button' class='k-button'>"+i+"<\/button>")},_clearFileAction:function(t){n(".k-upload-action",t).empty().hide()},_onFileAction:function(t){var i=this;if(!i.wrapper.hasClass("k-state-disabled")){var o=n(t.target).closest(".k-upload-action"),u=o.find(".k-icon"),r=o.closest(".k-file"),e={files:r.data("fileNames")};if(u.hasClass("k-delete")){if(!i.trigger(f,e))i._module.onRemove({target:n(r,i.wrapper)},e.data)}else if(u.hasClass("k-cancel")){i.trigger(s,e);i._module.onCancel({target:n(r,i.wrapper)});this._checkAllComplete();i._updateHeaderUploadStatus()}else if(u.hasClass("k-retry")){n(".k-warning",r).remove();i._module.onRetry({target:n(r,i.wrapper)})}}return!1},_onUploadSelected:function(){var n=this,t=n.wrapper;return t.hasClass("k-state-disabled")||this._module.onSaveSelected(),!1},_onFileProgress:function(t,i){var u;this.options.template?n(".k-progress",t.target).width(i+"%"):(u=n(".k-upload-pct",t.target),u.length===0&&n(".k-upload-status",t.target).prepend("<span class='k-upload-pct'><\/span>"),n(".k-upload-pct",t.target).text(i+"%"),n(".k-progress",t.target).width(i+"%"));this.trigger(d,{files:r(t).data("fileNames"),percentComplete:i})},_onUploadSuccess:function(n,t,i){var u=r(n);this._fileState(u,"uploaded");u.removeClass("k-file-progress").addClass("k-file-success");this._updateHeaderUploadStatus();this.trigger(l,{files:u.data("fileNames"),response:t,operation:"upload",XMLHttpRequest:i});this._supportsRemove()?this._fileAction(u,f):this._clearFileAction(u);this._checkAllComplete()},_onUploadError:function(t,i){var u=r(t),f=n(".k-upload-pct",u);this._fileState(u,"failed");u.removeClass("k-file-progress").addClass("k-file-error");n(".k-progress",u).width("100%");f.length>0?f.empty().removeClass("k-upload-pct").addClass("k-icon k-warning"):n(".k-upload-status",u).prepend("<span class='k-icon k-warning'><\/span>");this._updateHeaderUploadStatus();this._fileAction(u,"retry");this.trigger(o,{operation:"upload",files:u.data("fileNames"),XMLHttpRequest:i});b("Server response: "+i.responseText);this._checkAllComplete()},_showUploadButton:function(){var t=n(".k-upload-selected",this.wrapper);t.length===0&&(t=this._renderAction("",this.localization.uploadSelectedFiles).addClass("k-upload-selected"));this.wrapper.append(t)},_hideUploadButton:function(){n(".k-upload-selected",this.wrapper).remove()},_showHeaderUploadStatus:function(){var i=this.localization,r=n(".k-dropzone",this.wrapper),t=n(".k-upload-status-total",this.wrapper);t.length!==0&&t.remove();t='<strong class="k-upload-status k-upload-status-total">'+i.headerStatusUploading+'<span class="k-icon k-loading">'+i.statusUploading+"<\/span><\/strong>";r.length>0?r.append(t):n(".k-upload-button",this.wrapper).after(t)},_updateHeaderUploadStatus:function(){var t=this,u=t.localization,e=n(".k-file",t.wrapper).not(".k-file-success, .k-file-error"),i,r,f;e.length===0&&(i=n(".k-file.k-file-error",t.wrapper),r=n(".k-upload-status-total",t.wrapper),f=n(".k-icon",r).removeClass("k-loading").addClass(i.length!==0?"k-warning":"k-i-tick").text(i.length!==0?u.statusWarning:u.statusUploaded),r.text(t.localization.headerStatusUploaded).append(f))},_hideHeaderUploadstatus:function(){n(".k-upload-status-total",this.wrapper).remove()},_onParentFormSubmit:function(){var r=this,i=r.element,t;typeof this._module.onAbort!="undefined"&&this._module.onAbort();i.value||(t=n(i),t.attr("disabled","disabled"),window.setTimeout(function(){t.removeAttr("disabled")},0))},_onParentFormReset:function(){n(".k-upload-files",this.wrapper).remove()},_supportsFormData:function(){return typeof FormData!="undefined"},_supportsMultiple:function(){var n=this._userAgent().indexOf("Windows")>-1;return!i.support.browser.opera&&!(i.support.browser.safari&&n)},_supportsDrop:function(){var n=this._userAgent().toLowerCase(),t=/chrome/.test(n),i=!t&&/safari/.test(n),r=i&&/windows/.test(n);return!r&&this._supportsFormData()&&this.options.async.saveUrl},_userAgent:function(){return navigator.userAgent},_setupDropZone:function(){var r=this,i,t;n(".k-upload-button",this.wrapper).wrap("<div class='k-dropzone'><\/div>");i=r._ns;t=n(".k-dropzone",r.wrapper).append(n("<em>"+r.localization.dropFilesHere+"<\/em>")).on("dragenter"+i,ot).on("dragover"+i,function(n){n.preventDefault()}).on("drop"+i,n.proxy(this._onDrop,this));st(t,i,function(){t.addClass("k-dropzone-hovered")},function(){t.removeClass("k-dropzone-hovered")});st(n(document),i,function(){t.addClass("k-dropzone-active");t.closest(".k-upload").removeClass("k-upload-empty")},function(){t.removeClass("k-dropzone-active");n("li.k-file",t.closest(".k-upload")).length===0&&t.closest(".k-upload").addClass("k-upload-empty")})},_supportsRemove:function(){return!!this.options.async.removeUrl},_submitRemove:function(t,i,r,u){var e=this,o=e.options.async.removeField||"fileNames",f=n.extend(i,w());f[o]=t;jQuery.ajax({type:this.options.async.removeVerb,dataType:"json",dataFilter:et,url:this.options.async.removeUrl,traditional:!0,data:f,success:r,error:u})},_wrapInput:function(n){var t=this,i=t.options;return n.wrap("<div class='k-widget k-upload k-header'><div class='k-button k-upload-button'><\/div><\/div>"),i.async.saveUrl||n.closest(".k-upload").addClass("k-upload-sync"),n.closest(".k-upload").addClass("k-upload-empty"),n.closest(".k-button").append("<span>"+this.localization.select+"<\/span>"),n.closest(".k-upload")},_checkAllComplete:function(){n(".k-file.k-file-progress",this.wrapper).length===0&&this.trigger(k)},_inputFiles:function(n){return tt(n)}}),g=function(n){this.name="syncUploadModule";this.element=n.wrapper;this.upload=n;this.element.closest("form").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data")},v,y;g.prototype={onSelect:function(t,i){var r=this.upload,u=n(t.target),e;r._addInput(u);e=r._enqueueFile(nt(u),{relatedInput:u,fileNames:i});r._fileAction(e,f)},onRemove:function(n){var t=r(n);t.data("relatedInput").remove();this.upload._removeFileEntry(t)}};v=function(n){this.name="iframeUploadModule";this.element=n.wrapper;this.upload=n;this.iframes=[]};a._frameId=0;v.prototype={onSelect:function(t,i){var r=this.upload,e=n(t.target),u=this.prepareUpload(e,i);r.options.async.autoUpload?this.performUpload(u):(r._supportsRemove()&&this.upload._fileAction(u,f),r._showUploadButton())},prepareUpload:function(t,i){var r=this.upload,e=n(r.element),s=r.options.async.saveField||t.attr("name"),u,o,f;return r._addInput(t),t.attr("name",s),u=this.createFrame(r.name+"_"+a._frameId++),this.registerFrame(u),o=this.createForm(r.options.async.saveUrl,u.attr("name")).append(e),f=r._enqueueFile(nt(t),{frame:u,relatedInput:e,fileNames:i}),u.data({form:o,file:f}),f},performUpload:function(t){var u={files:t.data("fileNames")},r=t.data("frame"),i=this.upload,f,e,o;if(i.trigger(c,u))i._removeFileEntry(r.data("file")),this.cleanupFrame(r),this.unregisterFrame(r);else{i._hideUploadButton();i._showHeaderUploadStatus();r.appendTo(document.body);f=r.data("form").attr("action",i.options.async.saveUrl).appendTo(document.body);u.data=n.extend({},u.data,w());for(e in u.data)o=f.find("input[name='"+e+"']"),o.length===0&&(o=n("<input>",{type:"hidden",name:e}).prependTo(f)),o.val(u.data[e]);i._fileAction(t,s);i._fileState(t,"uploading");n(t).removeClass("k-file-error").addClass("k-file-progress");r.one("load",n.proxy(this.onIframeLoad,this));f[0].submit()}},onSaveSelected:function(){var t=this;n(".k-file",this.element).each(function(){var i=n(this),r=ht(i);r||t.performUpload(i)})},onIframeLoad:function(t){var r=n(t.target),i;try{i=r.contents().text()}catch(u){i="Error trying to get server response: "+u}this.processResponse(r,i)},processResponse:function(t,i){var f=t.data("file"),r=this,u={responseText:i};ft(i,function(i){n.extend(u,{statusText:"OK",status:"200"});r.upload._onFileProgress({target:n(f,r.upload.wrapper)},100);r.upload._onUploadSuccess({target:n(f,r.upload.wrapper)},i,u);r.cleanupFrame(t);r.unregisterFrame(t)},function(){n.extend(u,{statusText:"error",status:"500"});r.upload._onUploadError({target:n(f,r.upload.wrapper)},u)})},onCancel:function(t){var i=n(t.target).data("frame");this.stopFrameSubmit(i);this.cleanupFrame(i);this.unregisterFrame(i);this.upload._removeFileEntry(i.data("file"))},onRetry:function(n){var t=r(n);this.performUpload(t)},onRemove:function(n,t){var i=r(n),u=i.data("frame");u?(this.unregisterFrame(u),this.upload._removeFileEntry(i),this.cleanupFrame(u)):ut(i,this.upload,t)},onAbort:function(){var t=this.element,i=this;n.each(this.iframes,function(){n("input",this.data("form")).appendTo(t);i.stopFrameSubmit(this[0]);this.data("form").remove();this.remove()});this.iframes=[]},createFrame:function(t){return n("<iframe name='"+t+"' id='"+t+"' style='display:none;' />")},createForm:function(t,i){return n("<form enctype='multipart/form-data' method='POST' action='"+t+"' target='"+i+"'/>")},stopFrameSubmit:function(n){typeof n.stop!="undefined"?n.stop():n.document&&n.document.execCommand("Stop")},registerFrame:function(n){this.iframes.push(n)},unregisterFrame:function(t){this.iframes=n.grep(this.iframes,function(n){return n.attr("name")!=t.attr("name")})},cleanupFrame:function(n){var t=n.data("form");n.data("file").data("frame",null);setTimeout(function(){t.remove();n.remove()},1)}};y=function(n){this.name="formDataUploadModule";this.element=n.wrapper;this.upload=n};y.prototype={onSelect:function(t,i){var r=this.upload,u=this,e=n(t.target),o=this.prepareUpload(e,i);n.each(o,function(){r.options.async.autoUpload?u.performUpload(this):(r._supportsRemove()&&r._fileAction(this,f),r._showUploadButton())})},prepareUpload:function(t,i){var r=this.enqueueFiles(i);return t.is("input")&&(n.each(r,function(){n(this).data("relatedInput",t)}),t.data("relatedFileEntries",r),this.upload._addInput(t)),r},enqueueFiles:function(t){var e=this.upload,r,u,s=t.length,f,i,o=[];if(e.options.async.batch===!0)r=n.map(t,function(n){return n.name}).join(", "),i=e._enqueueFile(r,{fileNames:t}),i.data("files",t),o.push(i);else for(u=0;u<s;u++)f=t[u],r=f.name,i=e._enqueueFile(r,{fileNames:[f]}),i.data("files",[f]),o.push(i);return o},performUpload:function(t){var i=this.upload,u=this.createFormData(),e=this.createXHR(),r={files:t.data("fileNames"),XMLHttpRequest:e},f;if(i.trigger(c,r))this.removeFileEntry(t);else{i._fileAction(t,s);i._hideUploadButton();i._showHeaderUploadStatus();r.data=n.extend({},r.data,w());for(f in r.data)u.append(f,r.data[f]);this.populateFormData(u,t.data("files"));i._fileState(t,"uploading");n(t).removeClass("k-file-error").addClass("k-file-progress");this.postFormData(i.options.async.saveUrl,u,t,e)}},onSaveSelected:function(){var t=this;n(".k-file",this.element).each(function(){var i=n(this),r=ht(i);r||t.performUpload(i)})},onCancel:function(n){var t=r(n);this.stopUploadRequest(t);this.removeFileEntry(t)},onRetry:function(n){var t=r(n);this.performUpload(t)},onRemove:function(n,t){var i=r(n);i.hasClass("k-file-success")?ut(i,this.upload,t):this.removeFileEntry(i)},createXHR:function(){return new XMLHttpRequest},postFormData:function(n,t,i,r){var u=this;i.data("request",r);r.addEventListener("load",function(n){u.onRequestSuccess.call(u,n,i)},!1);r.addEventListener(o,function(n){u.onRequestError.call(u,n,i)},!1);r.upload.addEventListener("progress",function(n){u.onRequestProgress.call(u,n,i)},!1);r.open("POST",n,!0);r.withCredentials=this.upload.options.async.withCredentials;r.send(t)},createFormData:function(){return new FormData},populateFormData:function(n,t){for(var r=this.upload,u=t.length,i=0;i<u;i++)n.append(r.options.async.saveField||r.name,t[i].rawFile);return n},onRequestSuccess:function(t,i){function f(){r.upload._onUploadError({target:n(i,r.upload.wrapper)},u)}var u=t.target,r=this;u.status>=200&&u.status<=299?ft(u.responseText,function(t){r.upload._onFileProgress({target:n(i,r.upload.wrapper)},100);r.upload._onUploadSuccess({target:n(i,r.upload.wrapper)},t,u);r.cleanupFileEntry(i)},f):f()},onRequestError:function(t,i){var r=t.target;this.upload._onUploadError({target:n(i,this.upload.wrapper)},r)},cleanupFileEntry:function(t){var i=t.data("relatedInput"),r=!0;i&&(n.each(i.data("relatedFileEntries")||[],function(){this.parent().length>0&&this[0]!=t[0]&&(r=r&&this.hasClass("k-file-success"))}),r&&i.remove())},removeFileEntry:function(n){this.cleanupFileEntry(n);this.upload._removeFileEntry(n)},onRequestProgress:function(t,i){var r=Math.round(t.loaded*100/t.total);this.upload._onFileProgress({target:n(i,this.upload.wrapper)},r)},stopUploadRequest:function(n){n.data("request").abort()}};i.ui.plugin(a)}(window.kendo.jQuery),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});
//# sourceMappingURL=kendo.upload.min.js.map
