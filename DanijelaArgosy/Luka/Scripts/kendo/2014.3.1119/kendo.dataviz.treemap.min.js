(function(n,t){t(["./kendo.data","./kendo.userevents","./kendo.dataviz.themes"],n)})(function(){return function(n,t){function y(n,t){if(t===null)return t;var i=et(n,!0);return i(t)}function u(n){return typeof n!==ht}function at(n,t,i){var f=w(n),e=w(t),o=d(n)-d(t)<0,u=[],r,s;for(u.push(n),r=0;r<i;r++)s={r:p(f.r,e.r,r,i,o),g:p(f.g,e.g,r,i,o),b:p(f.b,e.b,r,i,o)},u.push(vt(s));return u.push(t),u}function p(n,t,i,u,f){var e=r.min(r.abs(n),r.abs(t)),o=r.max(r.abs(n),r.abs(t)),h=(o-e)/(u+1),s=h*(i+1);return f?e+s:o-s}function vt(n){return"#"+b(n.r)+b(n.g)+b(n.b)}function w(n){n=n.replace("#","");var t=yt(n);return{r:k(t.r),g:k(t.g),b:k(t.b)}}function b(n){var t=r.round(n).toString(16).toUpperCase();return t.length===1&&(t="0"+t),t}function yt(n){var i=n.length,t={};return i===3?(t.r=n[0],t.g=n[1],t.b=n[2]):(t.r=n.substring(0,2),t.g=n.substring(2,4),t.b=n.substring(4,6)),t}function k(n){return parseInt(n.toString(16),16)}function d(n){var t=0;return n&&(n=w(n),t=r.sqrt(.241*n.r*n.r+.691*n.g*n.g+.068*n.b*n.b)),t}function s(n){var t=r.pow(10,4);return r.round(n*t)/t}var r=Math,h=n.proxy,i=window.kendo,c=i.Class,e=i.ui.Widget,ft=i.template,f=i.deepExtend,g=i.data.HierarchicalDataSource,et=i.getter,l=i.dataviz,a=".kendoTreeMap",o="change",nt="dataBound",v="itemCreated",tt=Number.MAX_VALUE,pt=-Number.MAX_VALUE,ot="mouseover"+a,st="mouseleave"+a,ht="undefined",ct=e.extend({init:function(t,r){i.destroy(t);n(t).empty();e.fn.init.call(this,t,r);this._initTheme(this.options);this.element.addClass("k-widget k-treemap");this._setLayout();this._originalOptions=f({},this.options);this._initDataSource();this._attachEvents();i.notify(this,l.ui)},options:{name:"TreeMap",theme:"default",autoBind:!0,textField:"text",valueField:"value",colorField:"color"},events:[nt,v],_initTheme:function(n){var t=this,i=l.ui.themes||{},r=((n||{}).theme||"").toLowerCase(),u=(i[r]||{}).treeMap;t.options=f({},u,n)},_attachEvents:function(){this.element.on(ot,h(this._mouseover,this)).on(st,h(this._mouseleave,this))},_setLayout:function(){this.options.type==="horizontal"?(this._layout=new rt(!1),this._view=new ut(this,this.options)):this.options.type==="vertical"?(this._layout=new rt(!0),this._view=new ut(this,this.options)):(this._layout=new lt,this._view=new it(this,this.options))},_initDataSource:function(){var n=this,i=n.options,t=i.dataSource;n._dataChangeHandler=h(n._onDataChange,n);n.dataSource=g.create(t).bind(o,n._dataChangeHandler);t&&n.options.autoBind&&n.dataSource.fetch()},setDataSource:function(n){var t=this;t.dataSource.unbind(o,t._dataChangeHandler);t.dataSource=n.bind(o,t._dataChangeHandler);n&&t.options.autoBind&&t.dataSource.fetch()},_onDataChange:function(n){var s=n.node,f=n.items,c=this.options,r,t,e,i,h,o;if(s){if(f.length){for(i=this._getByUid(s.uid),i.children=[],e=u(i.minColor)||u(i.maxColor)?at(i.minColor,i.maxColor,f.length)||[]:c.colors||[],t=0;t<f.length;t++)r=f[t],i.children.push(this._wrapItem(r));for(h=this._view.htmlSize(i),this._layout.compute(i.children,i.coord,h),t=0;t<i.children.length;t++)r=i.children[t],u(r.color)||(typeof e[0]=="string"?r.color=e[t%e.length]:(o=e[t%e.length],o&&(r.color=o[0],r.minColor=o[0],r.maxColor=o[1])));this._view.render(i)}}else this.element.empty(),r=this._wrapItem(f[0]),this._layout.createRoot(r,this.element.outerWidth(),this.element.outerHeight(),this.options.type==="vertical"),this._view.createRoot(r),this._root=r;for(t=0;t<f.length;t++)f[t].load();s&&this.trigger(nt,{node:s})},_contentSize:function(n){this.view.renderHeight(n)},_wrapItem:function(n){var t={};return u(this.options.valueField)&&(t.value=y(this.options.valueField,n)),u(this.options.colorField)&&(t.color=y(this.options.colorField,n)),u(this.options.textField)&&(t.text=y(this.options.textField,n)),t.level=n.level(),t.dataItem=n,t},_getByUid:function(n){for(var i=[this._root],t;i.length;){if(t=i.pop(),t.dataItem.uid===n)return t;t.children&&(i=i.concat(t.children))}},dataItem:function(t){var u=n(t).attr(i.attr("uid")),r=this.dataSource;return r&&r.getByUid(u)},findByUid:function(n){return this.element.find(".k-treemap-tile["+i.attr("uid")+"='"+n+"']")},_mouseover:function(t){var i=n(t.target);i.hasClass("k-leaf")&&(this._removeActiveState(),i.removeClass("k-state-hover").addClass("k-state-hover"))},_removeActiveState:function(){this.element.find(".k-state-hover").removeClass("k-state-hover")},_mouseleave:function(){this._removeActiveState()},destroy:function(){e.fn.destroy.call(this);this.element.off(a);this.dataSource&&this.dataSource.unbind(o,this._dataChangeHandler);this._root=null;i.destroy(this.element)},items:function(){return n()},getSize:function(){return i.dimensions(this.element)},_resize:function(){this.dataSource.fetch()},setOptions:function(n){var i=n.dataSource;n.dataSource=t;this._originalOptions=f(this._originalOptions,n);this.options=f({},this._originalOptions);this._setLayout();this._initTheme(this.options);e.fn._setEvents.call(this,n);i&&this.setDataSource(g.create(i));this.options.autoBind&&this.dataSource.fetch()}}),lt=c.extend({createRoot:function(n,t,i){n.coord={width:t,height:i,top:0,left:0}},leaf:function(n){return!n.children},layoutChildren:function(n,t){for(var h=t.width*t.height,f=0,u=[],e,o,s,r=0;r<n.length;r++)u[r]=parseFloat(n[r].value),f+=u[r];for(r=0;r<u.length;r++)n[r].area=h*u[r]/f;e=this.layoutHorizontal()?t.height:t.width;n=new i.data.Query(n)._sortForGrouping("value","desc");o=[n[0]];s=n.slice(1);this.squarify(s,o,e,t)},squarify:function(n,t,i,r){this.computeDim(n,t,i,r)},computeDim:function(n,t,i,r){var e,u,f;if(n.length+t.length==1){e=n.length==1?n:t;this.layoutLast(e,i,r);return}if(n.length>=2&&t.length===0&&(t=[n[0]],n=n.slice(1)),n.length===0){t.length>0&&this.layoutRow(t,i,r);return}u=n[0];this.worstAspectRatio(t,i)>=this.worstAspectRatio([u].concat(t),i)?this.computeDim(n.slice(1),t.concat([u]),i,r):(f=this.layoutRow(t,i,r),this.computeDim(n,[],f.dim,f))},layoutLast:function(n,t,i){n[0].coord=i},layoutRow:function(n,t,i){return this.layoutHorizontal()?this.layoutV(n,t,i):this.layoutH(n,t,i)},orientation:"h",layoutVertical:function(){return this.orientation==="v"},layoutHorizontal:function(){return this.orientation==="h"},layoutChange:function(){this.orientation=this.layoutVertical()?"h":"v"},worstAspectRatio:function(n,t){var o,i;if(!n||n.length===0)return tt;var u=0,f=0,e=tt;for(o=0;o<n.length;o++)i=n[o].area,u+=i,e=e<i?e:i,f=f>i?f:i;return r.max(t*t*f/(u*u),u*u/(t*t*e))},compute:function(n,t,i){if(t.width>=t.height&&this.layoutHorizontal()||this.layoutChange(),n&&n.length>0){var r={width:t.width,height:t.height-i.text,top:0,left:0};this.layoutChildren(n,r)}},layoutV:function(n,t,i){var h=this._totalArea(n),o=0,f,e,u;for(t=s(h/t),f=0;f<n.length;f++)e=s(n[f].area/t),n[f].coord={height:e,width:t,top:i.top+o,left:i.left},o+=e;return u={height:i.height,width:i.width-t,top:i.top,left:i.left+t},u.dim=r.min(u.width,u.height),u.dim!=u.height&&this.layoutChange(),u},layoutH:function(n,t,i){for(var u,h=this._totalArea(n),e=s(h/t),c=i.top,o=0,f=0;f<n.length;f++)n[f].coord={height:e,width:s(n[f].area/e),top:c,left:i.left+o},o+=n[f].coord.width;return u={height:i.height-e,width:i.width,top:i.top+e,left:i.left},u.dim=r.min(u.width,u.height),u.dim!=u.width&&this.layoutChange(),u},_totalArea:function(n){for(var i=0,t=0;t<n.length;t++)i+=n[t].area;return i}}),it=c.extend({init:function(t,i){this.options=f({},this.options,i);this.treeMap=t;this.element=n(t.element);this.offset=0},htmlSize:function(n){var t=this._getByUid(n.dataItem.uid),r={text:0},u,i;return n.children&&(this._clean(t),u=this._getText(n),u&&(i=this._createTitle(n),t.append(i),r.text=i.height()),t.append(this._createWrap()),this.offset=(t.outerWidth()-t.innerWidth())/2),r},_getByUid:function(n){return this.element.find(".k-treemap-tile["+i.attr("uid")+"='"+n+"']")},render:function(n){var e=this._getByUid(n.dataItem.uid),i=n.children,u,t,f,r;if(i)for(u=e.find(".k-treemap-wrap"),t=0;t<i.length;t++)f=i[t],r=this._createLeaf(f),u.append(r),this.treeMap.trigger(v,{element:r})},createRoot:function(n){var t=this._createLeaf(n);this.element.append(t);this.treeMap.trigger(v,{element:t})},_clean:function(n){n.css("background-color","");n.removeClass("k-leaf");n.removeClass("k-inverse");n.empty()},_createLeaf:function(t){return this._createTile(t).css("background-color",t.color).addClass("k-leaf").toggleClass("k-inverse",this._tileColorBrightness(t)>180).append(n("<div><\/div>").html(this._getText(t)))},_createTile:function(t){var r={width:t.coord.width,height:t.coord.height,left:t.coord.left,top:t.coord.top},f;return r.width+=r.left&&this.offset?this.offset*2:this.offset,r.height+=r.top?this.offset*2:this.offset,f=n("<div class='k-treemap-tile'><\/div>").css({width:r.width,height:r.height,left:r.left,top:r.top}),u(t.dataItem)&&u(t.dataItem.uid)&&f.attr(i.attr("uid"),t.dataItem.uid),f},_getText:function(n){var t=n.text;return this.options.template&&(t=this._renderTemplate(n)),t},_renderTemplate:function(n){var t=ft(this.options.template);return t({dataItem:n.dataItem,text:n.text})},_createTitle:function(t){return n("<div class='k-treemap-title'><\/div>").append(n("<div><\/div>").html(this._getText(t)))},_createWrap:function(){return n("<div class='k-treemap-wrap'><\/div>")},_tileColorBrightness:function(n){return d(n.color)}}),rt=c.extend({createRoot:function(n,t,i,r){n.coord={width:t,height:i,top:0,left:0};n.vertical=r},init:function(n){this.vertical=n;this.quotient=n?1:0},compute:function(n,t,i){var r,u,f;n.length>0&&(r=t.width,u=t.height,this.vertical?u-=i.text:r-=i.text,f={width:r,height:u,top:0,left:0},this.layoutChildren(n,f))},layoutChildren:function(n,t){for(var o=t.width*t.height,f=0,u=[],e,r=0;r<n.length;r++)e=n[r],u[r]=parseFloat(n[r].value),f+=u[r],e.vertical=this.vertical;for(r=0;r<u.length;r++)n[r].area=o*u[r]/f;n=new i.data.Query(n)._sortForGrouping("value","desc");this.sliceAndDice(n,t)},sliceAndDice:function(n,t){var i=this._totalArea(n);n[0].level%2===this.quotient?this.layoutHorizontal(n,t,i):this.layoutVertical(n,t,i)},layoutHorizontal:function(n,t,i){for(var u,f,e=0,r=0;r<n.length;r++)u=n[r],f=u.area/(i/t.width),u.coord={height:t.height,width:f,top:t.top,left:t.left+e},e+=f},layoutVertical:function(n,t,i){for(var u,f,e=0,r=0;r<n.length;r++)u=n[r],f=u.area/(i/t.height),u.coord={height:f,width:t.width,top:t.top+e,left:t.left},e+=f},_totalArea:function(n){for(var i=0,t=0;t<n.length;t++)i+=n[t].area;return i}}),ut=it.extend({htmlSize:function(n){var t=this._getByUid(n.dataItem.uid),r={text:0,offset:0},u,i;return n.children&&(this._clean(t),u=this._getText(n),u&&(i=this._createTitle(n),t.append(i),r.text=n.vertical?i.height():i.width()),t.append(this._createWrap()),this.offset=(t.outerWidth()-t.innerWidth())/2),r},_createTitle:function(t){var i;return i=t.vertical?n("<div class='k-treemap-title'><\/div>"):n("<div class='k-treemap-title-vertical'><\/div>"),i.append(n("<div><\/div>").html(this._getText(t)))}});l.ui.plugin(ct)}(window.kendo.jQuery),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});
//# sourceMappingURL=kendo.dataviz.treemap.min.js.map
