(function(n,t){t(["./kendo.pivotgrid","./kendo.menu","./kendo.window","./kendo.treeview","./kendo.dropdownlist"],n)})(function(){return function(n){function c(n,t){for(var r=[],i=0,u=n.length;i<u;i++)n[i].field!==t&&r.push(n[i]);return r}function f(n,t,i){if(!n)return[];n=n.filters;for(var r=0,f=[],e=n.length,u;r<e;r++)u=n[r].operator,(i||u==="in")&&u!==i||n[r].field!==t||f.push(n[r]);return f}function l(t,i,r){var e,u=0,o=r.length;if(t=f(t,i,"in")[0],t)for(e=t.value.split(",");u<o;u++)r[u].checked=n.inArray(r[u].uniqueName,e)>=0;else for(;u<o;u++)r[u].checked=!0}function s(n,t){for(var r=n.length,i=0;i<r;i++)n[i].checked&&n[i].level()!==0&&t.push(n[i].uniqueName),n[i].hasChildren&&s(n[i].children.view(),t)}var t=window.kendo,r=t.ui,o="kendoContextMenu",i=n.proxy,u=".kendoPivotFieldMenu",e=r.Widget,h=e.extend({init:function(n,i){e.fn.init.call(this,n,i);this._dataSource();this._layout();t.notify(this)},events:[],options:{name:"PivotFieldMenu",filter:null,filterable:!0,sortable:!0,messages:{info:"Show items with value that:",sortAscending:"Sort Ascending",sortDescending:"Sort Descending",filterFields:"Fields Filter",filter:"Filter",include:"Include Fields...",title:"Fields to include",clear:"Clear",ok:"OK",cancel:"Cancel",operators:{contains:"Contains",doesnotcontain:"Does not contain",startswith:"Starts with",endswith:"Ends with",eq:"Is equal to",neq:"Is not equal to"}}},_layout:function(){var r=this.options;this.wrapper=n(t.template(a)({ns:t.ns,filterable:r.filterable,sortable:r.sortable,messages:r.messages}));this.menu=this.wrapper[o]({filter:r.filter,target:this.element,orientation:"vertical",showOn:"click",closeOnClick:!1,open:i(this._menuOpen,this),select:i(this._select,this),copyAnchorStyles:!1}).data(o);this._createWindow();r.filterable&&this._initFilterForm()},_initFilterForm:function(){var n=this.menu.element.find(".k-filter-item"),r=i(this._filter,this);this._filterOperator=new t.ui.DropDownList(n.find("select"));this._filterValue=n.find(".k-textbox");n.on("submit"+u,r).on("click"+u,".k-button-filter",r).on("click"+u,".k-button-clear",i(this._reset,this))},_setFilterForm:function(n){var t="",i="";n&&(t=n.operator,i=n.value);this._filterOperator.value(t);this._filterValue.val(i)},_clearFilters:function(n){var t=this.dataSource.filter()||{},i,r=0,u;for(t.filters=t.filters||[],i=f(t,n),u=i.length;r<u;r++)t.filters.splice(t.filters.indexOf(i[r]),1);return t},_filter:function(n){var t=this,r=t._filterValue.val(),u,i;if(n.preventDefault(),!r){t.menu.close();return}u={field:t.currentMember,operator:t._filterOperator.value(),value:r};i=t._clearFilters(t.currentMember);i.filters.push(u);t.dataSource.filter(i);t.menu.close()},_reset:function(n){var t=this,i=t._clearFilters(t.currentMember);n.preventDefault();i.filters[0]||(i={});t.dataSource.filter(i);t._setFilterForm(null);t.menu.close()},_sort:function(n){var i=this.currentMember,t=this.dataSource.sort()||[];t=c(t,i);t.push({field:i,dir:n});this.dataSource.sort(t);this.menu.close()},setDataSource:function(n){this.options.dataSource=n;this._dataSource()},_dataSource:function(){this.dataSource=t.data.PivotDataSource.create(this.options.dataSource)},_createWindow:function(){var f=this.options.messages;this.includeWindow=n(t.template(v)({messages:f})).on("click"+u,".k-button-ok",i(this._applyIncludes,this)).on("click"+u,".k-button-cancel",i(this._closeWindow,this));this.includeWindow=new r.Window(this.includeWindow,{title:f.title,visible:!1,resizable:!1,open:i(this._windowOpen,this)})},_applyIncludes:function(n){var r=[],i,e=this.treeView.dataSource.view(),o=e[0].checked,t=this.dataSource.filter(),u=f(t,this.currentMember,"in")[0];s(e,r);u&&(o?(t.filters.splice(t.filters.indexOf(u),1),t.filters.length||(t={})):u.value=r.join(","),i=t);r.length&&(i||o||(i={field:this.currentMember,operator:"in",value:r.join(",")},t&&(t.filters.push(i),i=t)));i&&this.dataSource.filter(i);this._closeWindow(n)},_closeWindow:function(n){n.preventDefault();this.includeWindow.close()},_treeViewDataSource:function(){var n=this;return t.data.HierarchicalDataSource.create({schema:{model:{id:"uniqueName",hasChildren:function(n){return parseInt(n.childrenCardinality,10)>0}}},transport:{read:function(t){var i={},r=n.treeView.dataSource.get(t.data.uniqueName),u=t.data.uniqueName;u?(i.memberUniqueName=r.uniqueName.replace(/\&/g,"&amp;"),i.treeOp=1):i.levelUniqueName=n.currentMember+".[(ALL)]";n.dataSource.schemaMembers(i).done(function(i){l(n.dataSource.filter(),n.currentMember,i);t.success(i)}).fail(t.error)}}})},_createTreeView:function(n){var t=this;t.treeView=new r.TreeView(n,{autoBind:!1,dataSource:t._treeViewDataSource(),dataTextField:"name",checkboxes:{checkChildren:!0},dataBound:function(){r.progress(t.includeWindow.element,!1)}})},_menuOpen:function(i){if(i.event){var r=t.attr("name");this.currentMember=n(i.event.target).closest("["+r+"]").attr(r);this.options.filterable&&this._setFilterForm(f(this.dataSource.filter(),this.currentMember)[0])}},_select:function(t){var i=n(t.item);n(".k-pivot-filter-window").not(this.includeWindow.element).kendoWindow("close");i.hasClass("k-include-item")?this.includeWindow.center().open():i.hasClass("k-sort-asc")?this._sort("asc"):i.hasClass("k-sort-desc")&&this._sort("desc")},_windowOpen:function(){this.treeView||this._createTreeView(this.includeWindow.element.find(".k-treeview"));r.progress(this.includeWindow.element,!0);this.treeView.dataSource.read()},destroy:function(){e.fn.destroy.call(this);this.menu&&(this.menu.destroy(),this.menu=null);this.reeeView&&(this.treeView.destroy(),this.treeView=null);this.includeWindow&&(this.includeWindow.destroy(),this.includeWindow=null);this.wrapper=null;this.element=null}}),a='<ul class="k-pivot-fieldmenu"># if (sortable) {#<li class="k-item k-sort-asc"><span class="k-link"><span class="k-icon k-i-sort-asc"><\/span>${messages.sortAscending}<\/span><\/li><li class="k-item k-sort-desc"><span class="k-link"><span class="k-icon k-i-sort-desc"><\/span>${messages.sortDescending}<\/span><\/li># if (filterable) {#<li class="k-separator"><\/li># } ## } ## if (filterable) {#<li class="k-item k-include-item"><span class="k-link"><span class="k-icon k-filter"><\/span>${messages.include}<\/span><\/li><li class="k-separator"><\/li><li class="k-item k-filter-item"><span class="k-link"><span class="k-icon k-filter"><\/span>${messages.filterFields}<\/span><ul><li><div class="k-filterable k-content" tabindex="-1" data-role="fieldmenu"><form class="k-filter-menu"><div><div class="k-filter-help-text">#=messages.info#<\/div><select>#for(var op in messages.operators){#<option value="#=op#">#=messages.operators[op]#<\/option>#}#<\/select><input class="k-textbox" type="text" /><div><a class="k-button k-primary k-button-filter" href="\\#">#=messages.filter#<\/a><a class="k-button k-button-clear" href="\\#">#=messages.clear#<\/a><\/div><\/div><\/form><\/div><\/li><\/ul><\/li># } #<\/ul>',v='<div class="k-popup-edit-form k-pivot-filter-window"><div class="k-edit-form-container"><div class="k-treeview"><\/div><div class="k-edit-buttons k-state-default"><a class="k-button k-primary k-button-ok" href="\\#">${messages.ok}<\/a><a class="k-button k-button-cancel" href="\\#">${messages.cancel}<\/a><\/div><\/div>';r.plugin(h)}(window.kendo.jQuery),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});
//# sourceMappingURL=kendo.pivot.fieldmenu.min.js.map
