(function(n,t){t(["./kendo.data","./kendo.draganddrop","./kendo.userevents","./kendo.mobile.scroller","./kendo.drawing","./kendo.core","./kendo.dataviz.core","./kendo.popup","./kendo.toolbar","./kendo.editable","./kendo.window","./kendo.dropdownlist","./kendo.dataviz.themes"],n)})(function(){return function(n){function h(n,i,r){function s(n){for(var t=1;n*t%1;)t*=10;return t}var f,o,e,u;if(typeof n=="undefined"||typeof i=="undefined")return[];if(r&&t.sign(i-n)!=t.sign(r))throw"The sign of the increment should allow to reach the stop-value.";if(r=r||1,n=n||0,i=i||n,(i-n)/r==Infinity)throw"Infinite range defined.";if(f=[],o=-1,u=s(Math.abs(r)),n*=u,i*=u,r*=u,n>i&&r>0&&(r=-r),r<0)while((e=n+r*++o)>=i)f.push(e/u);else while((e=n+r*++o)<=i)f.push(e/u);return f}function c(n,t){if(n==t)return 0;var r=t.x-n.x,u=n.y-t.y,i=Math.atan(r/u);return u>=0?r<0?i+2*Math.PI:i:i+Math.PI}var i=window.kendo,r=i.dataviz.diagram={},l=i.Class,e=i.deepExtend,o=n.isArray,s=1e-6,t={},u,f;e(t,{isNearZero:function(n){return Math.abs(n)<s},isDefined:function(n){return typeof n!="undefined"},isUndefined:function(n){return typeof n=="undefined"||n===null},isObject:function(n){return n===Object(n)},has:function(n,t){return Object.hasOwnProperty.call(n,t)},isString:function(n){return Object.prototype.toString.call(n)=="[object String]"},isBoolean:function(n){return Object.prototype.toString.call(n)=="[object Boolean]"},isType:function(n,t){return Object.prototype.toString.call(n)=="[object "+t+"]"},isNumber:function(n){return!isNaN(parseFloat(n))&&isFinite(n)},isEmpty:function(n){if(n===null)return!0;if(o(n)||t.isString(n))return n.length===0;for(var i in n)if(t.has(n,i))return!1;return!0},simpleExtend:function(n,i){if(t.isObject(i))for(var r in i)n[r]=i[r]},initArray:function(n,t){for(var r=[],i=0;i<n;++i)r[i]=t;return r},serializePoints:function(n){for(var i,r=[],t=0;t<n.length;t++)i=n[t],r.push(i.x+";"+i.y);return r.join(";")},deserializePoints:function(n){var i=n.split(";"),u=[],t;if(i.length%2!=0)throw"Not an array of points.";for(t=0;t<i.length;t+=2)u.push(new r.Point(parseInt(i[t],10),parseInt(i[t+1],10)));return u},randomInteger:function(n,t){return parseInt(Math.floor(Math.random()*t)+n,10)},DFT:function(n,t){var i,r;if(t(n),n.childNodes)for(i=0;i<n.childNodes.length;i++)r=n.childNodes[i],this.DFT(r,t)},getMatrixAngle:function(n){return n===null||n.d===0?0:Math.atan2(n.b,n.d)*180/Math.PI},getMatrixScaling:function(n){var t=Math.sqrt(n.a*n.a+n.c*n.c),i=Math.sqrt(n.b*n.b+n.d*n.d);return[t,i]}});t.sign=function(n){return n?n<0?-1:1:0};t.findAngle=function(n,t){return c(n,t)*180/Math.PI};t.forEach=function(n,t,i){for(var r=0;r<n.length;r++)t.call(i,n[r],r,n)};t.any=function(n,t){for(var i=0;i<n.length;++i)if(t(n[i]))return n[i];return null};t.remove=function(n,i){for(var r;(r=t.indexOf(n,i))!==-1;)n.splice(r,1);return n};t.contains=function(n,i){return t.indexOf(n,i)!==-1};t.indexOf=function(t,i){return n.inArray(i,t)};t.fold=function(n,t,i,r){for(var e,f=arguments.length>2,u=0;u<n.length;u++)e=n[u],f?i=t.call(r,i,e,u,n):(i=e,f=!0);if(!f)throw"Reduce of empty array with no initial value";return i};t.find=function(n,i,r){var u;return t.any(n,function(n,t,f){return i.call(r,n,t,f)?(u=n,!0):!1}),u};t.first=function(n,i,r){return n.length===0?null:t.isUndefined(i)?n[0]:t.find(n,i,r)};t.insert=function(n,t,i){return n.splice(i,0,t),n};t.all=function(n,t,i){for(var r=!0,f,u=0;u<n.length;u++)if(f=n[u],r=r&&t.call(i,f,u,n),!r)break;return r};t.clear=function(n){n.splice(0,n.length)};t.bisort=function(n,i,r){if(t.isUndefined(n))throw"First array is not specified.";if(t.isUndefined(i))throw"Second array is not specified.";if(n.length!=i.length)throw"The two arrays should have equal length";for(var f=[],u=0;u<n.length;u++)f.push({x:n[u],y:i[u]});for(t.isUndefined(r)?f.sort(function(n,t){return n.x-t.x}):f.sort(function(n,t){return r(n.x,t.x)}),t.clear(n),t.clear(i),u=0;u<f.length;u++)n.push(f[u].x),i.push(f[u].y)};t.addRange=function(n,t){n.push.apply(n,t)};u={easeInOut:function(n){return-Math.cos(n*Math.PI)/2+.5}};f=i.Class.extend({init:function(){this.adapters=[];this.target=0;this.tick=0;this.interval=20;this.duration=800;this.lastTime=null;this.handlers=[];var n=this;this.transition=u.easeInOut;this.timerDelegate=function(){n.onTimerEvent()}},addAdapter:function(n){this.adapters.push(n)},onComplete:function(n){this.handlers.push(n)},removeHandler:function(t){this.handlers=n.grep(this.handlers,function(n){return n!==t})},trigger:function(){var n=this;this.handlers&&t.forEach(this.handlers,function(t){return t.call(n.caller!==null?n.caller:n)})},onStep:function(){},seekTo:function(n){this.seekFromTo(this.tick,n)},seekFromTo:function(n,t){this.target=Math.max(0,Math.min(1,t));this.tick=Math.max(0,Math.min(1,n));this.lastTime=(new Date).getTime();this.intervalId||(this.intervalId=window.setInterval(this.timerDelegate,this.interval))},stop:function(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.trigger())},play:function(n){this.adapters.length!==0&&(n!==null&&(this.caller=n),this.initState(),this.seekFromTo(0,1))},reverse:function(){this.seekFromTo(1,0)},initState:function(){if(this.adapters.length!==0)for(var n=0;n<this.adapters.length;n++)this.adapters[n].initState()},propagate:function(){for(var t=this.transition(this.tick),n=0;n<this.adapters.length;n++)this.adapters[n].update(t)},onTimerEvent:function(){var t=(new Date).getTime(),i=t-this.lastTime,n;this.lastTime=t;n=i/this.duration*(this.tick<this.target?1:-1);Math.abs(n)>=Math.abs(this.tick-this.target)?this.tick=this.target:this.tick+=n;try{this.propagate()}finally{this.onStep.call(this);this.target==this.tick&&this.stop()}}});i.deepExtend(r,{init:function(n){i.init(n,r.ui)},Utils:t,Range:h,Ticker:f})}(window.kendo.jQuery),function(n,t){function st(n){return Math.abs(n)<et}function it(n,t,i,u,f){var o=(t.x-n.x)*(u.y-i.y)-(t.y-n.y)*(u.x-i.x);if(!st(o)){var h=(n.y-i.y)*(u.x-i.x)-(n.x-i.x)*(u.y-i.y),c=(n.y-i.y)*(t.x-n.x)-(n.x-i.x)*(t.y-n.y),e=h/o,s=c/o;if(!f||!(e<0||e>1||s<0||s>1))return new r(n.x+e*(t.x-n.x),n.y+e*(t.y-n.y))}}function ct(n,t){var r,u,i;do r=Math.random()*2-1,u=Math.random()*2-1,i=r*r+u*u;while(!i||i>1);return n+t*r*Math.sqrt(-2*Math.log(i)/i)}function p(n){var t,r,u;for(i.isUndefined(n)&&(n=10),t="",r="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",u=n;u>0;--u)t+=r.charAt(Math.round(Math.random()*(r.length-1)));return t}var u=window.kendo,l=u.dataviz.diagram,y=u.Class,g=u.deepExtend,ut=u.dataviz,i=l.Utils,r=ut.Point2D,ft=u.isFunction,e=i.contains,k=n.map,d=3,et=1e-6,tt;g(r.fn,{plus:function(n){return new r(this.x+n.x,this.y+n.y)},minus:function(n){return new r(this.x-n.x,this.y-n.y)},offset:function(n){return new r(this.x-n,this.y-n)},times:function(n){return new r(this.x*n,this.y*n)},normalize:function(){return this.length()===0?new r:this.times(1/this.length())},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},toString:function(){return"("+this.x+","+this.y+")"},lengthSquared:function(){return this.x*this.x+this.y*this.y},middleOf:function(n,t){return new r(t.x-n.x,t.y-n.y).times(.5).plus(n)},toPolar:function(n){var i=1;n&&(i=180/Math.PI);var u=Math.atan2(Math.abs(this.y),Math.abs(this.x)),r=Math.PI/2,t=this.length();if(this.x===0){if(this.y===0)return new v(0,0);if(this.y>0)return new v(t,i*r);if(this.y<0)return new v(t,i*3*r)}else if(this.x>0){if(this.y===0)return new v(t,0);if(this.y>0)return new v(t,i*u);if(this.y<0)return new v(t,i*(4*r-u))}else{if(this.y===0)return new v(t,2*r);if(this.y>0)return new v(t,i*(2*r-u));if(this.y<0)return new v(t,i*(2*r+u))}},isOnLine:function(n,t){var o,i,r,u,e;return(n.x>t.x&&(o=t,t=n,n=o),i=new f(n.x,n.y).inflate(d,d),r=new f(t.x,t.y).inflate(d,d),i.union(r).contains(this))?n.x===t.x||n.y===t.y?!0:(n.y<t.y?(u=i.x+(r.x-i.x)*(this.y-(i.y+i.height))/(r.y+r.height-(i.y+i.height)),e=i.x+i.width+(r.x+r.width-(i.x+i.width))*(this.y-i.y)/(r.y-i.y)):(u=i.x+(r.x-i.x)*(this.y-i.y)/(r.y-i.y),e=i.x+i.width+(r.x+r.width-(i.x+i.width))*(this.y-(i.y+i.height))/(r.y+r.height-(i.y+i.height))),this.x>u&&this.x<e):!1}});g(r,{parse:function(n){var f=n.slice(1,n.length-1),t=f.split(","),i=parseInt(t[0],10),u=parseInt(t[1],10);if(!isNaN(i)&&!isNaN(u))return new r(i,u)}});var ot=y.extend({init:function(n,t,i){this.point=n;this.left=t;this.right=i}}),f=y.extend({init:function(n,t,i,r){this.x=n||0;this.y=t||0;this.width=i||0;this.height=r||0},contains:function(n){return n.x>=this.x&&n.x<=this.x+this.width&&n.y>=this.y&&n.y<=this.y+this.height},inflate:function(n,i){return i===t&&(i=n),this.x-=n,this.y-=i,this.width+=2*n+1,this.height+=2*i+1,this},offset:function(n,t){var i=n,u=t;return n instanceof r&&(i=n.x,u=n.y),this.x+=i,this.y+=u,this},union:function(n){var t=Math.min(this.x,n.x),i=Math.min(this.y,n.y),r=Math.max(this.x+this.width,n.x+n.width),u=Math.max(this.y+this.height,n.y+n.height);return new f(t,i,r-t,u-i)},center:function(){return new r(this.x+this.width/2,this.y+this.height/2)},top:function(){return new r(this.x+this.width/2,this.y)},right:function(){return new r(this.x+this.width,this.y+this.height/2)},bottom:function(){return new r(this.x+this.width/2,this.y+this.height)},left:function(){return new r(this.x,this.y+this.height/2)},topLeft:function(){return new r(this.x,this.y)},topRight:function(){return new r(this.x+this.width,this.y)},bottomLeft:function(){return new r(this.x,this.y+this.height)},bottomRight:function(){return new r(this.x+this.width,this.y+this.height)},clone:function(){return new f(this.x,this.y,this.width,this.height)},isEmpty:function(){return!this.width&&!this.height},equals:function(n){return this.x===n.x&&this.y===n.y&&this.width===n.width&&this.height===n.height},rotatedBounds:function(n){var t=this.clone(),i=this.rotatedPoints(n),r=i[0],u=i[1],f=i[2],e=i[3];return t.x=Math.min(f.x,r.x,u.x,e.x),t.y=Math.min(f.y,r.y,u.y,e.y),t.width=Math.max(f.x,r.x,u.x,e.x)-t.x,t.height=Math.max(f.y,r.y,u.y,e.y)-t.y,t},rotatedPoints:function(n){var t=this,i=t.center(),r=t.bottomRight().rotate(i,360-n),u=t.topLeft().rotate(i,360-n),f=t.topRight().rotate(i,360-n),e=t.bottomLeft().rotate(i,360-n);return[u,f,r,e]},toString:function(n){return n=n||" ",this.x+n+this.y+n+this.width+n+this.height},scale:function(n,t,i,u,f){var e=this.topLeft(),s=this.center();e.rotate(s,360-f).rotate(u,f);var o=i.minus(e),h=new r(o.x*n,o.y*t),c=o.minus(h);e=e.plus(c);e.rotate(u,360-f).rotate(s,f);this.x=e.x;this.y=e.y;this.width*=n;this.height*=t},zoom:function(n){return this.x*=n,this.y*=n,this.width*=n,this.height*=n,this}}),nt=y.extend({init:function(n,t){this.width=n;this.height=t}});nt.prototype.Empty=new nt(0,0);f.toRect=function(n){return n instanceof f||(n=new f(n.x,n.y,n.width,n.height)),n};f.empty=function(){return new f(0,0,0,0)};f.fromPoints=function(n,t){if(isNaN(n.x)||isNaN(n.y)||isNaN(t.x)||isNaN(t.y))throw"Some values are NaN.";return new f(Math.min(n.x,t.x),Math.min(n.y,t.y),Math.abs(n.x-t.x),Math.abs(n.y-t.y))};var a={lines:function(n,t,i,r){return it(n,t,i,r)},segments:function(n,t,i,r){return it(n,t,i,r,!0)},rectWithLine:function(n,t,i){return a.segments(t,i,n.topLeft(),n.topRight())||a.segments(t,i,n.topRight(),n.bottomRight())||a.segments(t,i,n.bottomLeft(),n.bottomRight())||a.segments(t,i,n.topLeft(),n.bottomLeft())},rects:function(n,t,i){var r=t.topLeft(),u=t.topRight(),f=t.bottomLeft(),e=t.bottomRight(),o=t.center(),h,s;return i&&(r=r.rotate(o,i),u=u.rotate(o,i),f=f.rotate(o,i),e=e.rotate(o,i)),h=n.contains(r)||n.contains(u)||n.contains(f)||n.contains(e)||a.rectWithLine(n,r,u)||a.rectWithLine(n,r,f)||a.rectWithLine(n,u,e)||a.rectWithLine(n,f,e),h||(r=n.topLeft(),u=n.topRight(),f=n.bottomLeft(),e=n.bottomRight(),i&&(s=360-i,r=r.rotate(o,s),u=u.rotate(o,s),f=f.rotate(o,s),e=e.rotate(o,s)),h=t.contains(r)||t.contains(u)||t.contains(f)||t.contains(e)),h}},ht=y.extend({init:function(n){this.container=f.toRect(n)},align:function(n,t){for(var r=t.toLowerCase().split(" "),i=0;i<r.length;i++)n=this._singleAlign(n,r[i]);return n},_singleAlign:function(n,t){return ft(this[t])?this[t](n):n},left:function(n){return this._align(n,this._left)},center:function(n){return this._align(n,this._center)},right:function(n){return this._align(n,this._right)},stretch:function(n){return this._align(n,this._stretch)},top:function(n){return this._align(n,this._top)},middle:function(n){return this._align(n,this._middle)},bottom:function(n){return this._align(n,this._bottom)},_left:function(n,t){t.x=n.x},_center:function(n,t){t.x=(n.width-t.width)/2||0},_right:function(n,t){t.x=n.width-t.width},_top:function(n,t){t.y=n.y},_middle:function(n,t){t.y=(n.height-t.height)/2||0},_bottom:function(n,t){t.y=n.height-t.height},_stretch:function(n,t){t.x=0;t.y=0;t.height=n.height;t.width=n.width},_align:function(n,t){return n=f.toRect(n),t(this.container,n),n}}),v=y.extend({init:function(n,t){this.r=n;this.angle=t}}),s=y.extend({init:function(n,t,i,r,u,f){this.a=n||0;this.b=t||0;this.c=i||0;this.d=r||0;this.e=u||0;this.f=f||0},plus:function(n){this.a+=n.a;this.b+=n.b;this.c+=n.c;this.d+=n.d;this.e+=n.e;this.f+=n.f},minus:function(n){this.a-=n.a;this.b-=n.b;this.c-=n.c;this.d-=n.d;this.e-=n.e;this.f-=n.f},times:function(n){return new s(this.a*n.a+this.c*n.b,this.b*n.a+this.d*n.b,this.a*n.c+this.c*n.d,this.b*n.c+this.d*n.d,this.a*n.e+this.c*n.f+this.e,this.b*n.e+this.d*n.f+this.f)},apply:function(n){return new r(this.a*n.x+this.c*n.y+this.e,this.b*n.x+this.d*n.y+this.f)},applyRect:function(n){return f.fromPoints(this.apply(n.topLeft()),this.apply(n.bottomRight()))},toString:function(){return"matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")"}});g(s,{fromSVGMatrix:function(n){var t=new s;return t.a=n.a,t.b=n.b,t.c=n.c,t.d=n.d,t.e=n.e,t.f=n.f,t},fromMatrixVector:function(n){var t=new s;return t.a=n.a,t.b=n.b,t.c=n.c,t.d=n.d,t.e=n.e,t.f=n.f,t},fromList:function(n){if(n.length!==6)throw"The given list should consist of six elements.";var t=new s;return t.a=n[0],t.b=n[1],t.c=n[2],t.d=n[3],t.e=n[4],t.f=n[5],t},translation:function(n,t){var i=new s;return i.a=1,i.b=0,i.c=0,i.d=1,i.e=n,i.f=t,i},unit:function(){return new s(1,0,0,1,0,0)},rotation:function(n,t,i){var r=new s;return r.a=Math.cos(n*Math.PI/180),r.b=Math.sin(n*Math.PI/180),r.c=-r.b,r.d=r.a,r.e=t-t*r.a+i*r.b||0,r.f=i-i*r.a-t*r.b||0,r},scaling:function(n,t){var i=new s;return i.a=n,i.b=0,i.c=0,i.d=t,i.e=0,i.f=0,i},parse:function(n){var t,i;if(n){if(n=n.trim(),n.slice(0,6).toLowerCase()==="matrix"){if(i=n.slice(7,n.length-1).trim(),t=i.split(","),t.length===6)return s.fromList(k(t,function(n){return parseFloat(n)}));if(t=i.split(" "),t.length===6)return s.fromList(k(t,function(n){return parseFloat(n)}))}if(n.slice(0,1)==="("&&n.slice(n.length-1)===")"&&(n=n.substr(1,n.length-1)),n.indexOf(",")>0&&(t=n.split(","),t.length===6))return s.fromList(k(t,function(n){return parseFloat(n)}));if(n.indexOf(" ")>0&&(t=n.split(" "),t.length===6))return s.fromList(k(t,function(n){return parseFloat(n)}))}return t}});tt=y.extend({init:function(n,t,i,r,u,f){this.a=n||0;this.b=t||0;this.c=i||0;this.d=r||0;this.e=u||0;this.f=f||0},fromMatrix:function(n){var t=new tt;return t.a=n.a,t.b=n.b,t.c=n.c,t.d=n.d,t.e=n.e,t.f=n.f,t}});var lt={_distanceToLineSquared:function(n,t,i){function e(n,t){return(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y)}if(t===i)return e(n,t);var u=i.x-t.x,f=i.y-t.y,r=(n.x-t.x)*u+(n.y-t.y)*f;return r<0?e(t,n):(r=(i.x-n.x)*u+(i.y-n.y)*f,r<0)?e(i,n):(r=(i.x-n.x)*f-(i.y-n.y)*u,r*r/(u*u+f*f))},distanceToLine:function(n,t,i){return Math.sqrt(this._distanceToLineSquared(n,t,i))},distanceToPolyline:function(n,t){var u=Number.MAX_VALUE,r;if(i.isUndefined(t)||t.length===0)return Number.MAX_VALUE;for(r=0;r<t.length-1;r++){var e=t[r],o=t[r+1],f=this._distanceToLineSquared(n,e,o);f<u&&(u=f)}return Math.sqrt(u)}},w=u.Class.extend({init:function(){this._buckets=[];this.length=0},add:function(n,t){var r=this._createGetBucket(n);return i.isDefined(t)&&(r.value=t),r},get:function(n){return this._bucketExists(n)?this._createGetBucket(n):null},set:function(n,t){this.add(n,t)},containsKey:function(n){return this._bucketExists(n)},remove:function(n){if(this._bucketExists(n)){var t=this._hash(n);return delete this._buckets[t],this.length--,n}},forEach:function(n){for(var f,r,u=this._hashes(),t=0,e=u.length;t<e;t++)(f=u[t],r=this._buckets[f],i.isUndefined(r))||n(r)},clone:function(){for(var f,n,r=new w,u=this._hashes(),t=0,e=u.length;t<e;t++)(f=u[t],n=this._buckets[f],i.isUndefined(n))||r.add(n.key,n.value);return r},_hashes:function(){var n=[];for(var t in this._buckets)this._buckets.hasOwnProperty(t)&&n.push(t);return n},_bucketExists:function(n){var t=this._hash(n);return i.isDefined(this._buckets[t])},_createGetBucket:function(n){var r=this._hash(n),t=this._buckets[r];return i.isUndefined(t)&&(t={key:n},this._buckets[r]=t,this.length++),t},_hash:function(n){if(i.isNumber(n))return n;if(i.isString(n))return this._hashString(n);if(i.isObject(n))return this._objectHashId(n);throw"Unsupported key type.";},_hashString:function(n){var t=0,i,r;if(n.length===0)return t;for(i=0;i<n.length;i++)r=n.charCodeAt(i),t=t*32-t+r;return t},_objectHashId:function(n){var t=n._hashId;return i.isUndefined(t)&&(t=p(),n._hashId=t),t}}),h=u.Observable.extend({init:function(t){var f=this,r;if(u.Observable.fn.init.call(f),this._hashTable=new w,this.length=0,i.isDefined(t))if(n.isArray(t))for(r=0;r<t.length;r++)this.add(t[r]);else t.forEach(function(n,t){this.add(n,t)},this)},add:function(n,t){var i=this._hashTable.get(n);i||(i=this._hashTable.add(n),this.length++,this.trigger("changed"));i.value=t},set:function(n,t){this.add(n,t)},get:function(n){var t=this._hashTable.get(n);if(t)return t.value;throw new Error("Cannot find key "+n);},containsKey:function(n){return this._hashTable.containsKey(n)},remove:function(n){if(this.containsKey(n))return this.trigger("changed"),this.length--,this._hashTable.remove(n)},forEach:function(n,t){this._hashTable.forEach(function(i){n.call(t,i.key,i.value)})},forEachValue:function(n,t){this._hashTable.forEach(function(i){n.call(t,i.value)})},forEachKey:function(n,t){this._hashTable.forEach(function(i){n.call(t,i.key)})},keys:function(){var n=[];return this.forEachKey(function(t){n.push(t)}),n}}),rt=u.Class.extend({init:function(){this._tail=null;this._head=null;this.length=0},enqueue:function(n){var t={value:n,next:null};this._head?(this._tail.next=t,this._tail=this._tail.next):(this._head=t,this._tail=this._head);this.length++},dequeue:function(){if(this.length<1)throw new Error("The queue is empty.");var n=this._head.value;return this._head=this._head.next,this.length--,n},contains:function(n){for(var t=this._head;t;){if(t.value===n)return!0;t=t.next}return!1}}),at=u.Observable.extend({init:function(n){var t=this;u.Observable.fn.init.call(t);this._hashTable=new w;this.length=0;i.isDefined(n)&&(n instanceof w?n.forEach(function(n){this.add(n)}):n instanceof h&&n.forEach(function(n,t){this.add({key:n,value:t})},this))},contains:function(n){return this._hashTable.containsKey(n)},add:function(n){var t=this._hashTable.get(n);t||(this._hashTable.add(n,n),this.length++,this.trigger("changed"))},get:function(n){return this.contains(n)?this._hashTable.get(n).value:null},hash:function(n){return this._hashTable._hash(n)},remove:function(n){this.contains(n)&&(this._hashTable.remove(n),this.length--,this.trigger("changed"))},forEach:function(n,t){this._hashTable.forEach(function(t){n(t.value)},t)},toArray:function(){var n=[];return this.forEach(function(t){n.push(t)}),n}}),c=u.Class.extend({init:function(n,t){if(this.links=[],this.outgoing=[],this.incoming=[],this.weight=1,this.id=i.isDefined(n)?n:p(),i.isDefined(t)){this.associatedShape=t;var r=t.bounds();this.width=r.width;this.height=r.height;this.x=r.x;this.y=r.y}else this.associatedShape=null;this.data=null;this.type="Node";this.shortForm="Node '"+this.id+"'";this.isVirtual=!1},isIsolated:function(){return i.isEmpty(this.links)},bounds:function(n){if(!i.isDefined(n))return new l.Rect(this.x,this.y,this.width,this.height);this.x=n.x;this.y=n.y;this.width=n.width;this.height=n.height},isLinkedTo:function(n){var t=this;return i.any(t.links,function(i){return i.getComplement(t)===n})},getChildren:function(){var t,n,i,r;if(this.outgoing.length===0)return[];for(t=[],n=0,i=this.outgoing.length;n<i;n++)r=this.outgoing[n],t.push(r.getComplement(this));return t},getParents:function(){var t,n,i,r;if(this.incoming.length===0)return[];for(t=[],n=0,i=this.incoming.length;n<i;n++)r=this.incoming[n],t.push(r.getComplement(this));return t},clone:function(){var n=new c;return i.isDefined(this.weight)&&(n.weight=this.weight),i.isDefined(this.balance)&&(n.balance=this.balance),i.isDefined(this.owner)&&(n.owner=this.owner),n.associatedShape=this.associatedShape,n.x=this.x,n.y=this.y,n.width=this.width,n.height=this.height,n},adjacentTo:function(n){return this.isLinkedTo(n)!==null},removeLink:function(n){n.source===this&&(i.remove(this.links,n),i.remove(this.outgoing,n),n.source=null);n.target===this&&(i.remove(this.links,n),i.remove(this.incoming,n),n.target=null)},hasLinkTo:function(n){return i.any(this.outgoing,function(t){return t.target===n})},degree:function(){return this.links.length},incidentWith:function(n){return e(this.links,n)},getLinksWith:function(n){return i.all(this.links,function(t){return t.getComplement(this)===n},this)},getNeighbors:function(){var n=[];return i.forEach(this.incoming,function(t){n.push(t.getComplement(this))},this),i.forEach(this.outgoing,function(t){n.push(t.getComplement(this))},this),n}}),b=u.Class.extend({init:function(n,t,r,u){if(i.isUndefined(n))throw"The source of the new link is not set.";if(i.isUndefined(t))throw"The target of the new link is not set.";var f,e;f=i.isString(n)?new c(n):n;e=i.isString(t)?new c(t):t;this.source=f;this.target=e;this.source.links.push(this);this.target.links.push(this);this.source.outgoing.push(this);this.target.incoming.push(this);this.id=i.isDefined(r)?r:p();this.associatedConnection=i.isDefined(u)?u:null;this.type="Link";this.shortForm="Link '"+this.source.id+"->"+this.target.id+"'"},getComplement:function(n){if(this.source!==n&&this.target!==n)throw"The given node is not incident with this link.";return this.source===n?this.target:this.source},getCommonNode:function(n){return this.source===n.source||this.source===n.target?this.source:this.target===n.source||this.target===n.target?this.target:null},isBridging:function(n,t){return this.source===n&&this.target===t||this.source===t&&this.target===n},getNodes:function(){return[this.source,this.target]},incidentWith:function(n){return this.source===n||this.target===n},adjacentTo:function(n){return e(this.source.links,n)||e(this.target.links,n)},changeSource:function(n){i.remove(this.source.links,this);i.remove(this.source.outgoing,this);n.links.push(this);n.outgoing.push(this);this.source=n},changeTarget:function(n){i.remove(this.target.links,this);i.remove(this.target.incoming,this);n.links.push(this);n.incoming.push(this);this.target=n},changesNodes:function(n,t){this.source===n?this.changeSource(t):this.target===n&&this.changeTarget(t)},reverse:function(){var n=this.source,t=this.target;return this.source=t,i.remove(n.outgoing,this),this.source.outgoing.push(this),this.target=n,i.remove(t.incoming,this),this.target.incoming.push(this),this},directTo:function(n){if(this.source!==n&&this.target!==n)throw"The given node is not incident with this link.";this.target!==n&&this.reverse()},createReverseEdge:function(){var n=this.clone();return n.reverse(),n.reversed=!0,n},clone:function(){return new b(this.source,this.target)}}),o=u.Class.extend({init:function(n){this.links=[];this.nodes=[];this.diagram=null;this._root=null;i.isDefined(n)?i.isString(n)?this.id=n:(this.diagram=n,this.id=n.id):this.id=p();this.bounds=new f;this._hasCachedRelationships=!1;this.type="Graph"},cacheRelationships:function(n){var r,u,t;if(i.isUndefined(n)&&(n=!1),!this._hasCachedRelationships||n){for(r=0,u=this.nodes.length;r<u;r++)t=this.nodes[r],t.children=this.getChildren(t),t.parents=this.getParents(t);this._hasCachedRelationships=!0}},assignLevels:function(n,t,r){var e,u,o,f;if(!n)throw"Start node not specified.";for(i.isUndefined(t)&&(t=0),this.cacheRelationships(),i.isUndefined(r)&&(r=new h,i.forEach(this.nodes,function(n){r.add(n,!1)})),r.set(n,!0),n.level=t,e=n.children,u=0,o=e.length;u<o;u++)(f=e[u],f&&!r.get(f))&&this.assignLevels(f,t+1,r)},root:function(n){if(i.isUndefined(n)){if(this._root)return this._root;var t=i.first(this.nodes,function(n){return n.incoming.length===0});return t?t:i.first(this.nodes)}this._root=n},getConnectedComponents:function(){var t,r,u,n,f;for(this.componentIndex=0,this.setItemIndices(),t=i.initArray(this.nodes.length,-1),r=0;r<this.nodes.length;r++)t[r]===-1&&(this._collectConnectedNodes(t,r),this.componentIndex++);for(u=[],n=0;n<this.componentIndex;++n)u[n]=new o;for(n=0;n<t.length;++n)f=u[t[n]],f.addNodeAndOutgoings(this.nodes[n]);return u.sort(function(n,t){return t.nodes.length-n.nodes.length}),u},_collectConnectedNodes:function(n,t){n[t]=this.componentIndex;var r=this.nodes[t];i.forEach(r.links,function(t){var u=t.getComplement(r),i=u.index;n[i]===-1&&this._collectConnectedNodes(n,i)},this)},calcBounds:function(){var n,t,r,i;if(this.isEmpty())return this.bounds=new f,this.bounds;for(n=null,t=0,r=this.nodes.length;t<r;t++)i=this.nodes[t],n=n?n.union(i.bounds()):i.bounds();return this.bounds=n,this.bounds},getSpanningTree:function(n){var r=new o,f=new h,s,c,a,l,v,u,y,k,t,d,p,w;for(r.root=n.clone(),r.root.level=0,r.root.id=n.id,f.add(n,r.root),n.level=0,a=[],l=[],r.nodes.push(r.root),a.push(n),l.push(n),v=1;l.length>0;)for(u=l.pop(),y=0;y<u.links.length;y++)(k=u.links[y],t=k.getComplement(u),e(a,t))||(t.level=u.level+1,v<t.level+1&&(v=t.level+1),e(l,t)||l.push(t),e(a,t)||a.push(t),f.containsKey(u)?s=f.get(u):(s=u.clone(),s.level=u.level,s.id=u.id,f.add(u,s)),f.containsKey(t)?c=f.get(t):(c=t.clone(),c.level=t.level,c.id=t.id,f.add(t,c)),d=new b(s,c),r.addLink(d));for(p=[],w=0;w<v;w++)p.push([]);return i.forEach(r.nodes,function(n){p[n.level].push(n)}),r.treeLevels=p,r.cacheRelationships(),r},takeRandomNode:function(t,r){if(i.isUndefined(t)&&(t=[]),i.isUndefined(r)&&(r=4),this.nodes.length===0)return null;if(this.nodes.length===1)return e(t,this.nodes[0])?null:this.nodes[0];var u=n.grep(this.nodes,function(n){return!e(t,n)&&n.degree()<=r});return i.isEmpty(u)?null:u[i.randomInteger(0,u.length)]},isEmpty:function(){return i.isEmpty(this.nodes)},isHealthy:function(){return i.all(this.links,function(n){return e(this.nodes,n.source)&&e(this.nodes,n.target)},this)},getParents:function(n){if(!this.hasNode(n))throw"The given node is not part of this graph.";return n.getParents()},getChildren:function(n){if(!this.hasNode(n))throw"The given node is not part of this graph.";return n.getChildren()},addLink:function(n,t,r){var u,f,e;if(i.isUndefined(n))throw"The source of the link is not defined.";if(i.isUndefined(t)){if(i.isDefined(n.type)&&n.type==="Link"){this.addExistingLink(n);return}throw"The target of the link is not defined.";}return u=this.getNode(n),i.isUndefined(u)&&(u=this.addNode(n)),f=this.getNode(t),i.isUndefined(f)&&(f=this.addNode(t)),e=new b(u,f),i.isDefined(r)&&(e.owner=r),this.links.push(e),e},removeAllLinks:function(){while(this.links.length>0){var n=this.links[0];this.removeLink(n)}},addExistingLink:function(n){var t,i;this.hasLink(n)||(this.links.push(n),this.hasNode(n.source.id)?(t=this.getNode(n.source.id),n.changeSource(t)):this.addNode(n.source),this.hasNode(n.target.id)?(i=this.getNode(n.target.id),n.changeTarget(i)):this.addNode(n.target))},hasLink:function(n){if(i.isString(n))return i.any(this.links,function(t){return t.id===n});if(n.type==="Link")return e(this.links,n);throw"The given object is neither an identifier nor a Link.";},getNode:function(n){if(i.isUndefined(n))throw"No identifier or Node specified.";return i.isString(n)?i.find(this.nodes,function(t){return t.id==n}):this.hasNode(n)?n:null},hasNode:function(n){if(i.isString(n))return i.any(this.nodes,function(t){return t.id===n});if(i.isObject(n))return i.any(this.nodes,function(t){return t===n});throw"The identifier should be a Node or the Id (string) of a node.";},removeNode:function(n){var t=n,u,r,f,e;if(i.isString(n)&&(t=this.getNode(n)),i.isDefined(t)){for(u=t.links,t.links=[],r=0,f=u.length;r<f;r++)e=u[r],this.removeLink(e);i.remove(this.nodes,t)}else throw"The identifier should be a Node or the Id (string) of a node.";},areConnected:function(n,t){return i.any(this.links,function(i){return i.source==n&&i.target==t||i.source==t&&i.target==n})},removeLink:function(n){i.remove(this.links,n);i.remove(n.source.outgoing,n);i.remove(n.source.links,n);i.remove(n.target.incoming,n);i.remove(n.target.links,n)},addNode:function(n,t,r){var u=null;if(!i.isDefined(n))throw"No Node or identifier for a new Node is given.";if(i.isString(n)){if(this.hasNode(n))return this.getNode(n);u=new c(n)}else{if(this.hasNode(n))return this.getNode(n);u=n}return i.isDefined(t)&&u.bounds(t),i.isDefined(r)&&(u.owner=r),this.nodes.push(u),u},addNodeAndOutgoings:function(n){e(this.nodes,n)||this.nodes.push(n);var t=n.outgoing;n.outgoing=[];i.forEach(t,function(n){this.addExistingLink(n)},this)},setItemIndices:function(){for(var n=0;n<this.nodes.length;++n)this.nodes[n].index=n;for(n=0;n<this.links.length;++n)this.links[n].index=n},clone:function(n){var t=new o,u=i.isDefined(n)&&n===!0,r;return u&&(t.nodeMap=new h,t.linkMap=new h),r=new h,i.forEach(this.nodes,function(n){var i=n.clone();r.set(n,i);t.nodes.push(i);u&&t.nodeMap.set(i,n)}),i.forEach(this.links,function(n){if(r.containsKey(n.source)&&r.containsKey(n.target)){var i=t.addLink(r.get(n.source),r.get(n.target));u&&t.linkMap.set(i,n)}}),t},linearize:function(n){return o.Utils.linearize(this,n)},depthFirstTraversal:function(n,t){if(i.isUndefined(n))throw"You need to supply a starting node.";if(i.isUndefined(t))throw"You need to supply an action.";if(!this.hasNode(n))throw"The given start-node is not part of this graph";var r=this.getNode(n);this._dftIterator(r,t,[])},_dftIterator:function(n,t,i){var u,r,o,f;for(t(n),i.push(n),u=n.getChildren(),r=0,o=u.length;r<o;r++)(f=u[r],e(i,f))||this._dftIterator(f,t,i)},breadthFirstTraversal:function(n,t){var u,s,f,c,o;if(i.isUndefined(n))throw"You need to supply a starting node.";if(i.isUndefined(t))throw"You need to supply an action.";if(!this.hasNode(n))throw"The given start-node is not part of this graph";var l=this.getNode(n),r=new rt,h=[];for(r.enqueue(l);r.length>0;)for(u=r.dequeue(),t(u),h.push(u),s=u.getChildren(),f=0,c=s.length;f<c;f++)(o=s[f],e(h,o)||e(r,o))||r.enqueue(o)},_stronglyConnectedComponents:function(n,t,i,r,u,f,o){var l,s,h,a,c;for(i.add(t,o),r.add(t,o),o++,f.push(t),l=t.getChildren(),h=0,a=l.length;h<a;h++)s=l[h],i.containsKey(s)?e(f,s)&&r.add(t,Math.min(r.get(t),i.get(s))):(this._stronglyConnectedComponents(n,s,i,r,u,f,o),r.add(t,Math.min(r.get(t),r.get(s))));if(r.get(t)===i.get(t)){c=[];do s=f.pop(),c.push(s);while(s!==t);(!n||c.length>1)&&u.push(c)}},findCycles:function(n){var t,e,r;i.isUndefined(n)&&(n=!0);var u=new h,o=new h,f=[],s=[];for(t=0,e=this.nodes.length;t<e;t++)(r=this.nodes[t],u.containsKey(r))||this._stronglyConnectedComponents(n,r,u,o,f,s,0);return f},isAcyclic:function(){return i.isEmpty(this.findCycles())},isSubGraph:function(n){var t=n.linearize(),r=this.linearize();return i.all(t,function(n){return e(r,n)})},makeAcyclic:function(){var g,st,ht,v,ct,nt,lt,e,tt,r,u,o,it,w,rt,ut,b,ft,s,at,c,k,et,l,d,a,ot;if(this.isEmpty()||this.nodes.length<=1||this.links.length<=1)return[];if(this.nodes.length==2){if(g=[],this.links.length>1)for(st=this.links[0],ht=st.source,v=0,ct=this.links.length;v<ct;v++)(nt=this.links[v],nt.source!=ht)&&(lt=nt.reverse(),g.push(lt));return g}var f=this.clone(!0),t=this.nodes.length,n=new h,y=function(n){return n.outgoing.length===0?2-t:n.incoming.length===0?t-2:n.outgoing.length-n.incoming.length},p=function(n,i){var r=y(n,t);i.containsKey(r)||i.set(r,[]);i.get(r).push(n)};for(i.forEach(f.nodes,function(t){p(t,n)}),e=[],tt=[];f.nodes.length>0;){if(n.containsKey(2-t))for(it=n.get(2-t);it.length>0;){for(u=it.pop(),w=0;w<u.links.length;w++)rt=u.links[w],r=rt.getComplement(u),o=y(r,t),i.remove(n.get(o),r),r.removeLink(rt),p(r,n);i.remove(f.nodes,u);tt.unshift(u)}if(n.containsKey(t-2))for(ut=n.get(t-2);ut.length>0;){for(r=ut.pop(),b=0;b<r.links.length;b++)ft=r.links[b],u=ft.getComplement(r),o=y(u,t),i.remove(n.get(o),u),u.removeLink(ft),p(u,n);e.push(r);i.remove(f.nodes,r)}if(f.nodes.length>0)for(s=t-3;s>2-t;s--)if(n.containsKey(s)&&n.get(s).length>0){for(at=n.get(s),c=at.pop(),k=0;k<c.links.length;k++)et=c.links[k],l=et.getComplement(c),o=y(l,t),i.remove(n.get(o),l),l.removeLink(et),p(l,n);e.push(c);i.remove(f.nodes,c);break}}for(e=e.concat(tt),d=new h,a=0;a<this.nodes.length;a++)d.set(f.nodeMap.get(e[a]),a);return ot=[],i.forEach(this.links,function(n){d.get(n.source)>d.get(n.target)&&(n.reverse(),ot.push(n))}),ot}});o.Predefined={EightGraph:function(){return o.Utils.parse(["1->2","2->3","3->4","4->1","3->5","5->6","6->7","7->3"])},Mindmap:function(){return o.Utils.parse(["0->1","0->2","0->3","0->4","0->5","1->6","1->7","7->8","2->9","9->10","9->11","3->12","12->13","13->14","4->15","4->16","15->17","15->18","18->19","18->20","14->21","14->22","5->23","23->24","23->25","6->26"])},ThreeGraph:function(){return o.Utils.parse(["1->2","2->3","3->1"])},BinaryTree:function(n){return i.isUndefined(n)&&(n=5),o.Utils.createBalancedTree(n,2)},Linear:function(n){return i.isUndefined(n)&&(n=10),o.Utils.createBalancedTree(n,1)},Tree:function(n,t){return o.Utils.createBalancedTree(n,t)},Forest:function(n,t,i){return o.Utils.createBalancedForest(n,t,i)},Workflow:function(){return o.Utils.parse(["0->1","1->2","2->3","1->4","4->3","3->5","5->6","6->3","6->7","5->4"])},Grid:function(n,t){var i=new l.Graph,r,e,u,f,o;if(n<=0&&t<=0)return i;for(r=0;r<n+1;r++)for(e=null,u=0;u<t+1;u++)f=new c(r.toString()+"."+u.toString()),i.addNode(f),e&&i.addLink(e,f),r>0&&(o=i.getNode((r-1).toString()+"."+u.toString()),i.addLink(o,f)),e=f;return i}};o.Utils={parse:function(n){for(var t,f,r,o=new l.Graph,s=n.slice(),e=0,h=s.length;e<h;e++){if(t=s[e],i.isString(t)){if(t.indexOf("->")<0)throw"The link should be specified as 'a->b'.";if(f=t.split("->"),f.length!=2)throw"The link should be specified as 'a->b'.";r=new b(f[0],f[1]);o.addLink(r)}if(i.isObject(t)){if(!r)throw"Specification found before Link definition.";u.deepExtend(r,t)}}return o},linearize:function(n,t){var r,u,e,f;if(i.isUndefined(n))throw"Expected an instance of a Graph object in slot one.";for(i.isUndefined(t)&&(t=!1),r=[],u=0,e=n.links.length;u<e;u++)f=n.links[u],r.push(f.source.id+"->"+f.target.id),t&&r.push({id:f.id});return r},_addShape:function(n,t,r,f){return i.isUndefined(t)&&(t=new l.Point(0,0)),i.isUndefined(r)&&(r=p()),f=u.deepExtend({width:20,height:20,id:r,radius:10,fill:"#778899",data:"circle",undoable:!1,x:t.x,y:t.y},f),n.addShape(f)},_addConnection:function(n,t,i,r){return n.connect(t,i,r)},createDiagramFromGraph:function(n,t,e,o){var a,g,v,b,h,y,p,k,d,nt,w;if(i.isUndefined(n))throw"The diagram surface is undefined.";if(i.isUndefined(t))throw"No graph specification defined.";i.isUndefined(e)&&(e=!0);i.isUndefined(o)&&(o=!1);var tt=n.element.clientWidth||200,it=n.element.clientHeight||200,l=[],s,c;for(a=0,g=t.nodes.length;a<g;a++)s=t.nodes[a],v=s.position,i.isUndefined(v)&&(v=i.isDefined(s.x)&&i.isDefined(s.y)?new r(s.x,s.y):new r(i.randomInteger(10,tt-20),i.randomInteger(10,it-20))),b={},s.id==="0"||o&&u.deepExtend(b,{width:Math.random()*150+20,height:Math.random()*80+50,data:"rectangle",fill:{color:"#778899"}}),c=this._addShape(n,v,s.id,b),h=c.bounds(),i.isDefined(h)&&(s.x=h.x,s.y=h.y,s.width=h.width,s.height=h.height),l[s.id]=c;for(y=0;y<t.links.length;y++)(p=t.links[y],k=l[p.source.id],i.isUndefined(k))||(d=l[p.target.id],i.isUndefined(d))||this._addConnection(n,k,d,{id:p.id});if(e)for(nt=new n.SpringLayout(n),nt.layoutGraph(t,{limitToView:!1}),w=0;w<t.nodes.length;w++)s=t.nodes[w],c=l[s.id],c.bounds(new f(s.x,s.y,s.width,s.height))},createBalancedTree:function(n,t){var f,s,e,y,h,a;i.isUndefined(n)&&(n=3);i.isUndefined(t)&&(t=3);var r=new l.Graph,v=-1,u=[],o;if(n<=0||t<=0)return r;for(f=new c((++v).toString()),r.addNode(f),r.root=f,u.push(f),s=0;s<n;s++){for(o=[],e=0;e<u.length;e++)for(y=u[e],h=0;h<t;h++)a=new c((++v).toString()),r.addLink(y,a),o.push(a);u=o}return r},createBalancedForest:function(n,t,r){var s,h,a,e,w,v,y;i.isUndefined(n)&&(n=3);i.isUndefined(t)&&(t=3);i.isUndefined(r)&&(r=5);var u=new l.Graph,p=-1,f=[],o;if(n<=0||t<=0||r<=0)return u;for(s=0;s<r;s++)for(h=new c((++p).toString()),u.addNode(h),f=[h],a=0;a<n;a++){for(o=[],e=0;e<f.length;e++)for(w=f[e],v=0;v<t;v++)y=new c((++p).toString()),u.addLink(w,y),o.push(y);f=o}return u},createRandomConnectedGraph:function(n,t,r){var u,a,v,f,s,y,p,h,e,o;if((i.isUndefined(n)&&(n=40),i.isUndefined(t)&&(t=4),i.isUndefined(r)&&(r=!1),u=new l.Graph,a=-1,n<=0)||(v=new c((++a).toString()),u.addNode(v),n===1))return u;if(n>1){for(f=1;f<n;f++){if(s=u.takeRandomNode([],t),!s)break;y=u.addNode(f.toString());u.addLink(s,y)}if(!r&&n>1)for(p=i.randomInteger(1,n),h=0;h<p;h++)e=u.takeRandomNode([],t),o=u.takeRandomNode([],t),e&&o&&!u.areConnected(e,o)&&u.addLink(e,o);return u}},randomDiagram:function(n,t,i,r,f){var e=u.dataviz.diagram.Graph.Utils.createRandomConnectedGraph(t,i,r);o.Utils.createDiagramFromGraph(n,e,!1,f)}};u.deepExtend(l,{init:function(n){u.init(n,l.ui)},Point:r,Intersect:a,Geometry:lt,Rect:f,Size:nt,RectAlign:ht,Matrix:s,MatrixVector:tt,normalVariable:ct,randomId:p,Dictionary:h,HashTable:w,Queue:rt,Set:at,Node:c,Link:b,Graph:o,PathDefiner:ot})}(window.kendo.jQuery),function(n,t){function ri(n){return{x:n.x||0,y:n.y||0,width:n.width||0,height:n.height||0}}function k(n){if(n){var t=n;return fi(t)&&(t={color:t}),t.color&&(t.color=bt(t.color)),t}}function bt(n){return n!=ut?new r.Color(n).toHex():n}function hi(n,t){var i=t.x-n.x,r=t.y-n.y;return f.util.deg(Math.atan2(r,i))}function ui(n,t){for(var f=this.options,e=!1,i,r,u=0;u<t.length;u++)r=t[u],i=n[r],d(i)&&f[r]!==i&&(f[r]=i,e=!0);return e}function a(n,t){return new r.Segment(new o.Point(n,t))}var f=window.kendo,ci=f.Observable,c=f.dataviz.diagram,v=f.Class,e=f.deepExtend,li=f.dataviz,y=c.Point,b=c.Rect,ai=c.RectAlign,p=c.Matrix,rt=c.Utils,vi=rt.isUndefined,d=rt.isNumber,fi=rt.isString,ei=c.MatrixVector,o=f.geometry,r=f.drawing,u=f.util.defined,kt=n.inArray,ut="transparent",g={none:"none",arrowStart:"ArrowStart",filledCircle:"FilledCircle",arrowEnd:"ArrowEnd"},oi=360,l="start",nt="end",ft="width",et="height",ot="x",st="y",vt,yt,ti,pt,wt,ii;c.Markers=g;var tt=v.extend({init:function(n,t){this.x=n;this.y=t},toMatrix:function(){return p.scaling(this.x,this.y)},toString:function(){return f.format("scale({0},{1})",this.x,this.y)},invert:function(){return new tt(1/this.x,1/this.y)}}),w=v.extend({init:function(n,t){this.x=n;this.y=t},toMatrixVector:function(){return new ei(0,0,0,0,this.x,this.y)},toMatrix:function(){return p.translation(this.x,this.y)},toString:function(){return f.format("translate({0},{1})",this.x,this.y)},plus:function(n){this.x+=n.x;this.y+=n.y},times:function(n){this.x*=n;this.y*=n},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){this.Length!==0&&this.times(1/this.length())},invert:function(){return new w(-this.x,-this.y)}}),s=v.extend({init:function(n,t,i){this.x=t||0;this.y=i||0;this.angle=n},toString:function(){return this.x&&this.y?f.format("rotate({0},{1},{2})",this.angle,this.x,this.y):f.format("rotate({0})",this.angle)},toMatrix:function(){return p.rotation(this.angle,this.x,this.y)},center:function(){return new y(this.x,this.y)},invert:function(){return new s(oi-this.angle,this.x,this.y)}});s.create=function(n){return new s(n.angle,n.x,n.y)};s.parse=function(n){var t=n.slice(1,n.length-1).split(","),i=t[0],r=t[1],u=t[2];return new s(i,r,u)};var ht=v.extend({init:function(n,i,r,u,f,e){this.translate=new w(n,i);r!==t&&u!==t&&(this.scale=new tt(r,u));f!==t&&(this.rotate=e?new s(f,e.x,e.y):new s(f))},toString:function(){var n=function(n){return n?n.toString():""};return n(this.translate)+n(this.rotate)+n(this.scale)},render:function(n){n._transform=this;n._renderTransform()},toMatrix:function(){var n=p.unit();return this.translate&&(n=n.times(this.translate.toMatrix())),this.rotate&&(n=n.times(this.rotate.toMatrix())),this.scale&&(n=n.times(this.scale.toMatrix())),n},invert:function(){var r=this.rotate?this.rotate.invert():t,e=r?r.toMatrix():p.unit(),u=this.scale?this.scale.invert():t,o=u?u.toMatrix():p.unit(),i=new y(-this.translate.x,-this.translate.y),f,n;return i=e.times(o).apply(i),f=new w(i.x,i.y),n=new ht,n.translate=f,n.rotate=r,n.scale=u,n}}),it={_setScale:function(){var i=this.options,r=this._originWidth,u=this._originHeight,n=i.width/r,t=i.height/u;d(n)||(n=1);d(t)||(t=1);this._transform.scale=new tt(n,t)},_setTranslate:function(){var n=this.options,t=n.x||0,i=n.y||0;this._transform.translate=new w(t,i)},_initSize:function(){var n=this.options,t=!1;n.autoSize!==!1&&(u(n.width)||u(n.height))&&(this._measure(!0),this._setScale(),t=!0);(u(n.x)||u(n.y))&&(this._setTranslate(),t=!0);t&&this._renderTransform()},_updateSize:function(n){var t=!1;return this.options.autoSize!==!1&&this._diffNumericOptions(n,[ft,et])&&(t=!0,this._measure(!0),this._setScale()),this._diffNumericOptions(n,[ot,st])&&(t=!0,this._setTranslate()),t&&this._renderTransform(),t}},h=v.extend({init:function(n){var t=this;t.options=e({},t.options,n);t.id=t.options.id;t._originSize=b.empty();t._transform=new ht},visible:function(n){return this.drawingContainer().visible(n)},redraw:function(n){n&&n.id&&(this.id=n.id)},position:function(n,t){var i=this.options;if(!u(n))return new y(i.x,i.y);u(t)?(i.x=n,i.y=t):n instanceof y&&(i.x=n.x,i.y=n.y);this._transform.translate=new w(i.x,i.y);this._renderTransform()},rotate:function(n,t){return u(n)&&(this._transform.rotate=new s(n,t.x,t.y),this._renderTransform()),this._transform.rotate||new s(0)},drawingContainer:function(){return this.drawingElement},_renderTransform:function(){var n=this._transform.toMatrix();this.drawingContainer().transform(new o.Matrix(n.a,n.b,n.c,n.d,n.e,n.f))},_hover:function(){},_diffNumericOptions:ui,_measure:function(n){var t,i,r;return!this._measured||n?(i=this._boundingBox()||new o.Rect,r=i.topLeft(),t=new b(r.x,r.y,i.width(),i.height()),this._originSize=t,this._originWidth=t.width,this._originHeight=t.height,this._measured=!0):t=this._originSize,t},_boundingBox:function(){return this.drawingElement.rawBBox()}}),i=h.extend({init:function(n){h.fn.init.call(this,n);n=this.options;n.fill=k(n.fill);n.stroke=k(n.stroke)},options:{stroke:{color:"gray",width:1},fill:{color:ut}},fill:function(n,t){this._fill({color:bt(n),opacity:t})},stroke:function(n,t,i){this._stroke({color:bt(n),width:t,opacity:i})},redraw:function(n){if(n){var t=n.stroke,i=n.fill;t&&this._stroke(k(t));i&&this._fill(k(i));h.fn.redraw.call(this,n)}},_hover:function(n){var u=this.drawingElement,r=this.options,t=r.hover,i;t&&t.fill&&(i=n?k(t.fill):r.fill,u.fill(i.color,i.opacity))},_stroke:function(n){var i=this.options,t;e(i,{stroke:n});n=i.stroke;t=null;n.width>0&&(t={color:n.color,width:n.width,opacity:n.opacity,dashType:n.dashType});this.drawingElement.options.set("stroke",t)},_fill:function(n){var i=this.options,t;e(i,{fill:n});t=i.fill;this.drawingElement.fill(t.color,t.opacity)}}),dt=i.extend({init:function(n){this._textColor(n);i.fn.init.call(this,n);this._font();this._initText();this._initSize()},options:{fontSize:15,fontFamily:"sans-serif",stroke:{width:0},fill:{color:"black"},autoSize:!0},_initText:function(){var n=this.options;this.drawingElement=new r.Text(u(n.text)?n.text:"",new o.Point,{fill:n.fill,font:n.font});this._stroke()},_textColor:function(n){n&&n.color&&e(n,{fill:{color:n.color}})},_font:function(){var n=this.options;n.fontFamily&&u(n.fontSize)?n.font=n.fontSize+"px "+n.fontFamily:delete n.font},content:function(n){return this.drawingElement.content(n)},redraw:function(n){if(n){var t=!1,r=this.options;this._textColor(n);i.fn.redraw.call(this,n);(n.fontFamily||u(n.fontSize))&&(e(r,{fontFamily:n.fontFamily,fontSize:n.fontSize}),this._font(),this.drawingElement.options.set("font",r.font),t=!0);n.text&&(this.content(n.text),t=!0);!this._updateSize(n)&&t&&this._initSize()}}});e(dt.fn,it);var si=i.extend({init:function(n){i.fn.init.call(this,n);this._initPath();this._setPosition()},_setPosition:function(){var n=this.options,t=n.x,i=n.y;(u(t)||u(i))&&this.position(t||0,i||0)},redraw:function(n){n&&(i.fn.redraw.call(this,n),this._diffNumericOptions(n,[ft,et])&&this._drawPath(),this._diffNumericOptions(n,[ot,st])&&this._setPosition())},_initPath:function(){var n=this.options,t=this.drawingElement=new r.Path({fill:n.fill,stroke:n.stroke,closed:!0});this._drawPath()},_drawPath:function(){var r=this.drawingElement,n=ri(this.options),t=n.width,i=n.height;r.segments.elements([a(0,0),a(t,0),a(t,i),a(0,i)])}}),ct=i.extend({init:function(n){i.fn.init.call(this,n);var t=this.options.anchor;this.anchor=new o.Point(t.x,t.y);this.createElement()},options:{stroke:{color:ut,width:0},fill:{color:"black"}},_transformToPath:function(n,t){var i=t.transform();return n&&i&&(n=n.transformCopy(i)),n},redraw:function(n){n&&(n.position&&(this.options.position=n.position),i.fn.redraw.call(this,n))}}),gt=ct.extend({options:{radius:4,anchor:{x:0,y:0}},createElement:function(){var n=this.options;this.drawingElement=new r.Circle(new o.Circle(this.anchor,n.radius),{fill:n.fill,stroke:n.stroke})},positionMarker:function(n){var u=this.options,f=u.position,t=n.segments,i,r;i=f==l?t[0]:t[t.length-1];i&&(r=this._transformToPath(i.anchor(),n),this.drawingElement.transform(o.transform().translate(r.x,r.y)))}}),ni=ct.extend({options:{path:"M 0 0 L 10 5 L 0 10 L 3 5 z",anchor:{x:10,y:5}},createElement:function(){var n=this.options;this.drawingElement=r.Path.parse(n.path,{fill:n.fill,stroke:n.stroke})},positionMarker:function(n){var f=this._linePoints(n),e=f.start,t=f.end,i=o.transform(),r,u;e&&i.rotate(hi(e,t),t);t&&(r=this.anchor,u=t.clone().translate(-r.x,-r.y),i.translate(u.x,u.y));this.drawingElement.transform(i)},_linePoints:function(n){var o=this.options,r=n.segments,i,u,t,f,e;return o.position==l?(t=r[0],t&&(u=t.anchor(),i=t.controlOut(),f=r[1],!i&&f&&(i=f.anchor()))):(t=r[r.length-1],t&&(u=t.anchor(),i=t.controlIn(),e=r[r.length-2],!i&&e&&(i=e.anchor()))),u?{start:this._transformToPath(i,n),end:this._transformToPath(u,n)}:void 0}}),lt={_getPath:function(n){var t=this.drawingElement;return t instanceof r.MultiPath&&(t=n==l?t.paths[0]:t.paths[t.paths.length-1]),t&&t.segments.length?t:void 0},_removeMarker:function(n){var t=this._markers[n];t&&(this.drawingContainer().remove(t.drawingElement),delete this._markers[n])},_createMarkers:function(){var n=this.options,t=n.startCap,i=n.endCap;this._markers={};this._markers[l]=this._createMarker(t,l);this._markers[nt]=this._createMarker(i,nt)},_createMarker:function(n,t){var u=this._getPath(t),i,r;if(!u){this._removeMarker(t);return}return n==g.filledCircle?i=gt:n==g.arrowStart||n==g.arrowEnd?i=ni:this._removeMarker(t),i?(r=new i({position:t}),r.positionMarker(u),this.drawingContainer().append(r.drawingElement),r):void 0},_positionMarker:function(n){var i=this._markers[n],t;i&&(t=this._getPath(n),t?i.positionMarker(t):this._removeMarker(n))},_capMap:{start:"startCap",end:"endCap"},_redrawMarker:function(n,t,i){var u=this.options,r=this._capMap[t],f=i[r],e=!1;return f&&u[r]!=f?(u[r]=f,this._removeMarker(t),this._markers[t]=this._createMarker(f,t),e=!0):n&&!this._markers[t]&&u[r]&&(this._markers[t]=this._createMarker(u[r],t),e=!0),e},_redrawMarkers:function(n,t){!this._redrawMarker(n,l,t)&&n&&this._positionMarker(l);!this._redrawMarker(n,nt,t)&&n&&this._positionMarker(nt)}},at=i.extend({init:function(n){i.fn.init.call(this,n);this.container=new r.Group;this._createElements();this._initSize()},options:{autoSize:!0},drawingContainer:function(){return this.container},data:function(n){var t=this.options;if(n)t.data!=n&&(t.data=n,this._setData(n),this._initSize(),this._redrawMarkers(!0,{}));else return t.data},redraw:function(n){if(n){i.fn.redraw.call(this,n);var r=this.options,t=n.data;u(t)&&r.data!=t?(r.data=t,this._setData(t),this._updateSize(n)||this._initSize(),this._redrawMarkers(!0,n)):(this._updateSize(n),this._redrawMarkers(!1,n))}},_createElements:function(){var n=this.options;this.drawingElement=r.Path.parse(n.data||"",{fill:n.fill,stroke:n.stroke});this.container.append(this.drawingElement);this._createMarkers()},_setData:function(n){var i=this.drawingElement,t=r.Path.parse(n||""),u=t.paths.slice(0);t.paths.elements([]);i.paths.elements(u)}});e(at.fn,it);e(at.fn,lt);vt=i.extend({init:function(n){i.fn.init.call(this,n);this.container=new r.Group;this._initPath();this._createMarkers()},drawingContainer:function(){return this.container},redraw:function(n){if(n){n=n||{};var t=n.from,r=n.to;t&&(this.options.from=t);r&&(this.options.to=r);t||r?(this._drawPath(),this._redrawMarkers(!0,n)):this._redrawMarkers(!1,n);i.fn.redraw.call(this,n)}},_initPath:function(){var n=this.options,t=this.drawingElement=new r.Path({fill:n.fill,stroke:n.stroke});this._drawPath();this.container.append(t)},_drawPath:function(){var n=this.options,r=this.drawingElement,t=n.from||new y,i=n.to||new y;r.segments.elements([a(t.x,t.y),a(i.x,i.y)])}});e(vt.fn,lt);yt=i.extend({init:function(n){i.fn.init.call(this,n);this.container=new r.Group;this._initPath();this._createMarkers()},drawingContainer:function(){return this.container},points:function(n){var t=this.options;if(n)t.points=n,this._updatePath();else return t.points},redraw:function(n){if(n){var t=n.points;i.fn.redraw.call(this,n);t&&this._pointsDiffer(t)?(this.points(t),this._redrawMarkers(!0,n)):this._redrawMarkers(!1,n)}},_initPath:function(){var n=this.options;this.drawingElement=new r.Path({fill:n.fill,stroke:n.stroke});this.container.append(this.drawingElement);n.points&&this._updatePath()},_pointsDiffer:function(n){var i=this.options.points,r=i.length!==n.length,t;if(!r)for(t=0;t<n.length;t++)if(i[t].x!==n[t].x||i[t].y!==n[t].y){r=!0;break}return r},_updatePath:function(){for(var u=this.drawingElement,f=this.options,i=f.points,r=[],n,t=0;t<i.length;t++)n=i[t],r.push(a(n.x,n.y));u.segments.elements(r)},options:{points:[]}});e(yt.fn,lt);ti=h.extend({init:function(n){h.fn.init.call(this,n);this._initImage()},redraw:function(n){n&&(n.source&&this.drawingElement.src(n.source),this._diffNumericOptions(n,[ft,et,ot,st])&&this.drawingElement.rect(this._rect()),h.fn.redraw.call(this,n))},_initImage:function(){var n=this.options,t=this._rect();this.drawingElement=new r.Image(n.source,t,{})},_rect:function(){var n=ri(this.options),t=new o.Point(n.x,n.y),i=new o.Size(n.width,n.height);return new o.Rect(t,i)}});pt=h.extend({init:function(n){this.children=[];h.fn.init.call(this,n);this.drawingElement=new r.Group;this._initSize()},options:{autoSize:!1},append:function(n){this.drawingElement.append(n.drawingContainer());this.children.push(n);this._childrenChange=!0},remove:function(n){this._remove(n)&&(this._childrenChange=!0)},_remove:function(n){var t=kt(n,this.children);if(t>=0)return this.drawingElement.removeAt(t),this.children.splice(t,1),!0},clear:function(){this.drawingElement.clear();this.children=[];this._childrenChange=!0},toFront:function(n){for(var t,i=0;i<n.length;i++)t=n[i],this._remove(t)&&this.append(t)},toBack:function(n){this._reorderChildren(n,0)},toIndex:function(n,t){this._reorderChildren(n,t)},_reorderChildren:function(n,t){for(var r=this.drawingElement,e=r.children.slice(0),o=this.children,c=d(t),u,s,h,f,i=0;i<n.length;i++)f=n[i],h=f.drawingContainer(),u=kt(f,o),u>=0&&(e.splice(u,1),o.splice(u,1),s=c?t:t[i],e.splice(s,0,h),o.splice(s,0,f));r.clear();r.append.apply(r,e)},redraw:function(n){n&&(this._childrenChange?(this._childrenChange=!1,this._updateSize(n)||this._initSize()):this._updateSize(n),h.fn.redraw.call(this,n))},_boundingBox:function(){for(var u=this.children,n,t,i,r=0;r<u.length;r++)t=u[r],t.visible()&&t._includeInBBox!==!1&&(i=t.drawingContainer().bbox(null),i&&(n=n?b.union(n,i):i));return n}});e(pt.fn,it);wt=i.extend({init:function(n){i.fn.init.call(this,n);this._initCircle();this._initSize()},redraw:function(n){if(n){var t=this.options;n.center&&(e(t,{center:n.center}),this._center.move(t.center.x,t.center.y));this._diffNumericOptions(n,["radius"])&&this._circle.setRadius(t.radius);this._updateSize(n);i.fn.redraw.call(this,n)}},_initCircle:function(){var n=this.options,i=n.width,f=n.height,t=n.radius,e;u(t)||(u(i)||(i=f),u(f)||(f=i),n.radius=t=Math.min(i,f)/2);e=n.center||{x:t,y:t};this._center=new o.Point(e.x,e.y);this._circle=new o.Circle(this._center,t);this.drawingElement=new r.Circle(this._circle,{fill:n.fill,stroke:n.stroke})}});e(wt.fn,it);ii=v.extend({init:function(n,t){t=t||{};this.element=n;this.surface=r.Surface.create(n,t);f.isFunction(this.surface.translate)&&(this.translate=this._translate);this.drawingElement=new r.Group;this._viewBox=new b(0,0,t.width,t.height);this.size(this._viewBox)},bounds:function(){var n=this.drawingElement.bbox();return new b(0,0,n.width(),n.height())},size:function(n){var t=this._viewBox;return u(n)&&(t.width=n.width,t.height=n.height,this.surface.setSize(n)),{width:t.width,height:t.height}},_translate:function(n,t){var i=this._viewBox;return u(n)&&u(t)&&(i.x=n,i.y=t,this.surface.translate({x:n,y:t})),{x:i.x,y:i.y}},draw:function(){this.surface.draw(this.drawingElement)},append:function(n){return this.drawingElement.append(n.drawingContainer()),this},remove:function(n){this.drawingElement.remove(n.drawingContainer())},insertBefore:function(){},clear:function(){this.drawingElement.clear()},destroy:function(t){this.surface.destroy();t&&n(this.element).remove()}});f.deepExtend(c,{init:function(n){f.init(n,c.ui)},diffNumericOptions:ui,Element:h,Scale:tt,Translation:w,Rotation:s,Circle:wt,Group:pt,Rectangle:si,Canvas:ii,Path:at,Line:vt,MarkerBase:ct,ArrowMarker:ni,CircleMarker:gt,Polyline:yt,CompositeTransform:ht,TextBlock:dt,Image:ti,VisualBase:i})}(window.kendo.jQuery),function(n,t){function nt(n,t){n.isSelected?t.ctrlKey&&n.select(!1):n.diagram.select(n,{addToSelection:t.ctrlKey})}function nr(n){return n.ctrlKey===!1&&n.altKey===!1&&n.shiftKey===!1}function tt(n,t){var i=n!==!1;return n.key&&n.key!="none"&&(i=t[n.key+"Key"]),i}function c(n,t){return t.charCodeAt(0)==n||t.toUpperCase().charCodeAt(0)==n}function or(n,t){var i;return n.x==-1&&n.y==-1?i=t.bottomRight():n.x==1&&n.y==1?i=t.topLeft():n.x==-1&&n.y==1?i=t.topRight():n.x==1&&n.y==-1?i=t.bottomLeft():n.x===0&&n.y==-1?i=t.bottom():n.x===0&&n.y==1?i=t.top():n.x==1&&n.y===0?i=t.left():n.x==-1&&n.y===0&&(i=t.right()),i}var s=window.kendo,wt=s.dataviz,u=wt.diagram,r=s.Class,bt=u.Group,lr=u.TextBlock,e=u.Rect,w=u.Rectangle,h=u.Utils,rt=h.isUndefined,i=u.Point,b=u.Circle,ar=u.Path,kt=u.Ticker,f=s.deepExtend,dt=s.ui.Movable,ut=s.support.browser,l=s.util.defined,ft=n.proxy,o={arrow:"default",grip:"pointer",cross:"pointer",add:"pointer",move:"move",select:"pointer",south:"s-resize",east:"e-resize",west:"w-resize",north:"n-resize",rowresize:"row-resize",colresize:"col-resize"},gt=10,v="Top",k="Right",d="Left",y="Bottom",et=[v,k,y,d,"Auto"],ni="itemRotate",g="itemBoundsChange",ti="zoomStart",ii="zoomEnd",ri=-2e4,ui=2e4,fi=.9,ei=.93,oi=5,ot="transparent",si="pan";u.Cursors=o;var hi=s.Class.extend({init:function(n){this.layoutState=n;this.diagram=n.diagram},initState:function(){function n(n,t){var i=this.diagram.getShapeById(n);i&&(this.subjects.push(i),this.froms.push(i.bounds().topLeft()),this.tos.push(t.topLeft()))}this.froms=[];this.tos=[];this.subjects=[];this.layoutState.nodeMap.forEach(n,this)},update:function(n){if(!(this.subjects.length<=0))for(var t=0;t<this.subjects.length;t++)this.subjects[t].position(new i(this.froms[t].x+(this.tos[t].x-this.froms[t].x)*n,this.froms[t].y+(this.tos[t].y-this.froms[t].y)*n))}}),ci=r.extend({init:function(n,t,i){this.animate=rt(i)?!1:i;this._initialState=n;this._finalState=t;this.title="Diagram layout"},undo:function(){this.setState(this._initialState)},redo:function(){this.setState(this._finalState)},setState:function(n){var t=n.diagram,i;if(this.animate){n.linkMap.forEach(function(n,i){var r=t.getShapeById(n);r.visible(!1);r&&r.points(i)});i=new kt;i.addAdapter(new hi(n));i.onComplete(function(){n.linkMap.forEach(function(n){var i=t.getShapeById(n);i.visible(!0)})});i.play()}else n.nodeMap.forEach(function(n,i){var r=t.getShapeById(n);r&&r.position(i.topLeft())}),n.linkMap.forEach(function(n,i){var r=t.getShapeById(n);r&&r.points(i)})}}),st=r.extend({init:function(n){this.units=[];this.title="Composite unit";n!==t&&this.units.push(n)},add:function(n){this.units.push(n)},undo:function(){for(var n=0;n<this.units.length;n++)this.units[n].undo()},redo:function(){for(var n=0;n<this.units.length;n++)this.units[n].redo()}}),li=r.extend({init:function(n,t,i){this.item=n;this._redoSource=t;this._redoTarget=i;this._undoSource=n.source();this._undoTarget=n.target();this.title="Connection Editing"},undo:function(){this._undoSource!==t&&this.item.source(this._undoSource,!1);this._undoTarget!==t&&this.item.target(this._undoTarget,!1);this.item.updateModel(this._undoSource,this._undoTarget)},redo:function(){this._redoSource!==t&&this.item.source(this._redoSource,!1);this._redoTarget!==t&&this.item.target(this._redoTarget,!1);this.item.updateModel(this._undoSource,this._undoTarget)}}),ai=r.extend({init:function(n,t,i){this.item=n;this._undoSource=t;this._undoTarget=i;this._redoSource=n.source();this._redoTarget=n.target();this.title="Connection Editing"},undo:function(){this.item.source(this._undoSource,!1);this.item.target(this._undoTarget,!1);this.item.updateModel(this._undoSource,this._undoTarget)},redo:function(){this.item.source(this._redoSource,!1);this.item.target(this._redoTarget,!1);this.item.updateModel(this._undoSource,this._undoTarget)}}),vi=r.extend({init:function(n){this.connection=n;this.diagram=n.diagram;this.targetConnector=n.targetConnector;this.title="Delete connection"},undo:function(){this.diagram._addConnection(this.connection,!1)},redo:function(){this.diagram._remove(this.connection,!1)}}),yi=r.extend({init:function(n){this.shape=n;this.diagram=n.diagram;this.title="Deletion"},undo:function(){this.diagram._addShape(this.shape,{undoable:!1});this.shape.select(!1)},redo:function(){this.shape.select(!1);this.diagram._remove(this.shape,!1)}}),ht=r.extend({init:function(n,t,i){var r,u;for(this.shapes=n,this.undoStates=t,this.title="Transformation",this.redoStates=[],this.adorner=i,r=0;r<this.shapes.length;r++)u=this.shapes[r],this.redoStates.push(u.bounds())},undo:function(){for(var t,n=0;n<this.shapes.length;n++)t=this.shapes[n],t.bounds(this.undoStates[n]),t.hasOwnProperty("layout")&&t.layout(t,this.redoStates[n],this.undoStates[n]);this.adorner&&(this.adorner.refreshBounds(),this.adorner.refresh())},redo:function(){for(var t,n=0;n<this.shapes.length;n++)t=this.shapes[n],t.bounds(this.redoStates[n]),t.hasOwnProperty("layout")&&t.layout(t,this.undoStates[n],this.redoStates[n]);this.adorner&&(this.adorner.refreshBounds(),this.adorner.refresh())}}),pi=r.extend({init:function(n,t){this.connection=n;this.diagram=t;this.title="New connection"},undo:function(){this.diagram._remove(this.connection,!1)},redo:function(){this.diagram._addConnection(this.connection,!1)}}),wi=r.extend({init:function(n,t){this.shape=n;this.diagram=t;this.title="New shape"},undo:function(){this.diagram.deselect();this.diagram._remove(this.shape,!1)},redo:function(){this.diagram._addShape(this.shape,!1)}}),bi=r.extend({init:function(n,t,i){this.initial=n;this.finalPos=t;this.diagram=i;this.title="Pan Unit"},undo:function(){this.diagram.pan(this.initial)},redo:function(){this.diagram.pan(this.finalPos)}}),ct=r.extend({init:function(n,t,i){var r,u;for(this.shapes=t,this.undoRotates=i,this.title="Rotation",this.redoRotates=[],this.redoAngle=n._angle,this.adorner=n,this.center=n._innerBounds.center(),r=0;r<this.shapes.length;r++)u=this.shapes[r],this.redoRotates.push(u.rotate().angle)},undo:function(){for(var t,n=0;n<this.shapes.length;n++)t=this.shapes[n],t.rotate(this.undoRotates[n],this.center,!1),t.hasOwnProperty("layout")&&t.layout(t);this.adorner&&(this.adorner._initialize(),this.adorner.refresh())},redo:function(){for(var t,n=0;n<this.shapes.length;n++)t=this.shapes[n],t.rotate(this.redoRotates[n],this.center,!1),t.hasOwnProperty("layout")&&t.layout(t);this.adorner&&(this.adorner._initialize(),this.adorner.refresh())}}),ki=r.extend({init:function(n,t,i){this.diagram=n;this.indices=i;this.items=t;this.title="Rotate Unit"},undo:function(){this.diagram._toIndex(this.items,this.indices)},redo:function(){this.diagram.toFront(this.items,!1)}}),di=r.extend({init:function(n,t,i){this.diagram=n;this.indices=i;this.items=t;this.title="Rotate Unit"},undo:function(){this.diagram._toIndex(this.items,this.indices)},redo:function(){this.diagram.toBack(this.items,!1)}}),gi=r.extend({init:function(){this.stack=[];this.index=0;this.capacity=100},begin:function(){this.composite=new st},cancel:function(){this.composite=t},commit:function(){this.composite.units.length>0&&this._restart(this.composite);this.composite=t},addCompositeItem:function(n){this.composite?this.composite.add(n):this.add(n)},add:function(n,t){this._restart(n,t)},count:function(){return this.stack.length},undo:function(){this.index>0&&(this.index--,this.stack[this.index].undo())},redo:function(){this.stack.length>0&&this.index<this.stack.length&&(this.stack[this.index].redo(),this.index++)},_restart:function(n,t){this.stack.splice(this.index,this.stack.length-this.index);this.stack.push(n);rt(t)||t&&t===!0?this.redo():this.index++;this.stack.length>this.capacity&&(this.stack.splice(0,this.stack.length-this.capacity),this.index=this.capacity)},clear:function(){this.stack=[];this.index=0}}),lt=r.extend({init:function(n){this.toolService=n},start:function(){},move:function(){},end:function(){},tryActivate:function(){return!1},getCursor:function(){return o.arrow}});var at=lt.extend({init:function(t){var i=this,o=s.support.mobileOS?ei:fi,f;lt.fn.init.call(i,t);var r=i.toolService.diagram,e=r.canvas,u=r.scroller=i.scroller=n(r.scrollable).kendoMobileScroller({friction:o,velocityMultiplier:oi,mousewheelScrolling:!1,zoom:!1,scroll:ft(i._move,i)}).data("kendoMobileScroller");e.translate&&(i.movableCanvas=new dt(e.element));f=function(n,t,i){n.makeVirtual();n.virtualSize(t||ri,i||ui)};f(u.dimensions.x);f(u.dimensions.y);u.disable()},tryActivate:function(n,t){var r=this.toolService,i=r.diagram.options.pannable,u=t.ctrlKey;return l(i.key)&&(u=i.key&&i.key!="none"?t[i.key+"Key"]&&!(t.ctrlKey&&l(r.hoveredItem)):nr(t)),i!==!1&&u&&!l(r.hoveredAdorner)&&!l(r._hoveredConnector)},start:function(){this.scroller.enable()},move:function(){},_move:function(n){var u=this,r=u.toolService.diagram,f=r.canvas,t=new i(n.scrollLeft,n.scrollTop);f.translate?(r._storePan(t.times(-1)),u.movableCanvas.moveTo(t),f.translate(t.x,t.y)):t=t.plus(r._pan.times(-1));r.trigger(si,{pan:t})},end:function(){this.scroller.disable()},getCursor:function(){return o.move}}),vt=r.extend({init:function(n){this.toolService=n},tryActivate:function(){return!0},start:function(n,t){var u=this.toolService,r=u.diagram,i=u.hoveredItem,f=r.options.selectable;i&&(tt(f,t)&&nt(i,t),i.adorner&&(this.adorner=i.adorner,this.handle=this.adorner._hitTest(n)));this.handle||(this.handle=r._resizingAdorner._hitTest(n),this.handle&&(this.adorner=r._resizingAdorner));this.adorner&&this.adorner.start(n)},move:function(n){var t=this;this.adorner&&this.adorner.move(t.handle,n)},end:function(n,i){var f=this.toolService.diagram,u=this.toolService,r;this.adorner&&(r=this.adorner.stop(),r&&f.undoRedoService.add(r,!1));u.hoveredItem&&this.toolService.triggerClick({item:u.hoveredItem,point:n,meta:i});this.adorner=t;this.handle=t},getCursor:function(n){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(n):o.arrow}}),yt=r.extend({init:function(n){this.toolService=n},tryActivate:function(n,t){var i=this.toolService,r=tt(i.diagram.options.selectable,t);return r&&!l(i.hoveredItem)&&!l(i.hoveredAdorner)},start:function(n){var t=this.toolService.diagram;t.deselect();t.selector.start(n)},move:function(n){var t=this.toolService.diagram;t.selector.move(n)},end:function(n,t){var i=this.toolService.diagram,r=this.toolService.hoveredItem,u=i.selector.bounds();r&&r.isSelected||t.ctrlKey||i.deselect();u.isEmpty()||i.selectArea(u);i.selector.end()},getCursor:function(){return o.arrow}}),tr=r.extend({init:function(n){this.toolService=n;this.type="ConnectionTool"},tryActivate:function(){return this.toolService._hoveredConnector},start:function(n,t){var r=this.toolService.diagram,i=this.toolService._hoveredConnector,u=r.connect(i._c,n);this.toolService._connectionManipulation(u,i._c.shape,!0);this.toolService._removeHover();nt(this.toolService.activeConnection,t)},move:function(n){return this.toolService.activeConnection.target(n),!0},end:function(){var n=this.toolService.activeConnection,i=this.toolService.hoveredItem,t=this.toolService._hoveredConnector;t&&t._c!=n.sourceConnector?n.target(t._c):i&&n.target(i);n.updateModel();this.toolService._connectionManipulation()},getCursor:function(){return o.arrow}}),pt=r.extend({init:function(n){this.toolService=n;this.type="ConnectionTool"},tryActivate:function(n,t){var r=this.toolService,f=r.diagram,e=f.options.selectable,i=r.hoveredItem,u=tt(e,t)&&i&&i.path&&!(i.isSelected&&t.ctrlKey);return u&&(this._c=i),u},start:function(n,t){nt(this._c,t);this.handle=this._c.adorner._hitTest(n);this._c.adorner.start(n)},move:function(n){return this._c.adorner.move(this.handle,n),!0},end:function(n,t){this.toolService.triggerClick({item:this._c,point:n,meta:t});var i=this._c.adorner.stop(n);this.toolService.diagram.undoRedoService.add(i,!1)},getCursor:function(){return o.move}});var ir=r.extend({init:function(n){this.diagram=n;this.tools=[new at(this),new pt(this),new tr(this),new yt(this),new vt(this)];this.activeTool=t},start:function(n,t){return t=f({},t),this.activeTool&&this.activeTool.end(n,t),this._updateHoveredItem(n),this._activateTool(n,t),this.activeTool.start(n,t),this._updateCursor(n),this.diagram.focus(),this.startPoint=n,!0},move:function(n,t){t=f({},t);var i=!0;return this.activeTool&&(i=this.activeTool.move(n,t)),i&&this._updateHoveredItem(n),this._updateCursor(n),!0},end:function(n,i){return i=f({},i),this.activeTool&&this.activeTool.end(n,i),this.activeTool=t,this._updateCursor(n),!0},keyDown:function(n,t){var i=this.diagram;if(t=f({ctrlKey:!1,metaKey:!1,altKey:!1},t),(t.ctrlKey||t.metaKey)&&!t.altKey){if(c(n,"a"))return i.selectAll(),i._destroyToolBar(),!0;if(c(n,"z"))return i.undo(),i._destroyToolBar(),!0;if(c(n,"y"))return i.redo(),i._destroyToolBar(),!0;c(n,"c")?(i.copy(),i._destroyToolBar()):c(n,"x")?(i.cut(),i._destroyToolBar()):c(n,"v")?(i.paste(),i._destroyToolBar()):c(n,"l")?(i.layout(),i._destroyToolBar()):c(n,"d")&&(i._destroyToolBar(),i.copy(),i.paste())}else{if(n===46||n===8)return i.remove(i.select(),!0),i._destroyToolBar(),!0;if(n===27)return this._discardNewConnection(),i.deselect(),i._destroyToolBar(),!0}},wheel:function(n,t){var r=this.diagram,o=t.delta,i=r.zoom(),f=r.options,e=f.zoomRate,u={point:n,meta:t,zoom:i};return r.trigger(ti,u),o<0?i+=e:i-=e,i=s.dataviz.round(Math.max(f.minZoom,Math.min(f.maxZoom,i)),2),u.zoom=i,r.zoom(i,u),r.trigger(ii,u),!0},setTool:function(n,t){n.toolService=this;this.tools[t]=n},triggerClick:function(n){this.startPoint.equals(n.point)&&this.diagram.trigger("click",n)},_discardNewConnection:function(){this.newConnection&&(this.diagram.remove(this.newConnection),this.newConnection=t)},_activateTool:function(n,t){for(var r,i=0;i<this.tools.length;i++)if(r=this.tools[i],r.tryActivate(n,t)){this.activeTool=r;break}},_updateCursor:function(n){var t=this.diagram.element,i=this.activeTool?this.activeTool.getCursor(n):this.hoveredAdorner?this.hoveredAdorner._getCursor(n):this.hoveredItem?this.hoveredItem._getCursor(n):o.arrow;t.css({cursor:i});ut.msie&&ut.version==7&&(t[0].style.cssText=t[0].style.cssText)},_connectionManipulation:function(n,i,r){this.activeConnection=n;this.disabledShape=i;this.newConnection=r?this.activeConnection:t},_updateHoveredItem:function(n){var i=this._hitTest(n);i==this.hoveredItem||this.disabledShape&&i==this.disabledShape||(this.hoveredItem&&this.hoveredItem._hover(!1),i&&i.options.enable?(this.hoveredItem=i,this.hoveredItem._hover(!0)):this.hoveredItem=t)},_removeHover:function(){this.hoveredItem&&(this.hoveredItem._hover(!1),this.hoveredItem=t)},_hitTest:function(n){var i,r=this.diagram,e,f,o;if(this._hoveredConnector&&(this._hoveredConnector._hover(!1),this._hoveredConnector=t),r._connectorsAdorner._visible&&(i=r._connectorsAdorner._hitTest(n),i))return i;if(i=this.diagram._resizingAdorner._hitTest(n),i){if(this.hoveredAdorner=r._resizingAdorner,i.x!==0&&i.y!==0)return;i=t}else this.hoveredAdorner=t;if(!this.activeTool||this.activeTool.type!=="ConnectionTool"){for(o=[],f=0;f<r._selectedItems.length;f++)e=r._selectedItems[f],e instanceof u.Connection&&o.push(e);i=this._hitTestItems(o,n)}return i||this._hitTestItems(r.shapes,n)||this._hitTestItems(r.connections,n)},_hitTestItems:function(n,t){for(var u,r,i=n.length-1;i>=0;i--)if(u=n[i],r=u._hitTest(t),r)return r}}),it=s.Class.extend({init:function(){}}),p=it.extend({init:function(n){var t=this;it.fn.init.call(t);this.connection=n},hitTest:function(n){var t=this.getBounds().inflate(10);return t.contains(n)?u.Geometry.distanceToPolyline(n,this.connection.allPoints())<gt:!1},getBounds:function(){for(var n=this.connection.allPoints(),i=n[0],r=n[n.length-1],o=Math.max(i.x,r.x),u=Math.min(i.x,r.x),f=Math.min(i.y,r.y),s=Math.max(i.y,r.y),t=1;t<n.length-1;++t)o=Math.max(o,n[t].x),u=Math.min(u,n[t].x),f=Math.min(f,n[t].y),s=Math.max(s,n[t].y);return new e(u,f,o-u,s-f)}}),rr=p.extend({init:function(n){var t=this;p.fn.init.call(t);this.connection=n},route:function(){}}),ur=p.extend({init:function(n){var t=this;p.fn.init.call(t);this.connection=n},route:function(){function w(){if(f!==null){if(f===k||f===d)return!0;if(f===v||f===y)return!1}return Math.abs(n.x-e.x)>Math.abs(n.y-e.y)}var o=this.connection,n=this.connection.sourcePoint(),e=this.connection.targetPoint(),t=[n,n,e,e],p=e.x-n.x,c=e.y-n.y,u=t.length,l,a,f=null,s=null,r;if(h.isDefined(o._resolvedSourceConnector)&&(f=o._resolvedSourceConnector.options.name),h.isDefined(o._resolvedTargetConnector)&&(s=o._resolvedTargetConnector.options.name),f!==null&&s!==null&&h.contains(et,f)&&h.contains(et,s))f===v||f==y?s==v||s==y?this.connection.points([new i(n.x,n.y+c/2),new i(e.x,n.y+c/2)]):this.connection.points([new i(n.x,n.y+c)]):s==d||s==k?this.connection.points([new i(n.x+p/2,n.y),new i(n.x+p/2,n.y+c)]):this.connection.points([new i(e.x,n.y)]);else{for(this.connection.cascadeStartHorizontal=w(this.connection),r=1;r<u-1;++r)o.cascadeStartHorizontal?r%2!=0?(l=p/(u/2),a=0):(l=0,a=c/((u-1)/2)):r%2!=0?(l=0,a=c/(u/2)):(l=p/((u-1)/2),a=0),t[r]=new i(t[r-1].x+l,t[r-1].y+a);r--;t[u-2]=o.cascadeStartHorizontal&&r%2!=0||!o.cascadeStartHorizontal&&r%2==0?new i(t[u-1].x,t[u-2].y):new i(t[u-2].x,t[u-1].y);this.connection.points([t[1],t[2]])}}}),a=r.extend({init:function(n,t){var i=this;i.diagram=n;i.options=f({},i.options,t);i.visual=new bt;i.diagram._adorners.push(i)},refresh:function(){}}),fr=a.extend({init:function(n,t){var i=this,r,u,e;i.connection=n;r=i.connection.diagram;i._ts=r.toolService;a.fn.init.call(i,r,t);u=i.connection.sourcePoint();e=i.connection.targetPoint();i.spVisual=new b(f(i.options.handles,{center:u}));i.epVisual=new b(f(i.options.handles,{center:e}));i.visual.append(i.spVisual);i.visual.append(i.epVisual)},options:{handles:{}},_getCursor:function(){return o.move},start:function(n){this.handle=this._hitTest(n);this.startPoint=n;this._initialSource=this.connection.source();this._initialTarget=this.connection.target();switch(this.handle){case-1:this.connection.targetConnector&&this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);break;case 1:this.connection.sourceConnector&&this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape)}},move:function(n,t){switch(n){case-1:this.connection.source(t);break;case 1:this.connection.target(t);break;default:var i=t.minus(this.startPoint);this.startPoint=t;this.connection.sourceConnector||this.connection.source(this.connection.sourcePoint().plus(i));this.connection.targetConnector||this.connection.target(this.connection.targetPoint().plus(i))}return this.refresh(),!0},stop:function(n){var i=this.diagram.toolService,r=i.hoveredItem,f;return f=i._hoveredConnector?i._hoveredConnector._c:r&&r instanceof u.Shape?r:n,this.handle===-1?this.connection.source(f):this.handle===1&&this.connection.target(f),this.handle&&this.connection.updateModel(),this.handle=t,this._ts._connectionManipulation(),new ai(this.connection,this._initialSource,this._initialTarget)},_hitTest:function(n){var t=this.connection.sourcePoint(),i=this.connection.targetPoint(),r=this.options.handles.width/2,u=this.options.handles.height/2,f=new e(t.x,t.y).inflate(r,u),o=new e(i.x,i.y).inflate(r,u);return f.contains(n)?-1:o.contains(n)?1:0},refresh:function(){this.spVisual.redraw({center:this.diagram.modelToLayer(this.connection.sourcePoint())});this.epVisual.redraw({center:this.diagram.modelToLayer(this.connection.targetPoint())})}}),er=a.extend({init:function(n,t){var i=this;a.fn.init.call(i,n,t);i._refreshHandler=function(n){n.item==i.shape&&i.refresh()}},show:function(n){var t=this,u,i,r;for(t._visible=!0,t.shape=n,t.diagram.bind(g,t._refreshHandler),u=n.connectors.length,t.connectors=[],t.visual.clear(),i=0;i<u;i++)r=new cr(n.connectors[i]),t.connectors.push(r),t.visual.append(r.visual);t.visual.visible(!0);t.refresh()},destroy:function(){var n=this;n.diagram.unbind(g,n._refreshHandler);n.shape=t;n._visible=t;n.visual.visible(!1)},_hitTest:function(n){for(var t,i=0;i<this.connectors.length;i++)if(t=this.connectors[i],t._hitTest(n)){t._hover(!0);this.diagram.toolService._hoveredConnector=t;break}},refresh:function(){if(this.shape){var t=this.shape.bounds();t=this.diagram.modelToLayer(t);this.visual.position(t.topLeft());n.each(this.connectors,function(){this.refresh()})}}});var sr=a.extend({init:function(n,t){var i=this;a.fn.init.call(i,n,t);i._manipulating=!1;i.map=[];i.shapes=[];i._initSelection();i._createHandles();i.redraw();i.diagram.bind("select",function(n){i._initialize(n.selected)});i._refreshHandler=function(){i._internalChange||(i.refreshBounds(),i.refresh())};i._rotatedHandler=function(){i.shapes.length==1&&(i._angle=i.shapes[0].rotate().angle);i._refreshHandler()};i.diagram.bind(g,i._refreshHandler).bind(ni,i._rotatedHandler);i.refreshBounds();i.refresh()},options:{editable:{},selectable:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:ot}},offset:10},_initSelection:function(){var n=this,t=n.diagram,i=t.options.selectable,r=f({},n.options.selectable,i);n.rect=new w(r);n.visual.append(n.rect)},_createHandles:function(){var r=this.options.editable,u,i,n,t;if(r&&r.resize)for(u=r.resize.handles,t=-1;t<=1;t++)for(n=-1;n<=1;n++)(t!==0||n!==0)&&(i=new w(u),i.drawingElement._hover=ft(this._hover,this),this.map.push({x:t,y:n,visual:i}),this.visual.append(i))},bounds:function(n){if(n)this._innerBounds=n.clone(),this._bounds=this.diagram.modelToLayer(n).inflate(this.options.offset,this.options.offset);else return this._bounds},_hitTest:function(n){var t=this.diagram.modelToLayer(n),r=this.options.editable,u,f,e,s=this.map.length,o;if(this._angle&&(t=t.clone().rotate(this._bounds.center(),this._angle)),r&&r.rotate&&this._rotationThumbBounds&&this._rotationThumbBounds.contains(t))return new i(-1,-2);if(r&&r.resize)for(u=0;u<s;u++)if(o=this.map[u],f=new i(o.x,o.y),e=this._getHandleBounds(f),e.offset(this._bounds.x,this._bounds.y),e.contains(t))return f;if(this._bounds.contains(t))return new i(0,0)},_getHandleBounds:function(n){var u=this.options.editable;if(u&&u.resize){var f=u.resize.handles||{},i=f.width,r=f.height,t=new e(0,0,i,r);return n.x<0?t.x=-i/2:n.x===0?t.x=Math.floor(this._bounds.width/2)-i/2:n.x>0&&(t.x=this._bounds.width+1-i/2),n.y<0?t.y=-r/2:n.y===0?t.y=Math.floor(this._bounds.height/2)-r/2:n.y>0&&(t.y=this._bounds.height+1-r/2),t}},_getCursor:function(n){var t=this._hitTest(n),r;if(t&&t.x>=-1&&t.x<=1&&t.y>=-1&&t.y<=1&&this.options.editable&&this.options.editable.resize){if(r=this._angle,r&&(r=360-r,t.rotate(new i(0,0),r),t=new i(Math.round(t.x),Math.round(t.y))),t.x==-1&&t.y==-1)return"nw-resize";if(t.x==1&&t.y==1)return"se-resize";if(t.x==-1&&t.y==1)return"sw-resize";if(t.x==1&&t.y==-1)return"ne-resize";if(t.x===0&&t.y==-1)return"n-resize";if(t.x===0&&t.y==1)return"s-resize";if(t.x==1&&t.y===0)return"e-resize";if(t.x==-1&&t.y===0)return"w-resize"}return this._manipulating?o.move:o.select},_initialize:function(){var n=this,t,r,f=n.diagram.select();for(n.shapes=[],t=0;t<f.length;t++)r=f[t],r instanceof u.Shape&&(n.shapes.push(r),r._rotationOffset=new i);n._angle=n.shapes.length==1?n.shapes[0].rotate().angle:0;n._startAngle=n._angle;n._rotates();n._positions();n.refreshBounds();n.refresh();n.redraw()},_rotates:function(){var n=this,t,i;for(n.initialRotates=[],t=0;t<n.shapes.length;t++)i=n.shapes[t],n.initialRotates.push(i.rotate().angle)},_positions:function(){var n=this,t,i;for(n.initialStates=[],t=0;t<n.shapes.length;t++)i=n.shapes[t],n.initialStates.push(i.bounds())},_hover:function(n,t){var u=this.options.editable;if(u&&u.resize){var e=u.resize.handles,r=e.hover,i=e.stroke,o=e.fill;n&&h.isDefined(r.stroke)&&(i=f({},i,r.stroke));n&&h.isDefined(r.fill)&&(o=r.fill);t.stroke(i.color,i.width,i.opacity);t.fill(o.color,o.opacity)}},start:function(n){var t,i;for(this._sp=n,this._cp=n,this._lp=n,this._manipulating=!0,this._internalChange=!0,this.shapeStates=[],t=0;t<this.shapes.length;t++)i=this.shapes[t],this.shapeStates.push(i.bounds())},redraw:function(){for(var i=this,r,t=i.options.editable,u=t.resize,f=t.rotate,e=t&&u?!0:!1,o=t&&f?!0:!1,n=0;n<this.map.length;n++)r=this.map[n],r.visual.visible(e);i.rotationThumb&&i.rotationThumb.visible(o)},angle:function(n){return l(n)&&(this._angle=n),this._angle},rotate:function(){var r=this._innerBounds.center(),t=this.angle(),n,i;for(this._internalChange=!0,n=0;n<this.shapes.length;n++)i=this.shapes[n],t=(t+this.initialRotates[n]-this._startAngle)%360,i.rotate(t,r);this.refresh()},move:function(n,t){var f,c,l=new i,a=new i,v,p,r,o,w,u,b=0,k,d,g,s,y,nt;if(n.y===-2&&n.x===-1){for(p=this._innerBounds.center(),this._angle=this._truncateAngle(h.findAngle(p,t)),o=0;o<this.shapes.length;o++)r=this.shapes[o],w=(this._angle+this.initialRotates[o]-this._startAngle)%360,r.rotate(w,p),r.hasOwnProperty("layout")&&r.layout(r),this._rotating=!0;this.refresh()}else{if(this.diagram.options.snap.enabled===!0){if(s=this._truncateDistance(t.minus(this._lp)),s.x===0&&s.y===0){this._cp=t;return}f=s;this._lp=new i(this._lp.x+s.x,this._lp.y+s.y)}else f=t.minus(this._cp);for(n.x===0&&n.y===0?(a=l=f,c=!0):(this._angle&&f.rotate(new i(0,0),this._angle),n.x==-1?l.x=f.x:n.x==1&&(a.x=f.x),n.y==-1?l.y=f.y:n.y==1&&(a.y=f.y)),c||(k=or(n,this._innerBounds),d=(this._innerBounds.width+f.x*n.x)/this._innerBounds.width,g=(this._innerBounds.height+f.y*n.y)/this._innerBounds.height),o=0;o<this.shapes.length;o++)r=this.shapes[o],v=r.bounds(),c?u=this._displaceBounds(v,l,a,c):(u=v.clone(),u.scale(d,g,k,this._innerBounds.center(),r.rotate().angle),y=u.center(),y.rotate(v.center(),-this._angle),u=new e(y.x-u.width/2,y.y-u.height/2,u.width,u.height)),u.width>=r.options.minWidth&&u.height>=r.options.minHeight&&(nt=v,r.bounds(u),r.hasOwnProperty("layout")&&r.layout(r,nt,u),r.rotate(r.rotate().angle),b+=1);b==o&&(u=this._displaceBounds(this._innerBounds,l,a,c),this.bounds(u),this.refresh());this._positions()}this._cp=t},_truncatePositionToGuides:function(n){return this.diagram.ruler?this.diagram.ruler.truncatePositionToGuides(n):n},_truncateSizeToGuides:function(n){return this.diagram.ruler?this.diagram.ruler.truncateSizeToGuides(n):n},_truncateAngle:function(n){var t=Math.max(this.diagram.options.snap.angle,5);return this.diagram.options.snap.enabled===!0?Math.floor(n%360/t)*t:n%360},_truncateDistance:function(n){if(n instanceof u.Point)return new u.Point(this._truncateDistance(n.x),this._truncateDistance(n.y));var t=Math.max(this.diagram.options.snap.size,5);return this.diagram.options.snap.enabled===!0?Math.floor(n/t)*t:n},_displaceBounds:function(n,t,i,r){var o=n.topLeft().plus(t),s=n.bottomRight().plus(i),u=e.fromPoints(o,s),f;return r||(f=u.center(),f.rotate(n.center(),-this._angle),u=new e(f.x-u.width/2,f.y-u.height/2,u.width,u.height)),u},stop:function(){var u,n,i,r;if(this._cp!=this._sp)if(this._rotating)u=new ct(this,this.shapes,this.initialRotates),this._rotating=!1;else{if(this.diagram.ruler)for(n=0;n<this.shapes.length;n++)i=this.shapes[n],r=i.bounds(),r=this._truncateSizeToGuides(this._truncatePositionToGuides(r)),i.bounds(r),this.refreshBounds(),this.refresh();for(n=0;n<this.shapes.length;n++)i=this.shapes[n],i.updateModel();u=new ht(this.shapes,this.shapeStates,this)}return this._manipulating=t,this._internalChange=t,this._rotating=t,u},refreshBounds:function(){var n=this.shapes.length==1?this.shapes[0].bounds().clone():this.diagram.boundingBox(this.shapes,!0);this.bounds(n)},refresh:function(){var o=this,u,t,f,r;this.shapes.length>0?(t=this.bounds(),this.visual.visible(!0),this.visual.position(t.topLeft()),n.each(this.map,function(){u=o._getHandleBounds(new i(this.x,this.y));this.visual.position(u.topLeft())}),this.visual.position(t.topLeft()),f=new i(t.width/2,t.height/2),this.visual.rotate(this._angle,f),this.rect.redraw({width:t.width,height:t.height}),this.rotationThumb&&(r=this.options.editable.rotate.thumb,this._rotationThumbBounds=new e(t.center().x,t.y+r.y,0,0).inflate(r.width),this.rotationThumb.redraw({x:t.width/2-r.width/2}))):this.visual.visible(!1)}}),hr=r.extend({init:function(n){var t=n.options.selectable;this.options=f({},this.options,t);this.visual=new w(this.options);this.diagram=n},options:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:ot}},start:function(n){this._sp=this._ep=n;this.refresh();this.diagram._adorn(this,!0)},end:function(){this._sp=this._ep=t;this.diagram._adorn(this,!1)},bounds:function(n){return n&&(this._bounds=n),this._bounds},move:function(n){this._ep=n;this.refresh()},refresh:function(){if(this._sp){var n=e.fromPoints(this.diagram.modelToLayer(this._sp),this.diagram.modelToLayer(this._ep));this.bounds(e.fromPoints(this._sp,this._ep));this.visual.position(n.topLeft());this.visual.redraw({height:n.height+1,width:n.width+1})}}}),cr=r.extend({init:function(n){this.options=f({},n.options);this._c=n;this.visual=new b(this.options);this.refresh()},_hover:function(n){var i=this.options,t=i.hover,r=i.stroke,u=i.fill;n&&h.isDefined(t.stroke)&&(r=f({},r,t.stroke));n&&h.isDefined(t.fill)&&(u=t.fill);this.visual.redraw({stroke:r,fill:u})},refresh:function(){var n=this._c.shape.diagram.modelToView(this._c.position()),t=n.minus(this._c.shape.bounds("transformed").topLeft()),r=new e(n.x,n.y,0,0);r.inflate(this.options.width/2,this.options.height/2);this._visualBounds=r;this.visual.redraw({center:new i(t.x,t.y)})},_hitTest:function(n){var t=this._c.shape.diagram.modelToView(n);return this._visualBounds.contains(t)}});f(u,{CompositeUnit:st,TransformUnit:ht,PanUndoUnit:bi,AddShapeUnit:wi,AddConnectionUnit:pi,DeleteShapeUnit:yi,DeleteConnectionUnit:vi,ConnectionEditAdorner:fr,UndoRedoService:gi,ResizingAdorner:sr,Selector:hr,ToolService:ir,ConnectorsAdorner:er,LayoutUndoUnit:ci,ConnectionEditUnit:li,ToFrontUnit:ki,ToBackUnit:di,ConnectionRouterBase:it,PolylineRouter:rr,CascadingRouter:ur,SelectionTool:yt,ScrollerTool:at,PointerTool:vt,ConnectionEditTool:pt,RotateUnit:ct})}(window.kendo.jQuery),function(n){var e=window.kendo,u=e.dataviz.diagram,w=u.Graph,y=u.Node,p=u.Link,k=e.deepExtend,o=u.Size,f=u.Rect,i=u.Dictionary,c=u.Set,d=u.Graph,t=u.Utils,r=u.Point,a=1e-6,b=Math.PI/180,s=t.contains,l=n.grep,h=e.Class.extend({defaultOptions:{type:"Tree",subtype:"Down",roots:null,animate:!1,limitToView:!1,friction:.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:!1,ignoreContainers:!0,layoutContainerChildren:!1,ignoreInvisible:!0,animateTransitions:!1},init:function(){},gridLayoutComponents:function(n){var u,h,f,e;if(!n)throw"No components supplied.";t.forEach(n,function(n){n.calcBounds()});n.sort(function(n,t){return t.bounds.width-n.bounds.width});for(var y=this.options.grid.width,p=this.options.grid.componentSpacingX,w=this.options.grid.componentSpacingY,o=0,c=this.options.grid.offsetX,b=this.options.grid.offsetY,s=c,l=b,i,a=[],v=[];n.length>0;){for(s>=y&&(s=c,l+=o+w,o=0),u=n.pop(),this.moveToOffset(u,new r(s,l)),i=0;i<u.nodes.length;i++)v.push(u.nodes[i]);for(i=0;i<u.links.length;i++)a.push(u.links[i]);h=u.bounds;f=h.height;(f<=0||isNaN(f))&&(f=0);e=h.width;(e<=0||isNaN(e))&&(e=0);f>=o&&(o=f);s+=e+p}return{nodes:v,links:a}},moveToOffset:function(n,t){for(var e,h=n.bounds,c=t.x-h.x,l=t.y-h.y,a,i,o,v,y,s,u=0;u<n.nodes.length;u++)a=n.nodes[u],i=a.bounds(),i.width===0&&i.height===0&&i.x===0&&i.y===0&&(i=new f(0,0,0,0)),i.x+=c,i.y+=l,a.bounds(i);for(u=0;u<n.links.length;u++)if(o=n.links[u],o.points){for(v=[],y=o.points,e=0;e<y.length;e++)s=y[e],s.x+=c,s.y+=l,v.push(s);o.points=v}return this.currentHorizontalOffset+=h.width+this.options.grid.offsetX,new r(c,l)},transferOptions:function(n){(this.options=e.deepExtend({},this.defaultOptions),t.isUndefined(n))||(this.options=e.deepExtend(this.options,n||{}))}}),v=e.Class.extend({init:function(n){this.nodeMap=new i;this.shapeMap=new i;this.nodes=[];this.edges=[];this.edgeMap=new i;this.finalNodes=[];this.finalLinks=[];this.ignoredConnections=[];this.ignoredShapes=[];this.hyperMap=new i;this.hyperTree=new w;this.finalGraph=null;this.diagram=n},convert:function(n){if(t.isUndefined(this.diagram))throw"No diagram to convert.";return this.options=e.deepExtend({ignoreInvisible:!0,ignoreContainers:!0,layoutContainerChildren:!1},n||{}),this.clear(),this._renormalizeShapes(),this._renormalizeConnections(),this.finalNodes=new i(this.nodes),this.finalLinks=new i(this.edges),this.finalGraph=new w,this.finalNodes.forEach(function(n){this.finalGraph.addNode(n)},this),this.finalLinks.forEach(function(n){this.finalGraph.addExistingLink(n)},this),this.finalGraph},mapConnection:function(n){return this.edgeMap.first(function(t){return s(this.edgeMap.get(t),n)})},mapShape:function(n){for(var i,r=this.nodeMap.keys(),t=0,u=r.length;t<u;t++)if(i=r[t],s(this.nodeMap.get(i),n))return i},getEdge:function(n,i){return t.first(n.links,function(t){return t.getComplement(n)===i})},clear:function(){this.finalGraph=null;this.hyperTree=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new d:null;this.hyperMap=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new i:null;this.nodeMap=new i;this.shapeMap=new i;this.nodes=[];this.edges=[];this.edgeMap=new i;this.ignoredConnections=[];this.ignoredShapes=[];this.finalNodes=[];this.finalLinks=[]},listToRoot:function(n){var i=[],t=n.container;if(!t)return i;for(i.push(t);t.parentContainer;)t=t.parentContainer,i.push(t);return i.reverse(),i},firstNonIgnorableContainer:function(n){return n.isContainer&&!this._isIgnorableItem(n)?n:n.parentContainer?this.firstNonIgnorableContainer(n.parentContainer):null},isContainerConnection:function(n,t){return n.isContainer&&this.isDescendantOf(n,t)?!0:t.isContainer&&this.isDescendantOf(t,n)},isDescendantOf:function(n,t){var u,i,f,r;if(!n.isContainer)throw"Expecting a container.";if(n===t)return!1;if(s(n.children,t))return!0;for(u=[],i=0,f=n.children.length;i<f;i++)r=n.children[i],r.isContainer&&this.isDescendantOf(r,t)&&u.push(r);return u.length>0},isIgnorableItem:function(n){return this.options.ignoreInvisible?n.isCollapsed&&this._isVisible(n)?!1:!n.isCollapsed&&this._isVisible(n)?!1:!0:n.isCollapsed&&!this._isTop(n)},isShapeMapped:function(n){return n.isCollapsed&&!this._isVisible(n)&&!this._isTop(n)},leastCommonAncestor:function(n,i){if(!n)throw"Parameter should not be null.";if(!i)throw"Parameter should not be null.";if(!this.hyperTree)throw"No hypertree available.";var u=this.listToRoot(n),f=this.listToRoot(i),e=null;if(t.isEmpty(u)||t.isEmpty(f))return this.hyperTree.root.data;for(var o=u[0],s=f[0],r=0;o===s;){if(e=u[r],r++,r>=u.length||r>=f.length)break;o=u[r];s=f[r]}return e?l(this.hyperTree.nodes,function(n){return n.data.container===e}):this.hyperTree.root.data},_isTop:function(n){return!n.parentContainer},_isVisible:function(n){return n.visible()?n.parentContainer?this._isVisible(n.parentContainer):n.visible():!1},_isCollapsed:function(n){return n.isContainer&&n.isCollapsed?!0:n.parentContainer&&this._isCollapsed(n.parentContainer)},_renormalizeShapes:function(){var t,r,n,i;if(this.options.ignoreContainers)for(t=0,r=this.diagram.shapes.length;t<r;t++){if(n=this.diagram.shapes[t],this.options.ignoreInvisible&&!this._isVisible(n)||n.isContainer){this.ignoredShapes.push(n);continue}i=new y(n.id,n);i.isVirtual=!1;this.nodeMap.add(i,[n]);this.nodes.push(i)}else throw"Containers are not supported yet, but stay tuned.";},_renormalizeConnections:function(){var f,o,n,t,i,r,u,e;if(this.diagram.connections.length!==0)for(f=0,o=this.diagram.connections.length;f<o;f++){if(n=this.diagram.connections[f],this.isIgnorableItem(n)){this.ignoredConnections.push(n);continue}if(t=n.sourceConnector?n.sourceConnector.shape:null,i=n.targetConnector?n.targetConnector.shape:null,!t||!i){this.ignoredConnections.push(n);continue}if(s(this.ignoredShapes,t)&&!this.shapeMap.containsKey(t)){this.ignoredConnections.push(n);continue}if(s(this.ignoredShapes,i)&&!this.shapeMap.containsKey(i)){this.ignoredConnections.push(n);continue}if(this.shapeMap.containsKey(t)&&(t=this.shapeMap[t]),this.shapeMap.containsKey(i)&&(i=this.shapeMap[i]),r=this.mapShape(t),u=this.mapShape(i),r===u||this.areConnectedAlready(r,u)){this.ignoredConnections.push(n);continue}if(r===null||u===null)throw"A shape was not mapped to a node.";if(this.options.ignoreContainers){if(r.isVirtual||u.isVirtual){this.ignoredConnections.push(n);continue}e=new p(r,u,n.id,n);this.edgeMap.add(e,[n]);this.edges.push(e)}else throw"Containers are not supported yet, but stay tuned.";}},areConnectedAlready:function(n,i){return t.any(this.edges,function(t){return t.source===n&&t.target===i||t.source===i&&t.target===n})}}),g=h.extend({init:function(n){var i=this;if(h.fn.init.call(i),t.isUndefined(n))throw"Diagram is not specified.";this.diagram=n},layout:function(n){var e,f,i,r,o,s;if((this.transferOptions(n),e=new v(this.diagram),f=e.convert(n),!f.isEmpty())&&(i=f.getConnectedComponents(),!t.isEmpty(i))){for(r=0;r<i.length;r++)o=i[r],this.layoutGraph(o,n);return s=this.gridLayoutComponents(i),new u.LayoutState(this.diagram,s)}},layoutGraph:function(n,i){var u,f,r;for(t.isDefined(i)&&this.transferOptions(i),this.graph=n,u=this.options.nodeDistance*9,this.temperature=u,f=this._expectedBounds(),this.width=f.width,this.height=f.height,r=0;r<this.options.iterations;r++)this.refineStage=r>=this.options.iterations*5/6,this.tick(),this.temperature=this.refineStage?u/30:u*(1-r/(2*this.options.iterations))},tick:function(){for(var n,i,t=0;t<this.graph.nodes.length;t++)this._repulsion(this.graph.nodes[t]);for(t=0;t<this.graph.links.length;t++)this._attraction(this.graph.links[t]);for(t=0;t<this.graph.nodes.length;t++){if(n=this.graph.nodes[t],i=Math.sqrt(n.dx*n.dx+n.dy*n.dy),i===0)return;n.x+=Math.min(i,this.temperature)*n.dx/i;n.y+=Math.min(i,this.temperature)*n.dy/i;this.options.limitToView&&(n.x=Math.min(this.width,Math.max(n.width/2,n.x)),n.y=Math.min(this.height,Math.max(n.height/2,n.y)))}},_shake:function(n){var t=Math.random()*this.options.nodeDistance/4,i=Math.random()*2*Math.PI;n.x+=t*Math.cos(i);n.y-=t*Math.sin(i)},_InverseSquareForce:function(n,t,i){var r;if(this.refineStage){var u=t.x-i.x,f=t.y-i.y,e=t.width/2,o=t.height/2,s=i.width/2,h=i.height/2;r=Math.pow(u,2)/Math.pow(e+s+this.options.nodeDistance,2)+Math.pow(f,2)/Math.pow(o+h+this.options.nodeDistance,2)}else r=Math.pow(n,2)/Math.pow(this.options.nodeDistance,2);return r*4/3},_SquareForce:function(n,t,i){return 1/this._InverseSquareForce(n,t,i)},_repulsion:function(n){n.dx=0;n.dy=0;t.forEach(this.graph.nodes,function(t){if(t!==n){while(n.x===t.x&&n.y===t.y)this._shake(t);var i=n.x-t.x,r=n.y-t.y,u=Math.sqrt(i*i+r*r),f=this._SquareForce(u,n,t)*2;n.dx+=i/u*f;n.dy+=r/u*f}},this)},_attraction:function(n){var t=n.target,i=n.source;if(i!==t){while(i.x===t.x&&i.y===t.y)this._shake(t);var r=i.x-t.x,u=i.y-t.y,f=Math.sqrt(r*r+u*u),e=this._InverseSquareForce(f,i,t)*5,o=r/f*e,s=u/f*e;t.dx+=o;t.dy+=s;i.dx-=o;i.dy-=s}},_expectedBounds:function(){var n,i=this.graph.nodes.length,r=1.5,u=4;if(i===0)return n;n=t.fold(this.graph.nodes,function(n,t){var i=t.width*t.height;return i>0?n+Math.sqrt(i):0},0,this);var e=n/i,f=e*Math.ceil(Math.sqrt(i)),o=f*Math.sqrt(r),s=f/Math.sqrt(r);return{width:o*u,height:s*u}}}),nt=e.Class.extend({init:function(n){this.center=null;this.options=n},layout:function(n,t){if(this.graph=n,this.graph.nodes&&this.graph.nodes.length!==0){if(!s(this.graph.nodes,t))throw"The given root is not in the graph.";this.center=t;this.graph.cacheRelationships();this.layoutSwitch()}},layoutLeft:function(n){var u,f,e,t,i,s,h,c;for(this.setChildrenDirection(this.center,"Left",!1),this.setChildrenLayout(this.center,"Default",!1),u=0,f=0,t=0;t<n.length;t++)i=n[t],i.TreeDirection="Left",s=this.measure(i,o.Empty),f=Math.max(f,s.Width),u+=s.height+this.options.verticalSeparation;for(u-=this.options.verticalSeparation,h=this.center.x-this.options.horizontalSeparation,e=this.center.y+(this.center.height-u)/2,t=0;t<n.length;t++)i=n[t],c=new r(h-i.Size.width,e),this.arrange(i,c),e+=i.Size.height+this.options.verticalSeparation},layoutRight:function(n){var u,f,e,t,i,s,h,c;for(this.setChildrenDirection(this.center,"Right",!1),this.setChildrenLayout(this.center,"Default",!1),u=0,f=0,t=0;t<n.length;t++)i=n[t],i.TreeDirection="Right",s=this.measure(i,o.Empty),f=Math.max(f,s.Width),u+=s.height+this.options.verticalSeparation;for(u-=this.options.verticalSeparation,h=this.center.x+this.options.horizontalSeparation+this.center.width,e=this.center.y+(this.center.height-u)/2,t=0;t<n.length;t++)i=n[t],c=new r(h,e),this.arrange(i,c),e+=i.Size.height+this.options.verticalSeparation},layoutUp:function(n){var u,e,i,t,s,f,h;for(this.setChildrenDirection(this.center,"Up",!1),this.setChildrenLayout(this.center,"Default",!1),u=0,t=0;t<n.length;t++)i=n[t],i.TreeDirection="Up",s=this.measure(i,o.Empty),u+=s.width+this.options.horizontalSeparation;for(u-=this.options.horizontalSeparation,f=this.center.x+this.center.width/2-u/2,t=0;t<n.length;t++)i=n[t],e=this.center.y-this.options.verticalSeparation-i.Size.height,h=new r(f,e),this.arrange(i,h),f+=i.Size.width+this.options.horizontalSeparation},layoutDown:function(n){var i,t,u,e,s,f,h;for(this.setChildrenDirection(this.center,"Down",!1),this.setChildrenLayout(this.center,"Default",!1),u=0,t=0;t<n.length;t++)i=n[t],i.treeDirection="Down",s=this.measure(i,o.Empty),u+=s.width+this.options.horizontalSeparation;for(u-=this.options.horizontalSeparation,f=this.center.x+this.center.width/2-u/2,e=this.center.y+this.options.verticalSeparation+this.center.height,t=0;t<n.length;t++)i=n[t],h=new r(f,e),this.arrange(i,h),f+=i.Size.width+this.options.horizontalSeparation},layoutRadialTree:function(){this.setChildrenDirection(this.center,"Radial",!1);this.setChildrenLayout(this.center,"Default",!1);this.previousRoot=null;var n=this.options.startRadialAngle*b,t=this.options.endRadialAngle*b;if(t<=n)throw"Final angle should not be less than the start angle.";this.maxDepth=0;this.origin=new r(this.center.x,this.center.y);this.calculateAngularWidth(this.center,0);this.maxDepth>0&&this.radialLayout(this.center,this.options.radialFirstLevelSeparation,n,t);this.center.Angle=t-n},tipOverTree:function(n,i){var f,h,e,u,c,s,l;for(t.isUndefined(i)&&(i=0),this.setChildrenDirection(this.center,"Down",!1),this.setChildrenLayout(this.center,"Default",!1),this.setChildrenLayout(this.center,"Underneath",!1,i),f=0,u=0;u<n.length;u++)e=n[u],e.TreeDirection="Down",c=this.measure(e,o.Empty),f+=c.width+this.options.horizontalSeparation;for(f-=this.options.horizontalSeparation,f-=n[n.length-1].width,f+=n[n.length-1].associatedShape.bounds().width,s=this.center.x+this.center.width/2-f/2,h=this.center.y+this.options.verticalSeparation+this.center.height,u=0;u<n.length;u++)e=n[u],l=new r(s,h),this.arrange(e,l),s+=e.Size.width+this.options.horizontalSeparation},calculateAngularWidth:function(n,t){var r,o,s;t>this.maxDepth&&(this.maxDepth=t);var i=0,u=1e3,f=1e3,e=t===0?0:Math.sqrt(u*u+f*f)/t;if(n.children.length>0){for(r=0,o=n.children.length;r<o;r++)s=n.children[r],i+=this.calculateAngularWidth(s,t+1);i=Math.max(e,i)}else i=e;return n.sectorAngle=i,i},sortChildren:function(n){var v=0,i,f,s,h,e,c,o,l,u,a,y;if(n.parents.length>1)throw"Node is not part of a tree.";if(f=n.parents[0],f&&(s=new r(f.x,f.y),h=new r(n.x,n.y),v=this.normalizeAngle(Math.atan2(s.y-h.y,s.x-h.x))),e=n.children.length,e===0)return null;for(c=[],o=[],i=0;i<e;++i)l=n.children[i],u=new r(l.x,l.y),o[i]=i,c[i]=this.normalizeAngle(-v+Math.atan2(u.y-u.y,u.x-u.x));for(t.bisort(c,o),a=[],y=n.children,i=0;i<e;++i)a.push(y[o[i]]);return a},normalizeAngle:function(n){while(n>Math.PI*2)n-=2*Math.PI;while(n<0)n+=Math.PI*2;return n},radialLayout:function(n,t,i,r){for(var u=r-i,l=u/2,a=n.sectorAngle,f=0,h=this.sortChildren(n),s=0,v=h.length;s<v;s++){var e=h[s],c=e,o=c.sectorAngle/a;e.children.length>0&&this.radialLayout(e,t+this.options.radialSeparation,i+f*u,i+(f+o)*u);this.setPolarLocation(e,t,i+f*u+o*l);c.angle=o*u;f+=o}},setPolarLocation:function(n,t,i){n.x=this.origin.x+t*Math.cos(i);n.y=this.origin.y+t*Math.sin(i);n.BoundingRectangle=new f(n.x,n.y,n.width,n.height)},setChildrenDirection:function(n,t,i){var r=n.treeDirection;this.graph.depthFirstTraversal(n,function(n){n.treeDirection=t});i||(n.treeDirection=r)},setChildrenLayout:function(n,i,r,u){t.isUndefined(u)&&(u=0);var f=n.childrenLayout;u>0?(this.graph.assignLevels(n),this.graph.depthFirstTraversal(n,function(n){n.level>=u+1&&(n.childrenLayout=i)})):(this.graph.depthFirstTraversal(n,function(n){n.childrenLayout=i}),r||(n.childrenLayout=f))},measure:function(n,i){var u=0,f=0,r,l=new o(0,0),y,e,c;if(!n)throw"";var v=n.associatedShape.bounds(),s=v.width,h=v.height;if(n.parents.length!==1)throw"Node not in a spanning tree.";if(y=n.parents[0],n.treeDirection==="Undefined"&&(n.treeDirection=y.treeDirection),t.isEmpty(n.children))l=new o(Math.abs(s)<a?50:s,Math.abs(h)<a?25:h);else if(n.children.length===1){switch(n.treeDirection){case"Radial":r=this.measure(n.children[0],i);u=s+this.options.radialSeparation*Math.cos(n.AngleToParent)+r.width;f=h+Math.abs(this.options.radialSeparation*Math.sin(n.AngleToParent))+r.height;break;case"Left":case"Right":switch(n.childrenLayout){case"TopAlignedWithParent":break;case"BottomAlignedWithParent":break;case"Underneath":r=this.measure(n.children[0],i);u=s+r.width+this.options.underneathHorizontalOffset;f=h+this.options.underneathVerticalTopOffset+r.height;break;case"Default":r=this.measure(n.children[0],i);u=s+this.options.horizontalSeparation+r.width;f=Math.max(h,r.height);break;default:throw"Unhandled TreeDirection in the Radial layout measuring.";}break;case"Up":case"Down":switch(n.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":r=this.measure(n.children[0],i);u=Math.max(s,r.width+this.options.underneathHorizontalOffset);f=h+this.options.underneathVerticalTopOffset+r.height;break;case"Default":r=this.measure(n.children[0],i);f=h+this.options.verticalSeparation+r.height;u=Math.max(s,r.width);break;default:throw"Unhandled TreeDirection in the Down layout measuring.";}break;default:throw"Unhandled TreeDirection in the layout measuring.";}l=new o(u,f)}else{switch(n.treeDirection){case"Left":case"Right":switch(n.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(u=s,f=h+this.options.underneathVerticalTopOffset,e=0;e<n.children.length;e++)c=n.children[e],r=this.measure(c,i),u=Math.max(u,r.width+this.options.underneathHorizontalOffset),f+=r.height+this.options.underneathVerticalSeparation;f-=this.options.underneathVerticalSeparation;break;case"Default":for(u=s,f=0,e=0;e<n.children.length;e++)c=n.children[e],r=this.measure(c,i),u=Math.max(u,s+this.options.horizontalSeparation+r.width),f+=r.height+this.options.verticalSeparation;f-=this.options.verticalSeparation;break;default:throw"Unhandled TreeDirection in the Right layout measuring.";}break;case"Up":case"Down":switch(n.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(u=s,f=h+this.options.underneathVerticalTopOffset,e=0;e<n.children.length;e++)c=n.children[e],r=this.measure(c,i),u=Math.max(u,r.width+this.options.underneathHorizontalOffset),f+=r.height+this.options.underneathVerticalSeparation;f-=this.options.underneathVerticalSeparation;break;case"Default":for(u=0,f=0,e=0;e<n.children.length;e++)c=n.children[e],r=this.measure(c,i),u+=r.width+this.options.horizontalSeparation,f=Math.max(f,r.height+this.options.verticalSeparation+h);u-=this.options.horizontalSeparation;break;default:throw"Unhandled TreeDirection in the Down layout measuring.";}break;default:throw"Unhandled TreeDirection in the layout measuring.";}l=new o(u,f)}return n.SectorAngle=Math.sqrt(u*u/4+f*f/4),n.Size=l,l},arrange:function(n,i){var u,c,p,o,l,w=n.associatedShape.bounds(),v=w.width,y=w.height,h,s,e;if(t.isEmpty(n.children))n.x=i.x,n.y=i.y,n.BoundingRectangle=new f(i.x,i.y,v,y);else switch(n.treeDirection){case"Left":switch(n.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(e=i,n.x=e.x,n.y=e.y,n.BoundingRectangle=new f(n.x,n.y,n.width,n.height),s=i.y+y+this.options.underneathVerticalTopOffset,u=0;u<o.children.length;u++)o=o.children[u],h=e.x-o.associatedShape.width-this.options.underneathHorizontalOffset,c=new r(h,s),this.arrange(o,c),s+=o.Size.height+this.options.underneathVerticalSeparation;break;case"Default":for(e=new r(i.x+n.Size.width-v,i.y+(n.Size.height-y)/2),n.x=e.x,n.y=e.y,n.BoundingRectangle=new f(n.x,n.y,n.width,n.height),h=e.x-this.options.horizontalSeparation,s=i.y,u=0;u<n.children.length;u++)o=n.children[u],c=new r(h-o.Size.width,s),this.arrange(o,c),s+=o.Size.height+this.options.verticalSeparation;break;default:throw"Unsupported TreeDirection";}break;case"Right":switch(n.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(e=i,n.x=e.x,n.y=e.y,n.BoundingRectangle=new f(n.x,n.y,n.width,n.height),h=i.x+v+this.options.underneathHorizontalOffset,s=i.y+y+this.options.underneathVerticalTopOffset,u=0;u<n.children.length;u++)o=n.children[u],c=new r(h,s),this.arrange(o,c),s+=o.Size.height+this.options.underneathVerticalSeparation;break;case"Default":for(e=new r(i.x,i.y+(n.Size.height-y)/2),n.x=e.x,n.y=e.y,n.BoundingRectangle=new f(n.x,n.y,n.width,n.height),h=i.x+v+this.options.horizontalSeparation,s=i.y,u=0;u<n.children.length;u++)o=n.children[u],c=new r(h,s),this.arrange(o,c),s+=o.Size.height+this.options.verticalSeparation;break;default:throw"Unsupported TreeDirection";}break;case"Up":if(e=new r(i.x+(n.Size.width-v)/2,i.y+n.Size.height-y),n.x=e.x,n.y=e.y,n.BoundingRectangle=new f(n.x,n.y,n.width,n.height),Math.abs(e.x-i.x)<a){for(l=0,u=0;u<n.children.length;u++)p=n.children[u],l+=p.Size.width+this.options.horizontalSeparation;l-=this.options.horizontalSeparation;h=i.x+(v-l)/2}else h=i.x;for(u=0;u<n.children.length;u++)o=n.children[u],s=e.y-this.options.verticalSeparation-o.Size.height,c=new r(h,s),this.arrange(o,c),h+=o.Size.width+this.options.horizontalSeparation;break;case"Down":switch(n.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(e=i,n.x=e.x,n.y=e.y,n.BoundingRectangle=new f(n.x,n.y,n.width,n.height),h=i.x+this.options.underneathHorizontalOffset,s=i.y+y+this.options.underneathVerticalTopOffset,u=0;u<n.children.length;u++)o=n.children[u],c=new r(h,s),this.arrange(o,c),s+=o.Size.height+this.options.underneathVerticalSeparation;break;case"Default":if(e=new r(i.x+(n.Size.width-v)/2,i.y),n.x=e.x,n.y=e.y,n.BoundingRectangle=new f(n.x,n.y,n.width,n.height),Math.abs(e.x-i.x)<a){for(l=0,u=0;u<n.children.length;u++)p=n.children[u],l+=p.Size.width+this.options.horizontalSeparation;l-=this.options.horizontalSeparation;h=i.x+(v-l)/2}else h=i.x;for(u=0;u<n.children.length;u++)o=n.children[u],s=e.y+this.options.verticalSeparation+y,c=new r(h,s),this.arrange(o,c),h+=o.Size.width+this.options.horizontalSeparation;break;default:throw"Unsupported TreeDirection";}break;case"None":break;default:throw"Unsupported TreeDirection";}},layoutSwitch:function(){var r,u,f,e,i,n;if(this.center&&!t.isEmpty(this.center.children)){r=this.options.subtype;t.isUndefined(r)&&(r="Down");n=this.center.children;switch(r.toLowerCase()){case"radial":case"radialtree":this.layoutRadialTree();break;case"mindmaphorizontal":case"mindmap":u=this.center.children;this.center.children.length===1?this.layoutRight(u):(i=n.length/2,f=l(this.center.children,function(r){return t.indexOf(n,r)<i}),e=l(this.center.children,function(r){return t.indexOf(n,r)>=i}),this.layoutLeft(f),this.layoutRight(e));break;case"mindmapvertical":u=this.center.children;this.center.children.length===1?this.layoutDown(u):(i=n.length/2,f=l(this.center.children,function(r){return t.indexOf(n,r)<i}),e=l(this.center.children,function(r){return t.indexOf(n,r)>=i}),this.layoutUp(f),this.layoutDown(e));break;case"right":this.layoutRight(this.center.children);break;case"left":this.layoutLeft(this.center.children);break;case"up":case"bottom":this.layoutUp(this.center.children);break;case"down":case"top":this.layoutDown(this.center.children);break;case"tipover":case"tipovertree":if(this.options.tipOverTreeStartLevel<0)throw"The tip-over level should be a positive integer.";this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel)}}}}),tt=h.extend({init:function(n){var i=this;if(h.fn.init.call(i),t.isUndefined(n))throw"No diagram specified.";this.diagram=n},layout:function(n){var t,i;return this.transferOptions(n),t=new v(this.diagram),this.graph=t.convert(),i=this.layoutComponents(),new u.LayoutState(this.diagram,i)},layoutComponents:function(){var n,e,u,i,o,r,s,f;if(!this.graph.isEmpty()&&(n=this.graph.getConnectedComponents(),!t.isEmpty(n))){for(e=new nt(this.options),u=[],i=0;i<n.length;i++){if(o=n[i],r=this.getTree(o),!r)throw"Failed to find a spanning tree for the component.";s=r.root;f=r.tree;e.layout(f,s);u.push(f)}return this.gridLayoutComponents(u)}},getTree:function(n){var t=null,i,f,u,r,e;if(this.options.roots&&this.options.roots.length>0)for(i=0,f=n.nodes.length;i<f;i++)for(u=n.nodes[i],r=0;r<this.options.roots.length;r++)if(e=this.options.roots[r],e===u.associatedShape){t=u;break}if(!t&&(t=n.root(),!t))throw"Unable to find a root for the tree.";return this.getTreeForRoot(n,t)},getTreeForRoot:function(n,i){var r=n.getSpanningTree(i);return t.isUndefined(r)||r.isEmpty()?null:{tree:r,root:r.root}}}),it=h.extend({init:function(n){var i=this;if(h.fn.init.call(i),t.isUndefined(n))throw"Diagram is not specified.";this.diagram=n},layout:function(n){var e,f,i,r,o,s;if((this.transferOptions(n),e=new v(this.diagram),f=e.convert(n),!f.isEmpty())&&(i=f.getConnectedComponents(),!t.isEmpty(i))){for(r=0;r<i.length;r++)o=i[r],this.layoutGraph(o,n);return s=this.gridLayoutComponents(i),new u.LayoutState(this.diagram,s)}},_initRuntimeProperties:function(){for(var n,t=0;t<this.graph.nodes.length;t++)n=this.graph.nodes[t],n.layer=-1,n.downstreamLinkCount=0,n.upstreamLinkCount=0,n.isVirtual=!1,n.uBaryCenter=0,n.dBaryCenter=0,n.upstreamPriority=0,n.downstreamPriority=0,n.gridPosition=0},_prepare:function(n){for(var o=[],u,v,r,h,e,y,c,p,l,a,w,f=0;f<n.links.length;f++)n.links[f].depthOfDumminess=0;for(r=new i,t.forEach(n.nodes,function(n){n.incoming.length===0&&(r.set(n,0),o.push(n))});o.length>0;)for(h=o.shift(),u=0;u<h.outgoing.length;u++)v=h.outgoing[u],e=v.target,r.containsKey(e)?r.set(e,Math.max(r.get(h)+1,r.get(e))):r.set(e,r.get(h)+1),s(o,e)||o.push(e);for(y=0,r.forEachValue(function(n){y=Math.max(y,n)}),c=[],t.addRange(c,r.keys()),c.sort(function(n,i){var u=r.get(n),f=r.get(i);return t.sign(f-u)}),p=0;p<c.length;++p)if(l=c[p],a=Number.MAX_VALUE,l.outgoing.length!==0){for(f=0;f<l.outgoing.length;++f)v=l.outgoing[f],a=Math.min(a,r.get(v.target));a>1&&r.set(l,a-1)}for(this.layers=[],u=0;u<y+1;u++)this.layers.push([]);for(r.forEach(function(n,t){n.layer=t;this.layers[t].push(n)},this),f=0;f<this.layers.length;f++)for(w=this.layers[f],u=0;u<w.length;u++)w[u].gridPosition=u},layoutGraph:function(n,i){if(t.isUndefined(n))throw"No graph given or graph analysis of the diagram failed.";t.isDefined(i)&&this.transferOptions(i);this.graph=n;n.setItemIndices();var r=n.makeAcyclic();this._initRuntimeProperties();this._prepare(n,i);this._dummify();this._optimizeCrossings();this._swapPairs();this.arrangeNodes();this._moveThingsAround();this._dedummify();t.forEach(r,function(n){n.points&&n.points.reverse()})},setMinDist:function(n,t,i){var r=n.layer,u=n.layerIndex;this.minDistances[r][u]=i},getMinDist:function(n,t){for(var r=0,u=n.layerIndex,f=t.layerIndex,e=n.layer,o=Math.min(u,f),s=Math.max(u,f),i=o;i<s;++i)r+=this.minDistances[e][i];return r},placeLeftToRight:function(n){for(var e,h,c,f,l,a,v,o=new i,r,u,s=0;s<this.layers.length;++s)if(e=n[s],e){for(r=0;r<e.length;r++)u=e[r],o.containsKey(u)||this.placeLeft(u,o,s);for(h=Number.POSITIVE_INFINITY,r=0;r<e.length;r++)u=e[r],c=this.rightSibling(u),c&&this.nodeLeftClass.get(c)!==s&&(h=Math.min(h,o.get(c)-o.get(u)-this.getMinDist(u,c)));if(h===Number.POSITIVE_INFINITY){for(f=[],r=0;r<e.length;r++)for(u=e[r],l=[],t.addRange(l,this.upNodes.get(u)),t.addRange(l,this.downNodes.get(u)),a=0;a<l.length;a++)v=l[a],this.nodeLeftClass.get(v)<s&&f.push(o.get(v)-o.get(u));f.sort();h=f.length===0?0:f.length%2==1?f[this.intDiv(f.length,2)]:(f[this.intDiv(f.length,2)-1]+f[this.intDiv(f.length,2)])/2}for(r=0;r<e.length;r++)u=e[r],o.set(u,o.get(u)+h)}return o},placeRightToLeft:function(n){for(var e,h,c,f,l,a,v,o=new i,r,u,s=0;s<this.layers.length;++s)if(e=n[s],e){for(r=0;r<e.length;r++)u=e[r],o.containsKey(u)||this.placeRight(u,o,s);for(h=Number.NEGATIVE_INFINITY,r=0;r<e.length;r++)u=e[r],c=this.leftSibling(u),c&&this.nodeRightClass.get(c)!==s&&(h=Math.max(h,o.get(c)-o.get(u)+this.getMinDist(c,u)));if(h===Number.NEGATIVE_INFINITY){for(f=[],r=0;r<e.length;r++)for(u=e[r],l=[],t.addRange(l,this.upNodes.get(u)),t.addRange(l,this.downNodes.get(u)),a=0;a<l.length;a++)v=l[a],this.nodeRightClass.get(v)<s&&f.push(o.get(u)-o.get(v));f.sort();h=f.length===0?0:f.length%2==1?f[this.intDiv(f.length,2)]:(f[this.intDiv(f.length,2)-1]+f[this.intDiv(f.length,2)])/2}for(r=0;r<e.length;r++)u=e[r],o.set(u,o.get(u)+h)}return o},_getLeftWing:function(){var n={value:null},t=this.computeClasses(n,1);return this.nodeLeftClass=n.value,t},_getRightWing:function(){var n={value:null},t=this.computeClasses(n,-1);return this.nodeRightClass=n.value,t},computeClasses:function(n,t){for(var h,e,r,l,c,v,u,a,o=0,f=n.value=new i,s=0;s<this.layers.length;++s)for(o=s,h=this.layers[s],e=t===1?0:h.length-1;0<=e&&e<h.length;e+=t)if(r=h[e],f.containsKey(r))o=f.get(r);else if(f.set(r,o),r.isVirtual)for(l=this._nodesInLink(r),c=0;c<l.length;c++)v=l[c],f.set(v,o);for(u=[],a=0;a<this.layers.length;a++)u.push(null);return f.forEach(function(n,t){u[t]===null&&(u[t]=[]);u[t].push(n)}),u},_isVerticalLayout:function(){return this.options.subtype.toLowerCase()==="up"||this.options.subtype.toLowerCase()==="down"||this.options.subtype.toLowerCase()==="vertical"},_isHorizontalLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="left"||this.options.subtype.toLowerCase()==="horizontal"},_isIncreasingLayout:function(){return this.options.subtype.toLowerCase()==="right"||this.options.subtype.toLowerCase()==="down"},_moveThingsAround:function(){function st(n,t){for(var u,i=Number.MIN_VALUE,r=0;r<n.length;++r)u=n[r],i=t._isVerticalLayout()?Math.max(i,u.height):Math.max(i,u.width);return i}for(var n,e,u,r,a,p,h,c,d,w,b,v,l,s,g,nt,y,f=0;f<this.layers.length;++f)u=this.layers[f],u.sort(this._gridPositionComparer);for(this.minDistances=[],f=0;f<this.layers.length;++f)for(u=this.layers[f],this.minDistances[f]=[],r=0;r<u.length;++r)e=u[r],e.layerIndex=r,this.minDistances[f][r]=this.options.nodeDistance,r<u.length-1&&(this.minDistances[f][r]+=this._isVerticalLayout()?(e.width+u[r+1].width)/2:(e.height+u[r+1].height)/2);for(this.downNodes=new i,this.upNodes=new i,t.forEach(this.graph.nodes,function(n){this.downNodes.set(n,[]);this.upNodes.set(n,[])},this),t.forEach(this.graph.links,function(n){var r=n.source,u=n.target,t=null,i=null;r.layer>u.layer?(t=n.source,i=n.target):(i=n.source,t=n.target);this.downNodes.get(i).push(t);this.upNodes.get(t).push(i)},this),this.downNodes.forEachValue(function(n){n.sort(this._gridPositionComparer)},this),this.upNodes.forEachValue(function(n){n.sort(this._gridPositionComparer)},this),f=0;f<this.layers.length-1;++f)for(u=this.layers[f],a=0;a<u.length-1;a++)if((p=u[a],p.isVirtual)&&(h=this.downNodes.get(p)[0],h.isVirtual))for(r=a+1;r<u.length;++r)(e=u[r],e.isVirtual)&&(c=this.downNodes.get(e)[0],c.isVirtual)&&h.gridPosition>c.gridPosition&&(d=h.gridPosition,h.gridPosition=c.gridPosition,c.gridPosition=d,w=h.layerIndex,b=c.layerIndex,this.layers[f+1][w]=c,this.layers[f+1][b]=h,h.layerIndex=b,c.layerIndex=w);var tt=this._getLeftWing(),it=this._getRightWing(),rt=this.placeLeftToRight(tt),ut=this.placeRightToLeft(it),o=new i;for(t.forEach(this.graph.nodes,function(n){o.set(n,(rt.get(n)+ut.get(n))/2)}),v=new i,l=new i,f=0;f<this.layers.length;++f)for(u=this.layers[f],s=-1,g=-1,r=0;r<u.length;++r)e=u[r],v.set(e,0),l.set(e,!1),e.isVirtual&&(s===-1?s=r:s===r-1?s=r:(g=r,v.set(u[s],0),o.get(e)-o.get(u[s])===this.getMinDist(u[s],e)?l.set(u[s],!0):l.set(u[s],!1),s=r));nt=[1,-1];t.forEach(nt,function(t){for(var s,h,c=t===1?0:this.layers.length-1,e=c;0<=e&&e<this.layers.length;e+=t){var u=this.layers[e],f=this._firstVirtualNode(u),r=null,i=null;if(f!==-1)for(r=u[f],i=[],n=0;n<f;n++)i.push(u[n]);else r=null,i=u;if(i.length>0){for(this._sequencer(o,null,r,t,i),n=0;n<i.length-1;++n)this.setMinDist(i[n],i[n+1],o.get(i[n+1])-o.get(i[n]));r&&this.setMinDist(i[i.length-1],r,o.get(r)-o.get(i[i.length-1]))}while(r){if(s=this.nextVirtualNode(u,r),s){if(v.get(r)===t){for(f=r.layerIndex,h=s.layerIndex,i=[],n=f+1;n<h;n++)i.push(u[n]);i.length>0&&this._sequencer(o,r,s,t,i);l.set(r,!0)}}else{for(f=r.layerIndex,i=[],n=f+1;n<u.length;n++)i.push(u[n]);if(i.length>0){for(this._sequencer(o,r,null,t,i),n=0;n<i.length-1;++n)this.setMinDist(i[n],i[n+1],o.get(i[n+1])-o.get(i[n]));this.setMinDist(r,i[0],o.get(i[0])-o.get(r))}}r=s}this.adjustDirections(e,t,v,l)}},this);var ft=this._isIncreasingLayout()?0:this.layers.length-1,et=function(n,t){return t._isIncreasingLayout()?n<t.layers.length:n>=0},ot=this._isIncreasingLayout()?1:-1,k=0;for(n=ft;et(n,this);n+=ot){for(u=this.layers[n],y=st(u,this),r=0;r<u.length;++r)e=u[r],this._isVerticalLayout()?(e.x=o.get(e),e.y=k+y/2):(e.x=k+y/2,e.y=o.get(e));k+=this.options.layerSeparation+y}},adjustDirections:function(n,t,i,r){var h,u,c,f,y,p,e;if(!(n+t<0)&&!(n+t>=this.layers.length)){var o=null,l=null,s=this.layers[n+t];for(h=0;h<s.length;++h)if(u=s[h],u.isVirtual&&(c=this.getNeighborOnLayer(u,n),c.isVirtual)){if(o){var a=r.get(l),v=this.layers[n],w=l.layerIndex,b=c.layerIndex;for(f=w+1;f<b;++f)v[f].isVirtual&&(a=a&&r.get(v[f]));if(a)for(i.set(o,t),y=o.layerIndex,p=u.layerIndex,e=y+1;e<p;++e)s[e].isVirtual&&i.set(s[e],t)}o=u;l=c}}},getNeighborOnLayer:function(n,t){var i=this.upNodes.get(n)[0];return i.layer===t?i:(i=this.downNodes.get(n)[0],i.layer===t)?i:null},_sequencer:function(n,t,i,r,u){if(u.length===1&&this._sequenceSingle(n,t,i,r,u[0]),u.length>1){var e=u.length,f=this.intDiv(e,2);this._sequencer(n,t,i,r,u.slice(0,f));this._sequencer(n,t,i,r,u.slice(f));this.combineSequences(n,t,i,r,u)}},_sequenceSingle:function(n,t,i,r,u){var e=r===-1?this.downNodes.get(u):this.upNodes.get(u),f=e.length;f!==0&&(f%2==1?n.set(u,n.get(e[this.intDiv(f,2)])):n.set(u,(n.get(e[this.intDiv(f,2)-1])+n.get(e[this.intDiv(f,2)]))/2),t&&n.set(u,Math.max(n.get(u),n.get(t)+this.getMinDist(t,u))),i&&n.set(u,Math.min(n.get(u),n.get(i)-this.getMinDist(u,i))))},combineSequences:function(n,t,i,r,u){for(var p=u.length,f=this.intDiv(p,2),c=[],o,s,l,a,v,h,e=0;e<f;++e){for(o=0,l=r===-1?this.downNodes.get(u[e]):this.upNodes.get(u[e]),s=0;s<l.length;++s)a=l[s],n.get(a)>=n.get(u[e])?o++:(o--,c.push({k:n.get(a)+this.getMinDist(u[e],u[f-1]),v:2}));c.push({k:n.get(u[e])+this.getMinDist(u[e],u[f-1]),v:o})}for(t&&c.push({k:n.get(t)+this.getMinDist(t,u[f-1]),v:Number.MAX_VALUE}),c.sort(this._positionDescendingComparer),h=[],e=f;e<p;++e){for(o=0,l=r===-1?this.downNodes.get(u[e]):this.upNodes.get(u[e]),s=0;s<l.length;++s)a=l[s],n.get(a)<=n.get(u[e])?o++:(o--,h.push({k:n.get(a)-this.getMinDist(u[e],u[f]),v:2}));h.push({k:n.get(u[e])-this.getMinDist(u[e],u[f]),v:o})}i&&h.push({k:n.get(i)-this.getMinDist(i,u[f]),v:Number.MAX_VALUE});h.sort(this._positionAscendingComparer);for(var w=0,b=0,y=this.getMinDist(u[f-1],u[f]);n.get(u[f])-n.get(u[f-1])<y;)if(w<b)if(c.length===0){n.set(u[f-1],n.get(u[f])-y);break}else v=c.shift(),w=w+v.v,n.set(u[f-1],v.k),n.set(u[f-1],Math.max(n.get(u[f-1]),n.get(u[f])-y));else if(h.length===0){n.set(u[f],n.get(u[f-1])+y);break}else v=h.shift(),b=b+v.v,n.set(u[f],v.k),n.set(u[f],Math.min(n.get(u[f]),n.get(u[f-1])+y));for(e=f-2;e>=0;e--)n.set(u[e],Math.min(n.get(u[e]),n.get(u[f-1])-this.getMinDist(u[e],u[f-1])));for(e=f+1;e<p;e++)n.set(u[e],Math.max(n.get(u[e]),n.get(u[f])+this.getMinDist(u[e],u[f])))},placeLeft:function(n,i,r){var u=Number.NEGATIVE_INFINITY;t.forEach(this._getComposite(n),function(n){var t=this.leftSibling(n);t&&this.nodeLeftClass.get(t)===this.nodeLeftClass.get(n)&&(i.containsKey(t)||this.placeLeft(t,i,r),u=Math.max(u,i.get(t)+this.getMinDist(t,n)))},this);u===Number.NEGATIVE_INFINITY&&(u=0);t.forEach(this._getComposite(n),function(n){i.set(n,u)})},placeRight:function(n,i,r){var u=Number.POSITIVE_INFINITY;t.forEach(this._getComposite(n),function(n){var t=this.rightSibling(n);t&&this.nodeRightClass.get(t)===this.nodeRightClass.get(n)&&(i.containsKey(t)||this.placeRight(t,i,r),u=Math.min(u,i.get(t)-this.getMinDist(n,t)))},this);u===Number.POSITIVE_INFINITY&&(u=0);t.forEach(this._getComposite(n),function(n){i.set(n,u)})},leftSibling:function(n){var i=this.layers[n.layer],t=n.layerIndex;return t===0?null:i[t-1]},rightSibling:function(n){var t=this.layers[n.layer],i=n.layerIndex;return i===t.length-1?null:t[i+1]},_getComposite:function(n){return n.isVirtual?this._nodesInLink(n):[n]},arrangeNodes:function(){for(var u,t,r,i,o,e,f,n=0;n<this.layers.length;n++)for(r=this.layers[n],t=0;t<r.length;t++)i=r[t],i.upstreamPriority=i.upstreamLinkCount,i.downstreamPriority=i.downstreamLinkCount;for(o=2,e=0;e<o;e++){for(u=this.layers.length-1;u>=1;u--)this.layoutLayer(!1,u);for(u=0;u<this.layers.length-1;u++)this.layoutLayer(!0,u)}for(f=Number.MAX_VALUE,n=0;n<this.layers.length;n++)for(r=this.layers[n],t=0;t<r.length;t++)i=r[t],f=Math.min(f,i.gridPosition);if(f<0)for(n=0;n<this.layers.length;n++)for(r=this.layers[n],t=0;t<r.length;t++)i=r[t],i.gridPosition=i.gridPosition-f},layoutLayer:function(n,i){var r,u,f,e;for(u=n?this.layers[r=i+1]:this.layers[r=i-1],f=[],e=0;e<u.length;e++)f.push(u[e]);f.sort(function(n,t){var i=(n.upstreamPriority+n.downstreamPriority)/2,r=(t.upstreamPriority+t.downstreamPriority)/2;return Math.abs(i-r)<.0001?0:i<r?1:-1});t.forEach(f,function(n){var t=n.gridPosition,i=this.calcBaryCenter(n),r=(n.upstreamPriority+n.downstreamPriority)/2;if(!(Math.abs(t-i)<.0001)&&!(Math.abs(t-i)<.25+.0001))if(t<i)while(t<i){if(!this.moveRight(n,u,r))break;t=n.gridPosition}else while(t>i){if(!this.moveLeft(n,u,r))break;t=n.gridPosition}},this);r>0&&this.calcDownData(r-1);r<this.layers.length-1&&this.calcUpData(r+1)},moveRight:function(n,i,r){var e=t.indexOf(i,n),u,f;return e===i.length-1?(n.gridPosition=n.gridPosition+.5,!0):(u=i[e+1],f=(u.upstreamPriority+u.downstreamPriority)/2,u.gridPosition>n.gridPosition+1)?(n.gridPosition=n.gridPosition+.5,!0):f>r||Math.abs(f-r)<.0001?!1:this.moveRight(u,i,r)?(n.gridPosition=n.gridPosition+.5,!0):!1},moveLeft:function(n,i,r){var e=t.indexOf(i,n),u,f;return e===0?(n.gridPosition=n.gridPosition-.5,!0):(u=i[e-1],f=(u.upstreamPriority+u.downstreamPriority)/2,u.gridPosition<n.gridPosition-1)?(n.gridPosition=n.gridPosition-.5,!0):f>r||Math.abs(f-r)<.0001?!1:this.moveLeft(u,i,r)?(n.gridPosition=n.gridPosition-.5,!0):!1},mapVirtualNode:function(n,t){this.nodeToLinkMap.set(n,t);this.linkToNodeMap.containsKey(t)||this.linkToNodeMap.set(t,[]);this.linkToNodeMap.get(t).push(n)},_nodesInLink:function(n){return this.linkToNodeMap.get(this.nodeToLinkMap.get(n))},_dummify:function(){var u,r,n,a,h,v,f,k,d;for(this.linkToNodeMap=new i,this.nodeToLinkMap=new i,d=this.graph.links.slice(0),k=0;k<d.length;k++){var c=d[k],e=c.source,g=c.target,o=e.layer,s=g.layer,l=e.gridPosition,b=g.gridPosition,nt=(b-l)/Math.abs(s-o),w=e;if(o-s>1){for(f=o-1;f>s;f--){for(n=new y,n.x=e.x,n.y=e.y,n.width=e.width/100,n.height=e.height/100,u=this.layers[f],r=(f-s)*nt+l,r>u.length&&(r=u.length),l>=this.layers[o].length-1&&b>=this.layers[s].length-1?r=u.length:l===0&&b===0&&(r=0),n.layer=f,n.uBaryCenter=0,n.dBaryCenter=0,n.upstreamLinkCount=0,n.downstreamLinkCount=0,n.gridPosition=r,n.isVirtual=!0,t.insert(u,n,r),h=r+1;h<u.length;h++)a=u[h],a.gridPosition=a.gridPosition+1;v=new p(w,n);v.depthOfDumminess=0;w=n;this.graph.nodes.push(n);this.graph.addLink(v);n.index=this.graph.nodes.length-1;this.mapVirtualNode(n,c)}c.changeSource(w);c.depthOfDumminess=o-s-1}if(o-s<-1){for(f=o+1;f<s;f++){for(n=new y,n.x=e.x,n.y=e.y,n.width=e.width/100,n.height=e.height/100,u=this.layers[f],r=(f-o)*nt+l,r>u.length&&(r=u.length),l>=this.layers[o].length-1&&b>=this.layers[s].length-1?r=u.length:l===0&&b===0&&(r=0),n.layer=f,n.uBaryCenter=0,n.dBaryCenter=0,n.upstreamLinkCount=0,n.downstreamLinkCount=0,n.gridPosition=r,n.isVirtual=!0,r&=r,t.insert(u,n,r),h=r+1;h<u.length;h++)a=u[h],a.gridPosition=a.gridPosition+1;v=new p(w,n);v.depthOfDumminess=0;w=n;this.graph.nodes.push(n);this.graph.addLink(v);n.index=this.graph.nodes.length-1;this.mapVirtualNode(n,c)}c.changeSource(w);c.depthOfDumminess=s-o-1}}},_dedummify:function(){for(var f=!0,i,n,t,r,o,e,s,u;f;)for(f=!1,i=0;i<this.graph.links.length;i++)if(n=this.graph.links[i],n.depthOfDumminess!==0){for(t=[],t.unshift({x:n.target.x,y:n.target.y}),t.unshift({x:n.source.x,y:n.source.y}),r=n,o=n.depthOfDumminess,e=0;e<o;e++)s=r.source,u=s.incoming[0],t.unshift({x:u.source.x,y:u.source.y}),r=u;n.changeSource(r.source);n.depthOfDumminess=0;t.length>2?(t.splice(0,1),t.splice(t.length-1),n.points=t):n.points=[];f=!0;break}},_optimizeCrossings:function(){for(var t=-1,n,i=0;t!==0;){if(i++>3)break;for(t=0,n=this.layers.length-1;n>=1;n--)t+=this.optimizeLayerCrossings(!1,n);for(n=0;n<this.layers.length-1;n++)t+=this.optimizeLayerCrossings(!0,n)}},calcUpData:function(n){if(n!==0){for(var s=this.layers[n],i,u,e=new c,h=this.layers[n-1],t=0;t<h.length;t++)e.add(h[t]);for(t=0;t<s.length;t++){var r=s[t],o=0,f=0;for(i=0;i<r.incoming.length;i++)u=r.incoming[i],e.contains(u.source)&&(f++,o+=u.source.gridPosition);for(i=0;i<r.outgoing.length;i++)u=r.outgoing[i],e.contains(u.target)&&(f++,o+=u.target.gridPosition);f>0?(r.uBaryCenter=o/f,r.upstreamLinkCount=f):(r.uBaryCenter=t,r.upstreamLinkCount=0)}}},calcDownData:function(n){if(n!==this.layers.length-1){for(var s=this.layers[n],i,u,e=new c,h=this.layers[n+1],t=0;t<h.length;t++)e.add(h[t]);for(t=0;t<s.length;t++){var r=s[t],o=0,f=0;for(i=0;i<r.incoming.length;i++)u=r.incoming[i],e.contains(u.source)&&(f++,o+=u.source.gridPosition);for(i=0;i<r.outgoing.length;i++)u=r.outgoing[i],e.contains(u.target)&&(f++,o+=u.target.gridPosition);f>0?(r.dBaryCenter=o/f,r.downstreamLinkCount=f):(r.dBaryCenter=t,r.downstreamLinkCount=0)}}},optimizeLayerCrossings:function(n,t){var f,r,o,u,i,e,s,h;for(r=n?this.layers[f=t+1]:this.layers[f=t-1],o=r.slice(0),n?this.calcUpData(f):this.calcDownData(f),u=this,r.sort(function(n,t){var r=u.calcBaryCenter(n),f=u.calcBaryCenter(t),i;return Math.abs(r-f)<.0001?n.degree()===t.degree()?u.compareByIndex(n,t):n.degree()<t.degree()?1:-1:(i=(f-r)*1e3,i>0)?-1:i<0?1:u.compareByIndex(n,t)}),e=0,i=0;i<r.length;i++)r[i]!==o[i]&&e++;if(e>0)for(s=0,i=0;i<r.length;i++)h=r[i],h.gridPosition=s++;return e},_swapPairs:function(){for(var k=this.options.layeredIterations,h=0,o,p,n,t,v,y;;){if(h++>k)break;for(o=h%4<=1,p=h%4==1,n=o?0:this.layers.length-1;o?n<=this.layers.length-1:n>=0;n+=o?1:-1){var i=this.layers[n],w=!1,c=!0,b=0;for(t=0;t<i.length-1;t++){var r=0,u=0,s=0;if(c?(n!==0&&(r=this.countLinksCrossingBetweenTwoLayers(n-1,n)),n!==this.layers.length-1&&(u=this.countLinksCrossingBetweenTwoLayers(n,n+1)),o?r*=2:u*=2,s=r+u):s=b,s!==0){var f=i[t],e=i[t+1],l=f.gridPosition,a=e.gridPosition;i[t]=e;i[t+1]=f;f.gridPosition=a;e.gridPosition=l;r=0;n!==0&&(r=this.countLinksCrossingBetweenTwoLayers(n-1,n));u=0;n!==this.layers.length-1&&(u=this.countLinksCrossingBetweenTwoLayers(n,n+1));o?r*=2:u*=2;v=r+u;y=!1;y=p?v>=s:v>s;y?(f=i[t],e=i[t+1],l=f.gridPosition,a=e.gridPosition,i[t]=e,i[t+1]=f,f.gridPosition=a,e.gridPosition=l,b=s,c=!1):(w=!0,c=!0)}}w&&(n!==this.layers.length-1&&this.calcUpData(n+1),n!==0&&this.calcDownData(n-1))}}},countLinksCrossingBetweenTwoLayers:function(n,i){for(var nt=0,l=new c,tt=this.layers[n],a,p,y,u,s,e,h,o,b,k,d,g,r=0;r<tt.length;r++)l.add(tt[r]);for(a=new c,p=this.layers[i],r=0;r<p.length;r++)a.add(p[r]);var w=new c,f=[],v=[];for(l.forEach(function(n){t.addRange(v,n.incoming);t.addRange(v,n.outgoing)}),y=0;y<v.length;y++)u=v[y],l.contains(u.source)&&a.contains(u.target)?(w.add(u),f.push(u)):a.contains(u.source)&&l.contains(u.target)&&f.push(u);for(s=0;s<f.length;s++)for(e=f[s],h=0;h<f.length;h++)if(s!==h){o=f[h];w.contains(e)?(b=e.source,k=e.target):(b=e.target,k=e.source);w.contains(o)?(d=o.source,g=o.target):(d=o.target,g=o.source);var it=b.gridPosition,rt=k.gridPosition,ut=d.gridPosition,ft=g.gridPosition;(it-ut)*(rt-ft)<0&&nt++}return nt/2},calcBaryCenter:function(n){var t=n.upstreamLinkCount,i=n.downstreamLinkCount,r=n.uBaryCenter,u=n.dBaryCenter;return t>0&&i>0?(r+u)/2:t>0?r:i>0?u:0},_gridPositionComparer:function(n,t){return n.gridPosition<t.gridPosition?-1:n.gridPosition>t.gridPosition?1:0},_positionAscendingComparer:function(n,t){return n.k<t.k?-1:n.k>t.k?1:0},_positionDescendingComparer:function(n,t){return n.k<t.k?1:n.k>t.k?-1:0},_firstVirtualNode:function(n){for(var t=0;t<n.length;t++)if(n[t].isVirtual)return t;return-1},compareByIndex:function(n,t){var i=n.index,r=t.index;return i<r?1:i>r?-1:0},intDiv:function(n,t){return(n-n%t)/t},nextVirtualNode:function(n,t){for(var r=t.layerIndex,i=r+1;i<n.length;++i)if(n[i].isVirtual)return n[i];return null}}),rt=e.Class.extend({init:function(n,r){if(t.isUndefined(n))throw"No diagram given";this.diagram=n;this.nodeMap=new i;this.linkMap=new i;this.capture(r?r:n)},capture:function(n){var i,o,r,t,e,s,h,c,l;if(n instanceof u.Graph){for(t=0;t<n.nodes.length;t++)i=n.nodes[t],r=i.associatedShape,this.nodeMap.set(r.visual.id,new f(i.x,i.y,i.width,i.height));for(t=0;t<n.links.length;t++)s=n.links[t],e=s.associatedConnection,this.linkMap.set(e.visual.id,s.points())}else if(n instanceof Array)for(o=n,t=0;t<o.length;t++)i=o[t],r=i.associatedShape,r&&this.nodeMap.set(r.visual.id,new f(i.x,i.y,i.width,i.height));else if(n.hasOwnProperty("links")&&n.hasOwnProperty("nodes")){for(o=n.nodes,h=n.links,t=0;t<o.length;t++)i=o[t],r=i.associatedShape,r&&this.nodeMap.set(r.visual.id,new f(i.x,i.y,i.width,i.height));for(t=0;t<h.length;t++)s=h[t],e=s.associatedConnection,e&&this.linkMap.set(e.visual.id,s.points)}else{for(c=this.diagram.shapes,l=this.diagram.connections,t=0;t<c.length;t++)r=c[t],this.nodeMap.set(r.visual.id,r.bounds());for(t=0;t<l.length;t++)e=l[t],this.linkMap.set(e.visual.id,e.points())}}});k(u,{init:function(n){e.init(n,u.ui)},SpringLayout:g,TreeLayout:tt,GraphAdapter:v,LayeredLayout:it,LayoutBase:h,LayoutState:rt})}(window.kendo.jQuery),function(n,t){function cu(n){var i=n.originalEvent,t=0;return i.wheelDelta?(t=-i.wheelDelta/40,t=t>0?h.ceil(t):h.floor(t)):i.detail&&(t=i.detail),t}function rt(n){return n.options.name.toLowerCase()===k.toLowerCase()}function lu(n){var l=ri,o,s,t=n.source(),i=n.target(),r,f,c,b=[0,2,3,1,4],a,e;if(t instanceof u?o=t:t instanceof v&&(rt(t)?r=t.shape:(n._resolvedSourceConnector=t,o=t.position())),i instanceof u?s=i:i instanceof v&&(rt(i)?f=i.shape:(n._resolvedTargetConnector=i,s=i.position())),o)f&&(n._resolvedTargetConnector=ut(o,f));else if(r)if(s)n._resolvedSourceConnector=ut(s,r);else if(f)for(e=0;e<r.connectors.length;e++)if(a=r.connectors.length==5?b[e]:e,c=r.connectors[a],!rt(c)){var y=c.position(),p=ut(y,f),w=h.round(p.position().distanceTo(y));w<l&&(l=w,n._resolvedSourceConnector=c,n._resolvedTargetConnector=p)}}function ut(n,t){for(var i,u,f=ri,e,o=t.connectors,r=0;r<o.length;r++)i=o[r],rt(i)||(u=n.distanceTo(i.position()),u<f&&(f=u,e=i));return e}function li(n,t){for(var u=[],f,e=n.drawingContainer().children,o=e.length,i,r=0;r<t.length;r++)for(f=t[r],i=0;i<o;i++)if(e[i]==f.drawingContainer()){u.push(i);break}return u}function au(n){var t={};return n=n||{},r(n.text)&&n.text!==null&&(t.text=n.text),r(n.x)&&n.x!==null&&(t.x=n.x),r(n.y)&&n.y!==null&&(t.y=n.y),r(n.width)&&n.width!==null&&(t.width=n.width),r(n.height)&&n.height!==null&&(t.height=n.height),r(n.type)&&n.type!==null&&(t.type=n.type),t}function vu(n){var t={};return n=n||{},r(n.text)&&n.text!==null&&(t.content=n.text),r(n.type)&&n.type!==null&&(t.type=n.type),r(n.from)&&n.from!==null&&(t.from=n.from),r(n.fromX)&&n.fromX!==null&&(t.fromX=n.fromX),r(n.fromY)&&n.fromY!==null&&(t.fromY=n.fromY),r(n.to)&&n.to!==null&&(t.to=n.to),r(n.toX)&&n.toX!==null&&(t.toX=n.toX),r(n.toY)&&n.toY!==null&&(t.toY=n.toY),t}function pu(t,i){var f=i.model.fields[i.field],r=this.dataSource.reader.model,u=r.fn.fields.text?"text":r.idField;n("<input name='"+i.field+"' />").appendTo(t).kendoDropDownList({dataValueField:r.idField,dataTextField:u,dataSource:this.dataSource.data().toJSON(),optionLabel:" "})}var d=kendo.dataviz,et=kendo.drawing,ot=kendo.geometry,i=d.diagram,st=kendo.ui.Widget,ai=kendo.Class,e=n.proxy,f=kendo.deepExtend,vi=n.extend,yi=kendo.data.HierarchicalDataSource,pi=i.Canvas,ht=i.Group,wu=i.Visual,wt=i.Rectangle,wi=i.Circle,ct=i.CompositeTransform,a=i.Rect,bt=i.Path,bi=i.DeleteShapeUnit,ki=i.DeleteConnectionUnit,kt=i.TextBlock,di=i.Image,u=i.Point,gi=i.Intersect,nr=i.ConnectionEditAdorner,tr=i.UndoRedoService,dt=i.ToolService,ir=i.Selector,rr=i.ResizingAdorner,ur=i.ConnectorsAdorner,fr=i.Cursors,s=i.Utils,gt=kendo.Observable,bu=i.Ticker,er=i.ToBackUnit,or=i.ToFrontUnit,sr=i.Dictionary,hr=i.PolylineRouter,cr=i.CascadingRouter,p=s.isUndefined,y=s.isDefined,r=kendo.util.defined,b=n.isArray,ni=kendo.isFunction,g=s.isString,lr=n.isPlainObject,h=Math,c=".kendoDiagram",lt="cascading",ti="itemBoundsChange",nt="change",tt="click",ii="error",k="Auto",ri=9007199254740992,ui="select",fi="itemRotate",at="pan",vt="zoomStart",ei="zoomEnd",oi="none",ar=600,vr=600,yr="rectangle",pr=100,wr=100,br=20,kr=20,si=0,dr=Number.MAX_VALUE,gr=-Number.MAX_VALUE,nu="absolute",hi="transformed",it="rotated",tu="transparent",iu="width",ru="height",uu="x",fu="y",eu="DOMMouseScroll"+c+" mousewheel"+c,ou=.05,su=5,hu='<a class="k-button k-button-icontext #=className#" href="\\#"><span class="#=iconClass# #=imageClass#"><\/span>#=text#<\/a>',ci,w,v,o,l,ft;i.DefaultConnectors=[{name:"Top",description:"Top Connector"},{name:"Right",description:"Right Connector"},{name:"Bottom",description:"Bottom Connector"},{name:"Left",Description:"Left Connector"},{name:k,Description:"Auto Connector",position:function(n){return n.getPosition("center")}}];ci={cancel:{text:"Cancel",imageClass:"k-cancel",className:"k-diagram-cancel",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-update",className:"k-diagram-update",iconClass:"k-icon"}};i.shapeDefaults=function(n){var t={type:yr,path:"",autoSize:!0,visual:null,x:si,y:si,minWidth:br,minHeight:kr,width:pr,height:wr,hover:{},editable:{connect:!0,tools:[]},connectors:i.DefaultConnectors,rotation:{angle:0}};return s.simpleExtend(t,n),t};w=gt.extend({init:function(n){var t=this;t.dataItem=(n||{}).dataItem;gt.fn.init.call(t);t.options=f({id:i.randomId()},t.options,n);t.dataItem&&(t.options.dataItem=t.dataItem);t.isSelected=!1;t.visual=new ht({id:t.options.id,autoSize:t.options.autoSize});t._template()},options:{hover:{},cursor:fr.grip,content:{align:"center middle"},selectable:!0,serializable:!0,enable:!0},_getCursor:function(n){return this.adorner?this.adorner._getCursor(n):this.options.cursor},visible:function(n){if(p(n))return this.visual.visible();this.visual.visible(n)},bounds:function(){},refresh:function(){this.visual.redraw()},position:function(n){this.options.x=n.x;this.options.y=n.y;this.visual.position(n)},toString:function(){return this.options.id},serialize:function(){var n=f({},{options:this.options});return this.options.dataItem&&(n.dataItem=this.options.dataItem.toString()),n},_content:function(n){var r,o,u,e;return n!==t&&(r=this.options,o=this.bounds(),i.Utils.isString(n)?r.content.text=n:f(r.content,n),u=r.content,e=this._contentVisual,!e&&u.text?(this._contentVisual=new kt(u),this._contentVisual._includeInBBox=!1,this.visual.append(this._contentVisual)):e&&e.redraw(u)),this.options.content.text},_hitTest:function(n){var t=this.bounds();return this.visible()&&t.contains(n)&&this.options.enable},_template:function(){var n=this,t,i;n.options.content.template&&(t=n.options.dataItem||{},i=kendo.template(n.options.content.template,{paramName:"dataItem"}),n.options.content.text=i(t))},_canSelect:function(){return this.options.selectable!==!1},toJSON:function(){return{id:this.options.id}}});v=ai.extend({init:function(n,t){this.options=f({},this.options,t);this.connections=[];this.shape=n},options:{width:7,height:7,fill:{color:"Yellow"},hover:{}},position:function(){return this.options.position?this.options.position(this.shape):this.shape.getPosition(this.options.name)},toJSON:function(){return{shapeId:this.shape.toString(),connector:this.options.name}}});v.parse=function(n,t){for(var r,u=t.split(":"),f=u[0],e=u[1]||k,i=0;i<n.shapes.length;i++)if(r=n.shapes[i],r.options.id==f)return r.getConnector(e.trim())};o=w.extend({init:function(n){var i=this;w.fn.init.call(i,n);this.updateOptionsFromModel();n=i.options;i.connectors=[];i.type=n.type;i.shapeVisual=o.createShapeVisual(i.options);i.visual.append(this.shapeVisual);i.updateBounds();i.content(i.content());i._createConnectors();i.parentContainer=null;i.isContainer=!1;i.isCollapsed=!1;i.id=i.visual.id;n.hasOwnProperty("layout")&&n.layout!==t&&(i.layout=n.layout.bind(n))},options:i.shapeDefaults(),updateOptionsFromModel:function(n,t){if(this.diagram&&this.diagram._isEditable){var i=au(n||this.options.dataItem);n?t&&!d.inArray(t,["x","y","width","height"])&&(this.options.visual?this.redrawVisual():i.type&&(this.options=f({},this.options,i),this.redrawVisual()),this.options.content&&(this._template(),this.content(this.options.content))):this.options=f({},this.options,i)}},redrawVisual:function(){this.visual.clear();this._contentVisual=null;this.shapeVisual=o.createShapeVisual(this.options);this.visual.append(this.shapeVisual);this.updateBounds()},updateModel:function(){if(this.diagram&&this.diagram._isEditable){var t=this._bounds,n;this.options.dataItem&&(n=this.diagram.dataSource.getByUid(this.options.dataItem.uid));n&&(r(n.x)&&t.x!==n.x&&n.set("x",t.x),r(n.y)&&t.y!==n.y&&n.set("y",t.y),r(n.width)&&t.width!==n.width&&n.set("width",t.width),r(n.height)&&t.height!==n.height&&n.set("height",t.height),this.dataItem=this.options.dataItem=n)}},updateBounds:function(){var n=this.visual._measure(!0),t=this.options;this.bounds(new a(t.x,t.y,n.width,n.height));this._rotate();this._alignContent()},content:function(n){var t=this._content(n);return this._alignContent(),t},_alignContent:function(){var t=this.options.content||{},n=this._contentVisual;if(n&&t.align){var u=this.visual._measure(),f=new i.RectAlign(u),r=n.drawingElement.bbox(null),e=new a(0,0,r.width(),r.height()),o=f.align(e,t.align);n.position(o.topLeft())}},_createConnectors:function(){for(var t=this.options,r=t.connectors.length,u=t.connectorDefaults,i,n=0;n<r;n++)i=new v(this,f({},u,t.connectors[n])),this.connectors.push(i)},bounds:function(n){var t,i;if(n)if(g(n))switch(n){case hi:t=this._transformedBounds();break;case nu:t=this._transformedBounds();i=this.diagram._pan;t.x+=i.x;t.y+=i.y;break;case it:t=this._rotatedBounds();break;default:t=this._bounds}else this._setBounds(n),this.refreshConnections(),this._triggerBoundsChange();else t=this._bounds;return t},_setBounds:function(n){var t=this.options,i=n.topLeft(),r=t.x=i.x,u=t.y=i.y,f=t.width=h.max(n.width,t.minWidth),e=t.height=h.max(n.height,t.minHeight);this._bounds=new a(r,u,f,e);this.visual.redraw({x:r,y:u,width:f,height:e})},position:function(n){if(n)this.bounds(new a(n.x,n.y,this._bounds.width,this._bounds.height));else return this._bounds.topLeft()},clone:function(){var n=this.serialize();return n.options.id=i.randomId(),this.diagram&&this.diagram._isEditable&&r(this.options.dataItem)&&(n.options.dataItem=this.options.dataItem.toJSON(),n.options.dataItem[this.options.dataItem.idField]=this.options.dataItem._defaultId),new o(n.options)},select:function(n){var t=this.diagram,i,r;return p(n)&&(n=!0),this._canSelect()&&this.isSelected!=n?(i=[],r=[],this.isSelected=n,this.isSelected?(t._selectedItems.push(this),i.push(this)):(s.remove(t._selectedItems,this),r.push(this)),t._internalSelection||t._selectionChanged(i,r),!0):void 0},rotate:function(n,r,f){var o=this.visual.rotate(),e,s,c,h;return n!==t&&(f!==!1&&this.diagram&&this.diagram.undoRedoService&&this.diagram.undoRedoService.add(new i.RotateUnit(this.diagram._resizingAdorner,[this],[o.angle]),!1),e=this.bounds(),s=new u(e.width/2,e.height/2),r&&(c=n-o.angle,h=e.center().rotate(r,360-c).minus(s),this._rotationOffset=this._rotationOffset.plus(h.minus(e.topLeft())),this.position(h)),this.visual.rotate(n,s),this.options.rotation.angle=n,this.diagram&&this.diagram._connectorsAdorner&&this.diagram._connectorsAdorner.refresh(),this.refreshConnections(),this.diagram&&this.diagram.trigger(fi,{item:this})),o},connections:function(n){for(var i=[],u,t,f,s,e,o,r=0;r<this.connectors.length;r++)for(s=this.connectors[r],f=s.connections,u=0,f;u<f.length;u++)t=f[u],n=="out"?(e=t.source(),e.shape&&e.shape==this&&i.push(t)):n=="in"?(o=t.target(),o.shape&&o.shape==this&&i.push(t)):i.push(t);return i},refreshConnections:function(){n.each(this.connections(),function(){this.refresh()})},getConnector:function(n){var t,i;if(g(n)){for(n=n.toLocaleLowerCase(),t=0;t<this.connectors.length;t++)if(i=this.connectors[t],i.options.name.toLocaleLowerCase()==n)return i}else return n instanceof u?ut(n,this):this.connectors.length?this.connectors[0]:null},getPosition:function(n){var t=this.bounds(),i=n.charAt(0).toLowerCase()+n.slice(1);return ni(t[i])?this._transformPoint(t[i]()):t.center()},redraw:function(n){if(n){var t=this.options,i;this.shapeVisual.redraw(this._visualOptions(n));this._diffNumericOptions(n,[iu,ru,uu,fu])&&(this.bounds(new a(t.x,t.y,t.width,t.height)),i=!0);t=f(t,n);(n.rotation||i)&&this._rotate();t.content&&this.content(t.content)}},_diffNumericOptions:i.diffNumericOptions,_visualOptions:function(n){return{data:n.path,source:n.source,hover:n.hover,fill:n.fill,stroke:n.stroke,startCap:n.startCap,endCap:n.endCap}},_triggerBoundsChange:function(){this.diagram&&this.diagram.trigger(ti,{item:this,bounds:this._bounds.clone()})},_transformPoint:function(n){var t=this.rotate(),i=this.bounds(),r=i.topLeft();return t.angle&&n.rotate(t.center().plus(r),360-t.angle),n},_transformedBounds:function(){var n=this.bounds(),t=n.topLeft(),i=n.bottomRight();return a.fromPoints(this.diagram.modelToView(t),this.diagram.modelToView(i))},_rotatedBounds:function(){var n=this.bounds().rotatedBounds(this.rotate().angle),t=n.topLeft(),i=n.bottomRight();return a.fromPoints(t,i)},_rotate:function(){var n=this.options.rotation;n&&n.angle&&this.rotate(n.angle);this._rotationOffset=new u},_hover:function(n){var t=this.options,i=t.hover,r=t.stroke,u=t.fill;n&&y(i.stroke)&&(r=f({},r,i.stroke));n&&y(i.fill)&&(u=i.fill);this.shapeVisual.redraw({stroke:r,fill:u});t.editable&&t.editable.connect&&this.diagram._showConnectors(this,n)},_hitTest:function(n){if(this.visible()){var t=this.bounds(),r,i=this.rotate().angle;if(n.isEmpty&&!n.isEmpty())return gi.rects(n,t,i?i:0);if(r=n.clone().rotate(t.center(),i),t.contains(r))return this}},toJSON:function(){return{shapeId:this.options.id}}});o.createShapeVisual=function(n){function u(n,t){switch(n.toLocaleLowerCase()){case"rectangle":return new wt(t);case"circle":return new wi(t);case"text":return new kt(t);case"image":return new di(t);default:return new bt(t)}}function e(n,t){return t.data=n,new bt(t)}function o(n,t,i){return n.call(t,i)}var s=n.diagram;delete n.diagram;var t=f({},n,{x:0,y:0}),i=t.visual,r=t.type;return ni(i)?o(i,this,t):t.path?e(t.path,t):g(r)?u(t.type.toLocaleLowerCase(),t):new wt(t)};l=w.extend({init:function(n,t,f){var e=this;w.fn.init.call(e,f);this.updateOptionsFromModel();this._initRouter();e.path=new i.Polyline(e.options);e.path.fill(tu);e.visual.append(e.path);e._sourcePoint=e._targetPoint=new u;e.source(n);e.target(t);e.content(e.options.content);e.definers=[];r(f)&&f.points&&e.points(f.points);e.refresh()},options:{hover:{stroke:{}},startCap:oi,endCap:oi,points:[],selectable:!0},updateOptionsFromModel:function(n){if(this.diagram&&this.diagram._isEditable){var t=vu(n||this.options.dataItem);n?(r(t.from)?this.source(t.from):r(t.fromX)&&r(t.fromY)&&this.source(new u(t.fromX,t.fromY)),r(t.to)?this.target(t.to):r(t.toX)&&r(t.toY)&&this.target(new u(t.toX,t.toY)),this.options.dataItem=n,this._template(),this.redraw(this.options)):this.options=f({},t,this.options)}},updateModel:function(n){if(this.diagram&&this.diagram._isEditable&&this.diagram.connectionsDataSource){var t=this.diagram.connectionsDataSource.getByUid(this.options.dataItem.uid);t&&(this.diagram._shouldRefresh=!1,r(this.options.fromX)&&this.options.fromX!==null?(t._set("from",null),t._set("fromX",this.options.fromX),t._set("fromY",this.options.fromY)):(t._set("from",this.options.from),t._set("fromX",null),t._set("fromY",null)),r(this.options.toX)&&this.options.toX!==null?(t._set("to",null),t._set("toX",this.options.toX),t._set("toY",this.options.toY)):(t._set("to",this.options.to),t._set("toX",null),t._set("toY",null)),this.dataItem=this.options.dataItem=t,n!==!1&&(this.diagram._shouldRefresh=!0,t.trigger("change")))}},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint},source:function(n,r){var f;return y(n)&&(r&&this.diagram?this.diagram.undoRedoService.addCompositeItem(new i.ConnectionEditUnit(this,n)):(n!==t&&(this.from=n),n===null?this.sourceConnector&&(this._sourcePoint=this._resolvedSourceConnector.position(),this._clearSourceConnector()):n instanceof v?(f=n.shape.options.dataItem,f&&(this.options.from=f.id,this.options.fromX=null,this.options.fromY=null),this.sourceConnector=n,this.sourceConnector.connections.push(this)):n instanceof u?(this.options.fromX=n.x,this.options.fromY=n.y,this.options.from=null,this._sourcePoint=n,this.sourceConnector&&this._clearSourceConnector()):n instanceof o&&(f=n.options.dataItem,f&&(this.options.from=f.id,this.options.fromX=null,this.options.fromY=null),this.sourceConnector=n.getConnector(k),this.sourceConnector.connections.push(this)),this.refresh())),this.sourceConnector?this.sourceConnector:this._sourcePoint},sourceDefiner:function(n){if(n)if(n instanceof i.PathDefiner)n.left=null,this._sourceDefiner=n,this.source(n.point);else throw"The sourceDefiner needs to be a PathDefiner.";else return this._sourceDefiner||(this._sourceDefiner=new i.PathDefiner(this.sourcePoint(),null,null)),this._sourceDefiner},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint},target:function(n,r){var f;return y(n)&&(r&&this.diagram?this.diagram.undoRedoService.addCompositeItem(new i.ConnectionEditUnit(this,n)):(n!==t&&(this.to=n),n===null?this.targetConnector&&(this._targetPoint=this._resolvedTargetConnector.position(),this._clearTargetConnector()):n instanceof v?(f=n.shape.options.dataItem,f&&(this.options.to=f.id,this.options.toX=null,this.options.toY=null),this.targetConnector=n,this.targetConnector.connections.push(this)):n instanceof u?(this.options.toX=n.x,this.options.toY=n.y,this.options.to=null,this._targetPoint=n,this.targetConnector&&this._clearTargetConnector()):n instanceof o&&(f=n.options.dataItem,f&&(this.options.to=f.id,this.options.toX=null,this.options.toY=null),this.targetConnector=n.getConnector(k),this.targetConnector.connections.push(this))),this.refresh()),this.targetConnector?this.targetConnector:this._targetPoint},targetDefiner:function(n){if(n)if(n instanceof i.PathDefiner)n.right=null,this._targetDefiner=n,this.target(n.point);else throw"The sourceDefiner needs to be a PathDefiner.";else return this._targetDefiner||(this._targetDefiner=new i.PathDefiner(this.targetPoint(),null,null)),this._targetDefiner},content:function(n){return this._content(n)},select:function(n){var i=this.diagram,r,u;if(this._canSelect()&&this.isSelected!==n)return this.isSelected=n,r=[],u=[],this.isSelected?(this.adorner=new nr(this,this.options.selection),i._adorn(this.adorner,!0),i._selectedItems.push(this),r.push(this)):this.adorner&&(i._adorn(this.adorner,!1),s.remove(i._selectedItems,this),this.adorner=t,u.push(this)),this.refresh(),i._internalSelection||i._selectionChanged(r,u),!0},bounds:function(n){if(n&&!g(n))this._bounds=n;else return this._bounds},type:function(n){var t=this.options;if(n)n!==t.type&&(t.type=n,this._initRouter(),this.refresh());else return t.type},_initRouter:function(){var n=(this.options.type||"").toLowerCase();this._router=n==lt?new cr(this):new hr(this)},points:function(n){var r,t,e,f;if(n)for(this.definers=[],r=0;r<n.length;r++)if(t=n[r],t instanceof i.Point)this.definers.push(new i.PathDefiner(t));else if(t.hasOwnProperty("x")&&t.hasOwnProperty("y"))this.definers.push(new i.PathDefiner(new u(t.x,t.y)));else throw"A Connection point needs to be a Point or an object with x and y properties.";else{if(e=[],y(this.definers))for(f=0;f<this.definers.length;f++)e.push(this.definers[f].point);return e}},allPoints:function(){var t=[this.sourcePoint()],n;if(this.definers)for(n=0;n<this.definers.length;n++)t.push(this.definers[n].point);return t.push(this.targetPoint()),t},refresh:function(){lu(this);var f=this.sourcePoint(),e=this.targetPoint(),n,i,r,t;this._refreshPath();n=this._bounds.topLeft();i=f.minus(n);r=e.minus(n);this._contentVisual&&(t=u.fn.middleOf(i,r),this._contentVisual.position(new u(t.x+n.x,t.y+n.y)));this.adorner&&this.adorner.refresh()},redraw:function(n){if(n){this.options=f({},this.options,n);var t=this.options.points;(n&&n.content||n.text)&&this.content(n.content);r(t)&&t.length>0&&(this.points(t),this._refreshPath());this.path.redraw({fill:n.fill,stroke:n.stroke,startCap:n.startCap,endCap:n.endCap})}},clone:function(){var n=this.serialize();return this.diagram&&this.diagram._isEditable&&r(this.options.dataItem)&&(n.options.dataItem=this.options.dataItem.toJSON(),n.options.dataItem[this.options.dataItem.idField]=this.options.dataItem._defaultId),new l(this.from,this.to,n.options)},serialize:function(){var t=this.from.toJSON?this.from.toJSON:this.from.toString(),i=this.to.toJSON?this.to.toJSON:this.to.toString(),n=f({},{options:this.options,from:t,to:i});return r(this.dataItem)&&(n.dataItem=this.dataItem.toString()),n.options.points=this.points(),n},_hitTest:function(n){if(this.visible()){var t=new u(n.x,n.y),i=this.sourcePoint(),r=this.targetPoint();if(n.isEmpty&&!n.isEmpty()&&n.contains(i)&&n.contains(r)||this._router.hitTest(t))return this}},_hover:function(n){var t=(this.options.stroke||{}).color;n&&y(this.options.hover.stroke.color)&&(t=this.options.hover.stroke.color);this.path.redraw({stroke:{color:t}})},_refreshPath:function(){r(this.path)&&(this._drawPath(),this.bounds(this._router.getBounds()))},_drawPath:function(){this._router&&this._router.route();var n=this.sourcePoint(),t=this.targetPoint(),i=this.points();this.path.redraw({points:[n].concat(i,[t])})},_clearSourceConnector:function(){s.remove(this.sourceConnector.connections,this);this.sourceConnector=t;this._resolvedSourceConnector=t},_clearTargetConnector:function(){s.remove(this.targetConnector.connections,this);this.targetConnector=t;this._resolvedTargetConnector=t}});ft=st.extend({init:function(n,t){var i=this;kendo.destroy(n);st.fn.init.call(i,n,t);i._initTheme();i._initElements();i._extendLayoutOptions(i.options);i._initShapeDefaults();i._initCanvas();i.mainLayer=new ht({id:"main-layer"});i.canvas.append(i.mainLayer);i._pan=new u;i._adorners=[];i.adornerLayer=new ht({id:"adorner-layer"});i.canvas.append(i.adornerLayer);i._createHandlers();i._initialize();i._fetchFreshData();i._createGlobalToolBar();i._resizingAdorner=new rr(i,{editable:i.options.editable});i._connectorsAdorner=new ur(i);i._adorn(i._resizingAdorner,!0);i._adorn(i._connectorsAdorner,!0);i.selector=new ir(i);i._clipboard=[];i.options.layout&&i.layout(i.options.layout);i.pauseMouseHandlers=!1;i._createShapes();i._createConnections();i.zoom(i.options.zoom);i.canvas.draw();this._shouldRefresh=!0},options:{name:"Diagram",theme:"default",layout:"",zoomRate:.1,zoom:1,minZoom:0,maxZoom:2,dataSource:{},draggable:!0,template:"",autoBind:!0,editable:{rotate:{},resize:{},text:!0,tools:[]},pannable:{key:"ctrl"},selectable:{key:"none"},tooltip:{enabled:!0,format:"{0}"},copy:{enabled:!0,offsetX:20,offsetY:20},snap:{enabled:!0,size:10,angle:10},shapeDefaults:i.shapeDefaults({undoable:!0}),connectionDefaults:{editable:{tools:[]}},shapes:[],connections:[]},events:[ei,vt,at,ui,fi,ti,nt,tt,"toolBarClick","save","cancel","edit","remove","add","dataBound"],_createGlobalToolBar:function(){var n=this.options.editable.tools;this._isEditable&&n.length===0&&(n=["createShape","undo","redo","rotateClockwise","rotateAnticlockwise"]);n&&n.length&&(this.toolBar=new yt(this,{tools:n||{},click:e(this._toolBarClick,this),modal:!1}),this.toolBar.element.css({position:"absolute",top:0,left:0,width:this.element.width(),textAlign:"left"}),this.element.append(this.toolBar.element))},createShape:function(){var n=this;if((this.editor&&this.editor.end()||!this.editor)&&!this.trigger("add",{shape:{}})){var t=this.dataSource.view()||[],i=t.length,r=this.dataSource.insert(i,{});this.dataSource.one("sync",function(){var t=n._dataMap[r.id];n.edit(t)});this.dataSource.sync()}},createConnection:function(){if((this.editor&&this.editor.end()||!this.editor)&&!this.trigger("add",{connection:{}})){var n=this.connectionsDataSource.view()||[],t=n.length,i=this.connectionsDataSource.insert(t,{}),r=this._connectionsDataMap[i.uid];this.edit(r)}},edit:function(n){var i,r,u,t,s;if(this.cancelEdit(),t=this.options.editable,n instanceof o)i="shape",r=t.shapeEditors,u=t.shapeTemplate;else if(n instanceof l)i="connection",s=e(pu,this),r=f({},{from:s,to:s},t.connectionEditors),u=t.connectionTemplate;else return;n.options.dataItem&&(this.editor=new yu(this.element,{update:e(this._update,this),cancel:e(this._cancel,this),model:n.dataItem,type:i,target:this,editors:r,template:u}),this.trigger("edit",this._editArgs()))},cancelEdit:function(){this.editor&&(this._getEditDataSource().cancelChanges(this.editor.model),this._destroyEditor())},saveEdit:function(){this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())&&this._getEditDataSource().sync()},_update:function(){this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())&&(this._getEditDataSource().sync(),this._destroyEditor())},_cancel:function(){this.editor&&!this.trigger("cancel",this._editArgs())&&(this._getEditDataSource().cancelChanges(this.editor.model),this._destroyEditor())},_getEditDataSource:function(){return this.editor.options.type==="shape"?this.dataSource:this.connectionsDataSource},_editArgs:function(){var n={container:this.editor.element};return n[this.editor.options.type]=this.editor.model,n},_destroyEditor:function(){this.editor&&(this.editor.close(),this.editor=null)},_initElements:function(){this.wrapper=this.element.empty().css("position","relative").attr("tabindex",0).addClass("k-widget k-diagram");this.scrollable=n("<div />").appendTo(this.element)},_initShapeDefaults:function(){var n=this.options;n.editable===!1&&f(n.shapeDefaults,{editable:{connect:!1}})},_initCanvas:function(){var i=n("<div class='k-layer'><\/div>").appendTo(this.scrollable)[0],t=this.viewport();this.canvas=new pi(i,{width:t.width||ar,height:t.height||vr})},_createHandlers:function(){var n=this,t=n.element;t.on(eu,e(n._wheel,n));if(kendo.support.touch||kendo.support.mobileOS)n._userEvents=new kendo.UserEvents(t,{multiTouch:!0,tap:e(n._tap,n)}),n._userEvents.bind(["gesturestart","gesturechange","gestureend"],{gesturestart:e(n._gestureStart,n),gesturechange:e(n._gestureChange,n),gestureend:e(n._gestureEnd,n)}),n.toolService=new dt(n),n.options.pannable!==!1&&n.scroller.enable();else{n.toolService=new dt(n);this.scroller.wrapper.on("mousemove"+c,e(n._mouseMove,n)).on("mouseup"+c,e(n._mouseUp,n)).on("mousedown"+c,e(n._mouseDown,n)).on("mouseover"+c,e(n._mouseover,n)).on("mouseout"+c,e(n._mouseout,n));t.on("keydown"+c,e(n._keydown,n))}n._resizeHandler=e(n.resize,n);kendo.onResize(n._resizeHandler);this.bind(vt,e(n._destroyToolBar,n));this.bind(at,e(n._destroyToolBar,n))},_tap:function(n){var i=this.toolService,r=this._caculateMobilePosition(n),t;i._updateHoveredItem(r);i.hoveredItem&&(t=i.hoveredItem,this.options.selectable!==!1&&(this._destroyToolBar(),t.isSelected?t.select(!1):this.select(t,{addToSelection:!0}),this._createToolBar()),this.trigger("click",{item:t,point:r}))},_caculateMobilePosition:function(n){return this.documentToModel(u(n.x.location,n.y.location))},_gestureStart:function(n){this._destroyToolBar();this.scroller.disable();this._gesture=n;this._initialCenter=this.documentToModel(new u(n.center.x,n.center.y));this.trigger(vt,{point:this._initialCenter,zoom:this.zoom()})},_gestureChange:function(n){var o=this._gesture,s=this._initialCenter,c=this.documentToView(new u(n.center.x,n.center.y)),r=n.distance/o.distance,t=this._zoom,f=!1,e,i;h.abs(r-1)>=ou&&(this._zoom=t=this._getValidZoom(t*r),this.options.zoom=t,this._gesture=n,f=!0);e=s.times(t);i=c.minus(e);(f||this._pan.distanceTo(i)>=su)&&(this._panTransform(i),this._updateAdorners());n.preventDefault()},_gestureEnd:function(){this.options.pannable!==!1&&this.scroller.enable();this.trigger(ei,{point:this._initialCenter,zoom:this.zoom()})},_resize:function(n){this.canvas&&this.canvas.size(n);this.toolBar&&this.toolBar._toolBar.element.width(this.element.width())},_mouseover:function(n){var t=n.target._kendoNode;t&&t.srcElement._hover&&t.srcElement._hover(!0,t.srcElement)},_mouseout:function(n){var t=n.target._kendoNode;t&&t.srcElement._hover&&t.srcElement._hover(!1,t.srcElement)},_initTheme:function(){var n=this,t=d.ui.themes||{},i=((n.options||{}).theme||"").toLowerCase(),r=(t[i]||{}).diagram;n.options=f({},r,n.options)},_createShapes:function(){for(var t=this,u=t.options,i=u.shapes,r,n=0;n<i.length;n++)r=i[n],t.addShape(r)},_createConnections:function(){for(var n=this,r=n.options,s=r.connectionDefaults,u=r.connections,t,e,o,i=0;i<u.length;i++)t=u[i],e=n._findConnectionShape(t.from),o=n._findConnectionShape(t.to),n.connect(e,o,f({},s,t))},_findConnectionShape:function(n){var t=this,i=g(n)?n:n.shapeId,r=t.getShapeById(i);return r.getConnector(n.connector||k)},destroy:function(){var n=this;st.fn.destroy.call(n);this._userEvents&&this._userEvents.destroy();kendo.unbindResize(n._resizeHandler);n.clear();n.element.off(c);n.scroller.wrapper.off(c);n.canvas.destroy(!0);n.canvas=t;n._destroyEditor();n.destroyScroller();n._destroyGlobalToolBar();n._destroyToolBar()},destroyScroller:function(){var n=this.scroller;n&&(n.destroy(),n.element.remove(),this.scroller=null)},save:function(){var t={},n,r,i,u;for(t.shapes=[],t.connections=[],n=0;n<this.shapes.length;n++)r=this.shapes[n],r.options.serializable&&t.shapes.push(r.options);for(n=0;n<this.connections.length;n++)i=this.connections[n],u=f({},i.options,{from:i.from.toJSON(),to:i.to.toJSON()}),t.connections.push(u);return t},focus:function(){if(!this.element.is(kendo._activeElement())){var r=this.element,n=r[0],i=[],u=[],f=document.documentElement,t;do n=n.parentNode,n.scrollHeight>n.clientHeight&&(i.push(n),u.push(n.scrollTop));while(n!=f);for(r.focus(),t=0;t<i.length;t++)i[t].scrollTop=u[t]}},load:function(n){this.clear();this.setOptions(n);this._createShapes();this._createConnections()},setOptions:function(n){f(this.options,n)},clear:function(){var n=this;n.select(!1);n.mainLayer.clear();n._initialize()},connect:function(n,t,i){var r,u;return this.connectionsDataSource&&this._isEditable?(u=this.connectionsDataSource.add({}),r=this._connectionsDataMap[u.uid],r.source(n),r.target(t),this.connectionsDataSource.sync()):(r=new l(n,t,f({},this.options.connectionDefaults,i)),this.addConnection(r)),r},connected:function(n,t){for(var r,i=0;i<this.connections.length;i++)if(r=this.connections[i],r.from==n&&r.to==t)return!0;return!1},addConnection:function(n,t){return t!==!1&&this.undoRedoService.add(new i.AddConnectionUnit(n,this),!1),n.diagram=this,this.mainLayer.append(n.visual),this.connections.push(n),n.updateOptionsFromModel(),n},_addConnection:function(n,t){var r=this,i;if(this.connectionsDataSource&&this._isEditable)if(this.trigger("add",{connection:n.options.dataItem}))this._remove(n,!1);else{i=this.connectionsDataSource.add(n.options.dataItem);this.connectionsDataSource.one("sync",function(){for(var u,t=0;t<r.connections.length;t++)u=r.connections[t],u.options.dataItem.uid===i.uid&&u.redraw(n.options)});n.options.dataItem=i;this.connectionsDataSource.sync()}else return this.addConnection(n,t)},addShape:function(n,t){var r,u=this.options.shapeDefaults;if(n instanceof o)u=f({},u,t),n.redraw(t),r=n;else{if(n instanceof kendo.Class)return;u=f({},u,n||{});r=new o(u)}return u.undoable&&this.undoRedoService.add(new i.AddShapeUnit(r,this),!1),this.shapes.push(r),r.diagram=this,this.mainLayer.append(r.visual),this.trigger(nt,{added:[r],removed:[]}),r.hasOwnProperty("layout")&&r.layout(r),r},_addShape:function(n,t){var r=this,i;if(this.dataSource&&this._isEditable)if(this.trigger("add",{shape:n.options.dataItem}))this._remove(n,!1);else{i=this.dataSource.add(n.options.dataItem);this.dataSource.one("sync",function(){for(var u,t=0;t<r.shapes.length;t++)u=r.shapes[t],u.options.dataItem.uid===i.uid&&u.redraw(n.options)});n.options.dataItem=i;this.dataSource.sync()}else return this.addShape(n,t)},remove:function(n,t){var r=b(n),i;if(p(t)&&(t=!0),t&&this.undoRedoService.begin(),r)for(n=n.slice(0),i=0;i<n.length;i++)this._removeItem(n[i],t);else(n instanceof o||n instanceof l)&&this._removeItem(n,t);t&&this.undoRedoService.commit();this.trigger(nt,{added:[],removed:r?n:[n]})},_remove:function(n,t){var r={},i;this._isEditable&&(n.length?this._destroyToolBar():(n instanceof l?this.connectionsDataSource&&(i=this.connectionsDataSource,r.connection=n.options.dataItem):this.dataSource&&(i=this.dataSource,r.shape=n.options.dataItem),i&&!this.trigger("remove",r)&&(i.remove(n.options.dataItem),i.sync())));this.remove(n,t)},undo:function(){this.undoRedoService.undo()},redo:function(){this.undoRedoService.redo()},select:function(n,t){if(y(n)){t=f({addToSelection:!1},t);var o=t.addToSelection,i=[],e=[],r,u;for(o||this.deselect(),this._internalSelection=!0,n instanceof Array?i=n:n instanceof w&&(i=[n]),r=0;r<i.length;r++)u=i[r],u.select(!0)&&e.push(u);this._selectionChanged(e,[]);this._internalSelection=!1}else return this._selectedItems},selectAll:function(){this.select(this.shapes.concat(this.connections))},selectArea:function(n){var i,r,t,u;if(this._internalSelection=!0,u=[],n instanceof a)for(r=this.shapes.concat(this.connections),i=0;i<r.length;i++)t=r[i],(!n||t._hitTest(n))&&t.options.enable&&t.select(!0)&&u.push(t);this._selectionChanged(u,[]);this._internalSelection=!1},deselect:function(n){this._internalSelection=!0;var u=[],t=[],r,i;for(n instanceof Array?t=n:n instanceof w?t.push(n):y(n)||(t=this._selectedItems.slice(0)),i=0;i<t.length;i++)r=t[i],r.select(!1)&&u.push(r);this._selectionChanged([],u);this._internalSelection=!1},toFront:function(n,t){var i,u,f;n||(n=this._selectedItems.slice());i=this._getDiagramItems(n);!r(t)||t?(u=li(this.mainLayer,i.visuals),f=new or(this,n,u),this.undoRedoService.add(f)):(this.mainLayer.toFront(i.visuals),this._fixOrdering(i,!0))},toBack:function(n,t){var i,u,f;n||(n=this._selectedItems.slice());i=this._getDiagramItems(n);!r(t)||t?(u=li(this.mainLayer,i.visuals),f=new er(this,n,u),this.undoRedoService.add(f)):(this.mainLayer.toBack(i.visuals),this._fixOrdering(i,!1))},bringIntoView:function(n,t){var e=this.viewport(),l=new i.RectAlign(e),s,r,o,c;e.width!==0&&e.height!==0&&(t=f({animate:!1,align:"center middle"},t),t.align=="none"&&(t.align="center middle"),n instanceof w?r=n.bounds(hi):b(n)?r=this.boundingBox(n):n instanceof a&&(r=n.clone()),o=r.clone(),r.zoom(this._zoom),this._storePan(new u),(r.width>e.width||r.height>e.height)&&(this._zoom=this._getValidZoom(h.min(e.width/o.width,e.height/o.height)),r=o.clone().zoom(this._zoom)),this._zoomMainLayer(),s=r.clone(),l.align(r,t.align),c=r.topLeft().minus(s.topLeft()),this.pan(c.times(-1),t.animate))},alignShapes:function(n){var e,r,t,f,s,c,l;if(p(n)&&(n="Left"),e=this.select(),e.length!==0){switch(n.toLowerCase()){case"left":case"top":r=dr;break;case"right":case"bottom":r=gr}for(f=0;f<e.length;f++)if(t=e[f],t instanceof o)switch(n.toLowerCase()){case"left":r=h.min(r,t.options.x);break;case"top":r=h.min(r,t.options.y);break;case"right":r=h.max(r,t.options.x);break;case"bottom":r=h.max(r,t.options.y)}for(s=[],c=[],f=0;f<e.length;f++)if(t=e[f],t instanceof o){c.push(t);s.push(t.bounds());switch(n.toLowerCase()){case"left":case"right":t.position(new u(r,t.options.y));break;case"top":case"bottom":t.position(new u(t.options.x,r))}}l=new i.TransformUnit(c,s);this.undoRedoService.add(l,!1)}},zoom:function(n,t){var r;if(n){if(r=t?t.point:new i.Point(0,0),n=this._zoom=this._getValidZoom(n),!p(r)){r=new i.Point(h.round(r.x),h.round(r.y));var f=r.times(n),e=this.modelToView(r),u=e.minus(f);this._storePan(new i.Point(h.round(u.x),h.round(u.y)))}t&&(t.zoom=n);this._panTransform();this._updateAdorners()}return this._zoom},_getPan:function(n){var t=this.canvas;return t.translate||(n=n.plus(this._pan)),n},pan:function(n,t){if(n instanceof u){var i=this,r=i.scroller;n=i._getPan(n);n=n.times(-1);t?r.animatedScrollTo(n.x,n.y,function(){i._updateAdorners()}):(r.scrollTo(n.x,n.y),i._updateAdorners())}},viewport:function(){var n=this.element;return new a(0,0,n.width(),n.height())},copy:function(){var n,t;if(this.options.copy.enabled)for(this._clipboard=[],this._copyOffset=1,n=0;n<this._selectedItems.length;n++)t=this._selectedItems[n],this._clipboard.push(t)},cut:function(){var n,t;if(this.options.copy.enabled){for(this._clipboard=[],this._copyOffset=0,n=0;n<this._selectedItems.length;n++)t=this._selectedItems[n],this._clipboard.push(t);this.remove(this._clipboard,!0)}},paste:function(){var e,s,n,t,i,h,r,f;if(this._clipboard.length>0){for(f=new sr,e=this._copyOffset*this.options.copy.offsetX,s=this._copyOffset*this.options.copy.offsetY,this.deselect(),r=0;r<this._clipboard.length;r++)(n=this._clipboard[r],n instanceof l)||(t=n.clone(),f.set(n.id,t.id),t.position(new u(n.options.x+e,n.options.y+s)),t.diagram=this,this._addShape(t),t.select(),t.updateModel());for(r=0;r<this._clipboard.length;r++)(n=this._clipboard[r],n instanceof o)||(t=n.clone(),n.source()instanceof v&&(i=n.source(),f.containsKey(i.shape.id)?(h=this.getShapeById(f.get(i.shape.id)),t.source(h.getConnector(i.options.name))):t.source(new u(n.sourcePoint().x+e,n.sourcePoint().y+s))),n.target()instanceof v&&(i=n.target(),f.containsKey(i.shape.id)?(h=this.getShapeById(f.get(i.shape.id)),t.target(h.getConnector(i.options.name))):t.target(new u(n.targetPoint().x+e,n.targetPoint().y+s))),t.diagram=this,this._addConnection(t),t.position(new u(n.options.x+e,n.options.y+s)),t.select(!0),t.updateModel());this._copyOffset+=1}},boundingBox:function(n,t){var r=a.empty(),u,f=y(n)?this._getDiagramItems(n):{shapes:this.shapes},i,e;if(f.shapes.length>0)for(i=f.shapes[0],r=i.bounds(it),e=1;e<f.shapes.length;e++)i=f.shapes[e],u=i.bounds(it),t===!0&&(u.x-=i._rotationOffset.x,u.y-=i._rotationOffset.y),r=r.union(u);return r},documentToView:function(n){var t=this.element.offset();return new u(n.x-t.left,n.y-t.top)},viewToDocument:function(n){var t=this.element.offset();return new u(n.x+t.left,n.y+t.top)},viewToModel:function(n){return this._transformWithMatrix(n,this._matrixInvert)},modelToView:function(n){return this._transformWithMatrix(n,this._matrix)},modelToLayer:function(n){return this._transformWithMatrix(n,this._layerMatrix)},layerToModel:function(n){return this._transformWithMatrix(n,this._layerMatrixInvert)},documentToModel:function(n){var t=this.documentToView(n);return this.canvas.translate||(t.x=t.x+this.scroller.scrollLeft,t.y=t.y+this.scroller.scrollTop),this.viewToModel(t)},modelToDocument:function(n){return this.viewToDocument(this.modelToView(n))},_transformWithMatrix:function(n,t){var i=n,r,f;return n instanceof u?t&&(i=t.apply(n)):(r=this._transformWithMatrix(n.topLeft(),t),f=this._transformWithMatrix(n.bottomRight(),t),i=a.fromPoints(r,f)),i},setDataSource:function(n){this.options.dataSource=n;this._dataSource();this.options.autoBind&&this.dataSource.fetch()},setConnectionsDataSource:function(n){this.options.connectionsDataSource=n;this._connectionDataSource();this.options.autoBind&&this.connectionsDataSource.fetch()},layout:function(n){var r,t,f,u,e;this.isLayouting=!0;p(n)&&(n=this.options.layout);r=p(n)||p(n.type)?"Tree":n.type;switch(r.toLowerCase()){case"tree":t=new i.TreeLayout(this);break;case"layered":t=new i.LayeredLayout(this);break;case"forcedirected":case"force":case"spring":case"springembedder":t=new i.SpringLayout(this);break;default:throw"Layout algorithm '"+r+"' is not supported.";}f=new i.LayoutState(this);u=t.layout(n);u&&(e=new i.LayoutUndoUnit(f,u,n?n.animate:null),this.undoRedoService.add(e));this.isLayouting=!1},getShapeById:function(n){var t;return(t=s.first(this.shapes,function(t){return t.visual.id===n}),t)?t:s.first(this.connections,function(t){return t.visual.id===n})},_extendLayoutOptions:function(n){n.layout&&(n.layout=f(i.LayoutBase.fn.defaultOptions||{},n.layout))},_selectionChanged:function(n,t){(n.length||t.length)&&this.trigger(ui,{selected:n,deselected:t})},_getValidZoom:function(n){return h.min(h.max(n,this.options.minZoom),this.options.maxZoom)},_panTransform:function(n){var t=this,i=n||t._pan;t.canvas.translate?(t.scroller.scrollTo(i.x,i.y),t._zoomMainLayer()):(t._storePan(i),t._transformMainLayer())},_finishPan:function(){this.trigger(at,{total:this._pan,delta:Number.NaN})},_storePan:function(n){this._pan=n;this._storeViewMatrix()},_zoomMainLayer:function(){var n=this._zoom,t=new ct(0,0,n,n);t.render(this.mainLayer);this._storeLayerMatrix(t);this._storeViewMatrix()},_transformMainLayer:function(){var n=this._pan,t=this._zoom,i=new ct(n.x,n.y,t,t);i.render(this.mainLayer);this._storeLayerMatrix(i);this._storeViewMatrix()},_storeLayerMatrix:function(n){this._layerMatrix=n.toMatrix();this._layerMatrixInvert=n.invert().toMatrix()},_storeViewMatrix:function(){var n=this._pan,t=this._zoom,i=new ct(n.x,n.y,t,t);this._matrix=i.toMatrix();this._matrixInvert=i.invert().toMatrix()},_toIndex:function(n,t){var i=this._getDiagramItems(n);this.mainLayer.toIndex(i.visuals,t);this._fixOrdering(i,!1)},_fixOrdering:function(n,t){for(var u=t?this.shapes.length-1:0,f=t?this.connections.length-1:0,r,i=0;i<n.shapes.length;i++)r=n.shapes[i],s.remove(this.shapes,r),s.insert(this.shapes,r,u);for(i=0;i<n.cons.length;i++)r=n.cons[i],s.remove(this.connections,r),s.insert(this.connections,r,f)},_getDiagramItems:function(n){var r,t={},u=n,i;for(t.visuals=[],t.shapes=[],t.cons=[],n?b(n)||(u=[n]):u=this._selectedItems.slice(),r=0;r<u.length;r++)i=u[r],i instanceof o?(t.shapes.push(i),t.visuals.push(i.visual)):i instanceof l&&(t.cons.push(i),t.visuals.push(i.visual));return t},_removeItem:function(n,t){n.select(!1);n instanceof o?this._removeShape(n,t):n instanceof l&&this._removeConnection(n,t);t||this.mainLayer.remove(n.visual)},_removeShape:function(n,t){var i,r,u,e=[],o=[],f;for(this.toolService._removeHover(),t?this.undoRedoService.addCompositeItem(new bi(n)):s.remove(this.shapes,n),i=0;i<n.connectors.length;i++)for(u=n.connectors[i],f=0;f<u.connections.length;f++)r=u.connections[f],r.sourceConnector==u?e.push(r):r.targetConnector==u&&o.push(r);for(i=0;i<e.length;i++)e[i].source(null,t);for(i=0;i<o.length;i++)o[i].target(null,t)},_removeConnection:function(n,t){n.sourceConnector&&s.remove(n.sourceConnector.connections,n);n.targetConnector&&s.remove(n.targetConnector.connections,n);t?this.undoRedoService.addCompositeItem(new ki(n)):s.remove(this.connections,n)},_removeDataItems:function(n,t){var i,f,r,u;for(n=b(n)?n:[n];n.length;)if(i=n.shift(),r=this._dataMap[i.uid],r&&(this._removeShapeConnections(r),this._removeItem(r,!1),delete this._dataMap[i.uid],t&&i.hasChildren&&i.loaded()))for(f=i.children.data(),u=0;u<f.length;u++)n.push(f[u])},_removeShapeConnections:function(n){var i=n.connections(),t;if(i)for(t=0;t<i.length;t++)this._removeItem(i[t],!1)},_addDataItem:function(n,t){if(r(n)){var i=this._dataMap[n.id];return i?i:(t=f({},this.options.shapeDefaults,t),t.dataItem=n,i=new o(t),this.addShape(i),this._dataMap[n.id]=i,i)}},_addDataItemByUid:function(n){var t,i;if(r(n))return(t=this._dataMap[n.uid],t)?t:(i=f({},this.options.shapeDefaults),i.dataItem=n,t=new o(i),this.addShape(t),this._dataMap[n.uid]=t,t)},_addDataItems:function(n,t){for(var f,u,r,e,i=0;i<n.length;i++)f=n[i],u=this._addDataItemByUid(f),r=this._addDataItemByUid(t),r&&!this.connected(r,u)&&(e=this.connect(r,u),e.type(lt))},_refreshSource:function(n){var i=this,u=n.node,f=n.action,r=n.items,e=i.options,t;if(!n.field){if(f=="remove")this._removeDataItems(n.items,!0);else for(f||u||i.clear(),this._addDataItems(r,u),t=0;t<r.length;t++)r[t].load();e.layout&&i.layout(e.layout)}},_mouseDown:function(n){var t=this._calculatePosition(n);n.which==1&&this.toolService.start(t,this._meta(n))&&(this._destroyToolBar(),n.preventDefault())},_addItem:function(n){n instanceof o?this.addShape(n):n instanceof l&&this.addConnection(n)},_mouseUp:function(n){var t=this._calculatePosition(n);n.which==1&&this.toolService.end(t,this._meta(n))&&(this._createToolBar(),n.preventDefault())},_createToolBar:function(){var s=this.toolService.diagram,t,i,c,n,r,f;if(!this.singleToolBar&&s.select().length===1&&(t=s.select()[0],t&&(i=t.options.editable.tools,this._isEditable&&i.length===0&&(t instanceof o?i=["edit","rotateClockwise","rotateAnticlockwise","delete"]:t instanceof l&&(i=["edit","delete"])),i))){c=20;this.singleToolBar=new yt(s,{tools:i,click:e(this._toolBarClick,this),modal:!0});var y=this.singleToolBar.element,a=this.singleToolBar._popup.element.outerWidth(),v=this.singleToolBar._popup.element.outerHeight();t instanceof o?(r=this.modelToView(t.bounds(it)),n=u(r.x,r.y).minus(u((a-r.width)/2,v+c))):t instanceof l&&(f=this.modelToView(t.bounds()),n=u(f.x,f.y).minus(u((a-f.width-20)/2,v+c)));n?(this.canvas.translate||(n=n.minus(u(this.scroller.scrollLeft,this.scroller.scrollTop))),n=this.viewToDocument(n),n=u(h.max(n.x,0),h.max(n.y,0)),this.singleToolBar.showAt(n)):this._destroyToolBar()}},_toolBarClick:function(n){this.trigger("toolBarClick",n);this._destroyToolBar()},_mouseMove:function(n){if(!this.pauseMouseHandlers){var t=this._calculatePosition(n);(n.which===0||n.which==1)&&this.toolService.move(t,this._meta(n))&&n.preventDefault()}},_keydown:function(n){this.toolService.keyDown(n.keyCode,this._meta(n))&&n.preventDefault()},_wheel:function(n){var t=cu(n),i=this._calculatePosition(n),r=f(this._meta(n),{delta:t});this.toolService.wheel(i,r)&&n.preventDefault()},_meta:function(n){return{ctrlKey:n.ctrlKey,metaKey:n.metaKey,altKey:n.altKey,shiftKey:n.shiftKey}},_calculatePosition:function(n){var i=n.pageX===t?n.originalEvent:n,r=new u(i.pageX,i.pageY);return this.documentToModel(r)},_normalizePointZoom:function(n){return n.times(1/this.zoom())},_initialize:function(){this.shapes=[];this._selectedItems=[];this.connections=[];this._dataMap={};this._connectionsDataMap={};this._inactiveShapeItems=[];this._inactiveConnectionItems=[];this.undoRedoService=new tr;this.id=i.randomId()},_fetchFreshData:function(){var t=this,i;t._dataSource();t._isEditable&&t._connectionDataSource();t.options.autoBind&&(t._isEditable?(t._preventRefresh=!0,t._preventConnectionsRefresh=!0,i=n.map([t.dataSource,t.connectionsDataSource],function(n){return n.fetch()}),n.when.apply(null,i).done(function(){t._preventRefresh=!1;t._preventConnectionsRefresh=!1;t.refresh()})):t.dataSource.fetch())},_dataSource:function(){if(r(this.options.connectionsDataSource)){this._isEditable=!0;var n=this.options.dataSource||{},t=b(n)?{data:n}:n;this.dataSource&&this._shapesRefreshHandler?this.dataSource.unbind("change",this._shapesRefreshHandler).unbind("error",this._shapesErrorHandler):(this._shapesRefreshHandler=e(this._refreshShapes,this),this._shapesErrorHandler=e(this._error,this));this.dataSource=kendo.data.DataSource.create(t).bind("change",this._shapesRefreshHandler).bind("error",this._shapesErrorHandler)}else this._treeDataSource(),this._isEditable=!1},_connectionDataSource:function(){var n=this.options.connectionsDataSource,t;n&&(t=b(n)?{data:n}:n,this.connectionsDataSource&&this._connectionsRefreshHandler?this.connectionsDataSource.unbind("change",this._connectionsRefreshHandler).unbind("error",this._connectionsErrorHandler):(this._connectionsRefreshHandler=e(this._refreshConnections,this),this._connectionsErrorHandler=e(this._error,this)),this.connectionsDataSource=kendo.data.DataSource.create(t).bind("change",this._connectionsRefreshHandler).bind("error",this._connectionsErrorHandler))},_refreshShapes:function(n){n.action==="remove"?this._removeShapes(n.items):n.action==="itemchange"?this._updateShapes(n.items,n.field):n.action==="add"?this._inactiveShapeItems=this._inactiveShapeItems.concat(n.items):n.action==="sync"?this._syncShapes(n.items):this.refresh()},refresh:function(){this._preventRefresh||(this.trigger("dataBound"),this.clear(),this._addShapes(this.dataSource.view()),this.connectionsDataSource&&this._addConnections(this.connectionsDataSource.view()),this.options.layout&&this.layout(this.options.layout))},refreshConnections:function(){this._preventConnectionsRefresh||(this.trigger("dataBound"),this._addConnections(this.connectionsDataSource.view()),this.options.layout&&this.layout(this.options.layout))},_removeShapes:function(n){for(var t=0;t<n.length;t++)this.remove(this._dataMap[n[t].id],!1),this._dataMap[n[t].id]=null},_syncShapes:function(n){for(var f=[],t,r,u,i=0;i<this._inactiveShapeItems.length;i++)for(u=this._inactiveShapeItems[i],t=0;t<n.length;t++)if(r=n[t],u.uid===r.uid){this._addDataItem(r);f.push(u);break}this._inactiveShapeItems=f},_updateShapes:function(n,t){for(var r,u,i=0;i<n.length;i++)r=n[i],u=this._dataMap[r.id],u.updateOptionsFromModel(r,t)},_addShapes:function(n){for(var t=0;t<n.length;t++)this._addDataItem(n[t])},_refreshConnections:function(n){n.action==="remove"?this._removeConnections(n.items):n.action==="add"?(this._inactiveConnectionItems=this._inactiveConnectionItems.concat(n.items),this._addConnections(n.items)):n.action==="sync"?this._syncConnections(n.items):n.action==="itemchange"?this._shouldRefresh&&this._updateConnections(n.items):this.refreshConnections()},_removeConnections:function(n){for(var t=0;t<n.length;t++)this.remove(this._connectionsDataMap[n[t].uid],!1),this._connectionsDataMap[n[t].uid]=null},_syncConnections:function(n){for(var f=[],t,r,u,i=0;i<this._inactiveConnectionItems.length;i++)for(u=this._inactiveConnectionItems[i],t=0;t<n.length;t++)if(r=n[t],u.uid===r.uid){this._addConnectionDataItem(r);f.push(u);break}this._inactiveConnectionDataMaps=f},_updateConnections:function(n){for(var t,r,u,f,i=0;i<n.length;i++)t=n[i],r=this._connectionsDataMap[t.uid],r.updateOptionsFromModel(t),u=this._validateConnector(t.from),u&&r.source(u),f=this._validateConnector(t.to),f&&r.target(f)},_addConnections:function(n){for(var i,r=n.length,t=0;t<r;t++)i=n[t],this._addConnectionDataItem(i)},_addConnectionDataItem:function(n){var t,i,o,e;this._connectionsDataMap[n.uid]||(t=this._validateConnector(n.from),r(t)&&t!==null||(t=new u(n.fromX,n.fromY)),i=this._validateConnector(n.to),r(i)&&i!==null||(i=new u(n.toX,n.toY)),r(t)&&r(i)&&(o=f({},this.options.connectionDefaults),o.dataItem=n,e=new l(t,i,o),e.type(lt),this._connectionsDataMap[n.uid]=e,this.addConnection(e)))},_validateConnector:function(n){var t;return r(n)&&n!==null&&(t=this._dataMap[n]),t},_treeDataSource:function(){var n=this,i=n.options,t=i.dataSource;t=b(t)?{data:t}:t;t.fields||(t.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}]);n.dataSource&&n._refreshHandler&&n._unbindDataSource();n._refreshHandler=e(n._refreshSource,n);n._errorHandler=e(n._error,n);n.dataSource=yi.create(t).bind(nt,n._refreshHandler).bind(ii,n._errorHandler)},_unbindDataSource:function(){var n=this;n.dataSource.unbind(nt,n._refreshHandler).unbind(ii,n._errorHandler)},_error:function(){},_adorn:function(n,i){i!==t&&n&&(i?(this._adorners.push(n),this.adornerLayer.append(n.visual)):(s.remove(this._adorners,n),this.adornerLayer.remove(n.visual)))},_showConnectors:function(n,t){t?this._connectorsAdorner.show(n):this._connectorsAdorner.destroy()},_updateAdorners:function(){for(var n,i=this._adorners,t=0;t<i.length;t++)n=i[t],n.refreshBounds&&n.refreshBounds(),n.refresh()},_refresh:function(){for(var n=0;n<this.connections.length;n++)this.connections[n].refresh()},_destroyToolBar:function(){this.singleToolBar&&(this.singleToolBar.hide(),this.singleToolBar.destroy(),this.singleToolBar=null)},_destroyGlobalToolBar:function(){this.toolBar&&(this.toolBar.hide(),this.toolBar.destroy(),this.toolBar=null)},exportDOMVisual:function(){var n=this.canvas._viewBox,i=ot.transform().translate(-n.x,-n.y),r=new ot.Rect([0,0],[n.width,n.height]),u=et.Path.fromRect(r),t=new et.Group({transform:i,clip:u}),f=this.canvas.drawingElement.children[0];return t.children.push(f),t},exportVisual:function(){var t=ot.transform().scale(1/this._zoom),n=new et.Group({transform:t}),i=this.canvas.drawingElement.children[0];return n.children.push(i),n}});d.ExportMixin.extend(ft.fn,!0);kendo.PDFMixin&&kendo.PDFMixin.extend(ft.fn);var yt=kendo.Observable.extend({init:function(n,t){kendo.Observable.fn.init.call(this);this.diagram=n;this.options=f({},this.options,t);this._tools=[];this.createToolBar();this.createTools();this.appendTools();this.options.modal&&this.createPopup();this.bind(this.events,t)},events:["click"],createPopup:function(){this.container=n("<div/>").append(this.element);this._popup=this.container.kendoPopup({}).getKendoPopup()},appendTools:function(){for(var n,t=0;t<this._tools.length;t++)n=this._tools[t],(n.buttons&&n.buttons.length||!r(n.buttons))&&this._toolBar.add(n)},createToolBar:function(){this.element=n("<div/>");this._toolBar=this.element.kendoToolBar({click:e(this.click,this),resizable:!1}).getKendoToolBar();this.element.css("border","none")},createTools:function(){for(var n=0;n<this.options.tools.length;n++)this.createTool(this.options.tools[n])},createTool:function(n){lr(n)?n.name?this[n.name+"Tool"](n):n.template&&this._toolBar.add({template:n.template}):(n=this[n+"Tool"]({}),n&&n.call(this))},showAt:function(n){this._popup&&this._popup.open(n.x,n.y)},hide:function(){this._popup&&this._popup.close()},newGroup:function(){return{type:"buttonGroup",buttons:[]}},editTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-pencil",showText:"overflow",type:"button",text:"Edit",attributes:this._setAttributes({action:"edit"})})},deleteTool:function(){this._tools.push({spriteCssClass:"k-icon k-i-close",showText:"overflow",type:"button",text:"Delete",attributes:this._setAttributes({action:"delete"})})},rotateAnticlockwiseTool:function(n){this._appendGroup("rotate");this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotateccw",showText:"overflow",text:"RotateAnticlockwise",group:"rotate",attributes:this._setAttributes({action:"rotateAnticlockwise",step:n.step})})},rotateClockwiseTool:function(n){this._appendGroup("rotate");this._rotateGroup.buttons.push({spriteCssClass:"k-icon k-i-rotatecw",attributes:this._setAttributes({action:"rotateClockwise",step:n.step}),showText:"overflow",text:"RotateClockwise",group:"rotate"})},createShapeTool:function(){this._appendGroup("create");this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-shape",showText:"overflow",text:"CreateShape",group:"create",attributes:this._setAttributes({action:"createShape"})})},createConnectionTool:function(){this._appendGroup("create");this._createGroup.buttons.push({spriteCssClass:"k-icon k-i-connector",showText:"overflow",text:"CreateConnection",group:"create",attributes:this._setAttributes({action:"createConnection"})})},undoTool:function(){this._appendGroup("history");this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-undo",showText:"overflow",text:"Undo",group:"history",attributes:this._setAttributes({action:"undo"})})},redoTool:function(){this._appendGroup("history");this._historyGroup.buttons.push({spriteCssClass:"k-icon k-i-redo",showText:"overflow",text:"Redo",group:"history",attributes:this._setAttributes({action:"redo"})})},_appendGroup:function(n){var t="_"+n+"Group";this[t]||(this[t]=this.newGroup(),this._tools.push(this[t]))},_setAttributes:function(n){var t={};return n.action&&(t[kendo.attr("action")]=n.action),n.step&&(t[kendo.attr("step")]=n.step),t},_getAttributes:function(n){var t={},r=n.attr(kendo.attr("action")),i;return r&&(t.action=r),i=n.attr(kendo.attr("step")),i&&(t.step=i),t},click:function(t){var r=this._getAttributes(n(t.target)),i=r.action;i&&this[i](r);this.trigger("click",this.eventData(i))},eventData:function(n){var t=this.selectedElements(),i=[],r=[];return t instanceof o?i.push(t):r.push(t),{shapes:i,connections:r,action:n}},"delete":function(){this.diagram.remove(this.selectedElements(),!0)},edit:function(){this.diagram.edit(this.selectedElements()[0])},rotateClockwise:function(n){var i=this.selectedElements(),t=parseFloat(n.step||90);this._rotate(t)},rotateAnticlockwise:function(n){var i=this.selectedElements(),t=parseFloat(n.step||90);this._rotate(-t)},_rotate:function(n){var t=this.diagram._resizingAdorner;t.angle(t.angle()+n);t.rotate()},selectedElements:function(){return this.diagram.select()},createShape:function(){this.diagram.createShape()},createConnection:function(){this.diagram.createConnection()},undo:function(){this.diagram.undo()},redo:function(){this.diagram.redo()},destroy:function(){this.diagram=null;this.element=null;this.options=null;this._toolBar&&this._toolBar.destroy();this._popup&&this._popup.destroy()}}),pt=kendo.Observable.extend({init:function(n,t){kendo.Observable.fn.init.call(this);this.options=vi(!0,{},this.options,t);this.element=n;this.model=this.options.model;this.fields=this._getFields();this._initContainer();this.createEditable()},options:{editors:{}},_initContainer:function(){this.wrapper=this.element},createEditable:function(){var n=this.options;this.editable=new kendo.ui.Editable(this.wrapper,{fields:this.fields,target:n.target,clearContainer:!1,model:this.model})},_isEditable:function(n){return this.model.editable&&this.model.editable(n)},_getFields:function(){var r=[],u=this.model.fields,n,t,i;for(n in u)t={},this._isEditable(n)&&(i=this.options.editors[n],i&&(t.editor=i),t.field=n,r.push(t));return r},end:function(){return this.editable.end()},destroy:function(){this.editable.destroy();this.editable.element.find("["+kendo.attr("container-for")+"]").empty();this.model=this.wrapper=this.element=this.columns=this.editable=null}}),yu=pt.extend({init:function(n,t){pt.fn.init.call(this,n,t);this.bind(this.events,this.options);this.open()},events:["update","cancel"],options:{window:{modal:!0,resizable:!1,draggable:!0,title:"Edit",visible:!1}},_initContainer:function(){var i=this,t;this.wrapper=n('<div class="k-popup-edit-form"/>').attr(kendo.attr("uid"),this.model.uid);t="";this.options.template?(t+=this._renderTemplate(),this.fields=[]):t+=this._renderFields();t+=this._renderButtons();this.wrapper.append(n('<div class="k-edit-form-container"/>').append(t));this.window=new kendo.ui.Window(this.wrapper,this.options.window);this.window.bind("close",function(n){n.userTriggered&&(n.sender.element.focus(),i._cancelClick())});this._attachButtonEvents()},_renderTemplate:function(){var n=this.options.template;return typeof n=="string"&&(n=window.unescape(n)),kendo.template(n)(this.model)},_renderFields:function(){for(var n,t="",i=0;i<this.fields.length;i++)n=this.fields[i],t+='<div class="k-edit-label"><label for="'+n.field+'">'+(n.field||"")+"<\/label><\/div>",this._isEditable(n.field)&&(t+="<div "+kendo.attr("container-for")+'="'+n.field+'" class="k-edit-field"><\/div>');return t},_renderButtons:function(){var n='<div class="k-edit-buttons k-state-default">';return n+=this._createButton("update"),n+=this._createButton("cancel"),n+"<\/div>"},_createButton:function(n){return kendo.template(hu)(ci[n])},_attachButtonEvents:function(){this._cancelClickHandler=e(this._cancelClick,this);this.window.element.on(tt+c,"a.k-diagram-cancel",this._cancelClickHandler);this._updateClickHandler=e(this._updateClick,this);this.window.element.on(tt+c,"a.k-diagram-update",this._updateClickHandler)},_updateClick:function(n){n.preventDefault();this.trigger("update")},_cancelClick:function(n){n.preventDefault();this.trigger("cancel")},open:function(){this.window.center().open()},close:function(){this.window.bind("deactivate",e(this.destroy,this)).close()},destroy:function(){this.window.close().destroy();this.window.element.off(tt+c,"a.k-diagram-cancel",this._cancelClickHandler);this.window.element.off(tt+c,"a.k-diagram-update",this._updateClickHandler);this._cancelClickHandler=null;this._editUpdateClickHandler=null;this.window=null;pt.fn.destroy.call(this)}});d.ui.plugin(ft);f(i,{Shape:o,Connection:l,Connector:v,DiagramToolBar:yt})}(window.kendo.jQuery),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});
//# sourceMappingURL=kendo.dataviz.diagram.min.js.map
