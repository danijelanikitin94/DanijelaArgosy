(function(n,t){t(["./kendo.listview","./kendo.dropdownlist","./kendo.upload"],n)})(function(){return function(n,t){function ft(n,t,i){var r,u;n.on("dragenter"+e,function(){t();u=new Date;r||(r=setInterval(function(){var n=new Date-u;n>100&&(i(),clearInterval(r),r=null)},100))}).on("dragover"+e,function(){u=new Date})}function nt(n,i){return n!==t&&n.match(/\/$/)||(n=(n||"")+"/"),n+i}function tt(n){if(!n)return"";var t=" bytes";return n>=1073741824?(t=" GB",n/=1073741824):n>=1048576?(t=" MB",n/=1048576):n>=1024&&(t=" KB",n/=1024),Math.round(n*100)/100+t}function ot(n,t){var i=n[t];return v(i)?i.from||i.field||t:i}var i=window.kendo,o=i.ui.Widget,v=n.isPlainObject,r=n.proxy,p=n.extend,y=i.support.placeholder,k=i.support.browser,d=i.isFunction,w=/(^\/|\/$)/g,s="change",g="apply",l="error",a="click",e=".kendoFileBrowser",h=".kendoBreadcrumbs",c=".kendoSearchBox",f="name",b="size",u="type",it={field:u,dir:"asc"},rt=i.template('<li class="k-tile-empty"><strong>${text}<\/strong><\/li>'),ut='<div class="k-widget k-filebrowser-toolbar k-header k-floatwrap"><div class="k-toolbar-wrap"># if (showUpload) { # <div class="k-widget k-upload"><div class="k-button k-button-icontext k-upload-button"><span class="k-icon k-add"><\/span>#=messages.uploadFile#<input type="file" name="file" /><\/div><\/div># } ## if (showCreate) { #<button type="button" class="k-button k-button-icon"><span class="k-icon k-addfolder" /><\/button># } ## if (showDelete) { #<button type="button" class="k-button k-button-icon k-state-disabled"><span class="k-icon k-delete" /><\/button>&nbsp;# } #<\/div><div class="k-tiles-arrange"><label>#=messages.orderBy#: <select /><\/label><\/a><\/div><\/div>',et;p(!0,i.data,{schemas:{filebrowser:{data:function(n){return n.items||n||[]},model:{id:"name",fields:{name:"name",size:"size",type:"type"}}}}});p(!0,i.data,{transports:{filebrowser:i.data.RemoteTransport.extend({init:function(t){i.data.RemoteTransport.fn.init.call(this,n.extend(!0,{},this.options,t))},_call:function(t,r){r.data=n.extend({},r.data,{path:this.options.path()});d(this.options[t])?this.options[t].call(this,r):i.data.RemoteTransport.fn[t].call(this,r)},read:function(n){this._call("read",n)},create:function(n){this._call("create",n)},destroy:function(n){this._call("destroy",n)},update:function(){},options:{read:{type:"POST"},update:{type:"POST"},create:{type:"POST"},destroy:{type:"POST"}}})}});et=k.msie&&k.version<8?function(n){return n.offsetTop}:function(t){return t.offsetTop-n(t).height()};var st=o.extend({init:function(n,t){var i=this;t=t||{};o.fn.init.call(i,n,t);i.element.addClass("k-filebrowser");i.element.on(a+e,".k-filebrowser-toolbar button:not(.k-state-disabled):has(.k-delete)",r(i._deleteClick,i)).on(a+e,".k-filebrowser-toolbar button:not(.k-state-disabled):has(.k-addfolder)",r(i._addClick,i)).on("keydown"+e,"li.k-state-selected input",r(i._directoryKeyDown,i)).on("blur"+e,"li.k-state-selected input",r(i._directoryBlur,i));i._dataSource();i.refresh();i.path(i.options.path)},options:{name:"FileBrowser",messages:{uploadFile:"Upload",orderBy:"Arrange by",orderByName:"Name",orderBySize:"Size",directoryNotFound:"A directory with this name was not found.",emptyFolder:"Empty Folder",deleteFile:'Are you sure you want to delete "{0}"?',invalidFileType:'The selected file "{0}" is not valid. Supported file types are {1}.',overwriteFile:'A file with name "{0}" already exists in the current directory. Do you want to overwrite it?',dropFilesHere:"drop file here to upload",search:"Search"},transport:{},path:"/",fileTypes:"*.*"},events:[l,s,g],destroy:function(){var n=this;o.fn.destroy.call(n);n.dataSource.unbind(l,n._errorHandler);n.element.add(n.list).add(n.toolbar).off(e);i.destroy(n.element)},value:function(){var r=this,e=r._selectedItem(),n,t=r.options.transport.fileUrl;if(e&&e.get(u)==="f")return n=nt(r.path(),e.get(f)).replace(w,""),t&&(n=d(t)?t(n):i.format(t,encodeURIComponent(n))),n},_selectedItem:function(){var t=this.listView,n=t.select();if(n.length)return this.dataSource.getByUid(n.attr(i.attr("uid")))},_toolbar:function(){var t=this,f=i.template(ut),u=t.options.messages,e=[{text:u.orderByName,value:"name"},{text:u.orderBySize,value:"size"}];t.toolbar=n(f({messages:u,showUpload:t.options.transport.uploadUrl,showCreate:t.options.transport.create,showDelete:t.options.transport.destroy})).appendTo(t.element).find(".k-upload input").kendoUpload({multiple:!1,localization:{dropFilesHere:u.dropFilesHere},async:{saveUrl:t.options.transport.uploadUrl,autoUpload:!0},upload:r(t._fileUpload,t),error:function(n){t._error({xhr:n.XMLHttpRequest,status:"error"})}}).end();t.upload=t.toolbar.find(".k-upload input").data("kendoUpload");t.arrangeBy=t.toolbar.find(".k-tiles-arrange select").kendoDropDownList({dataSource:e,dataTextField:"text",dataValueField:"value",change:function(){t.orderBy(this.value())}}).data("kendoDropDownList");t._attachDropzoneEvents()},_attachDropzoneEvents:function(){var t=this;t.options.transport.uploadUrl&&(ft(n(document.documentElement),n.proxy(t._dropEnter,t),n.proxy(t._dropLeave,t)),t._scrollHandler=r(t._positionDropzone,t))},_dropEnter:function(){this._positionDropzone();n(document).on("scroll"+e,this._scrollHandler)},_dropLeave:function(){this._removeDropzone();n(document).off("scroll"+e,this._scrollHandler)},_positionDropzone:function(){var t=this,n=t.element,i=n.offset();t.toolbar.find(".k-dropzone").addClass("k-filebrowser-dropzone").offset(i).css({width:n[0].clientWidth,height:n[0].clientHeight,lineHeight:n[0].clientHeight+"px"})},_removeDropzone:function(){this.toolbar.find(".k-dropzone").removeClass("k-filebrowser-dropzone").css({width:"",height:"",lineHeight:"",top:"",left:""})},_deleteClick:function(){var n=this,t=n.listView.select(),r=i.format(n.options.messages.deleteFile,t.find("strong").text());t.length&&n._showMessage(r,"confirm")&&n.listView.remove(t)},_addClick:function(){this.createDirectory()},_getFieldName:function(n){return ot(this.dataSource.reader.model.fields,n)},_fileUpload:function(n){var t=this,e=t.options,o=e.fileTypes,c=new RegExp(("("+o.split(",").join(")|(")+")").replace(/\*\./g,".*."),"i"),u=n.files[0].name,s=f,h=b,r;if(c.test(u))if(n.data={path:t.path()},r=t._createFile(u),r)t.upload.one("success",function(n){r.set(s,n.response[t._getFieldName(s)]);r.set(h,n.response[t._getFieldName(h)]);t._tiles=t.listView.items().filter("["+i.attr("type")+"=f]")});else n.preventDefault();else n.preventDefault(),t._showMessage(i.format(e.messages.invalidFileType,u,o))},_findFile:function(n){var i=this.dataSource.data(),t,r,o=u,s=f,e;for(n=n.toLowerCase(),t=0,e=i.length;t<e;t++)if(i[t].get(o)==="f"&&i[t].get(s).toLowerCase()===n){r=i[t];break}return r},_createFile:function(n){var t=this,r,s,h=0,e={},c=u,l=t.dataSource.view(),o=t._findFile(n);if(o&&!t._showMessage(i.format(t.options.messages.overwriteFile,n),"confirm"))return null;if(o)return o;for(r=0,s=l.length;r<s;r++)if(l[r].get(c)==="f"){h=r;break}return e[c]="f",e[f]=n,e[b]=0,t.dataSource.insert(++h,e)},createDirectory:function(){for(var n=this,s=0,h=u,e=f,c=n.dataSource.data(),l=n._nameDirectory(),r=new n.dataSource.reader.model,t=0,o=c.length;t<o;t++)c[t].get(h)==="d"&&(s=t);r.set(h,"d");r.set(e,l);n.listView.one("dataBound",function(){var t=n.listView.items().filter("["+i.attr("uid")+"="+r.uid+"]"),u=t.find("input");t.length&&this.edit(t);this.element.scrollTop(t.attr("offsetTop")-this.element[0].offsetHeight);setTimeout(function(){u.select()})}).one("save",function(t){var i=t.model.get(e);i?t.model.set(e,n._nameExists(i,r.uid)?n._nameDirectory():i):t.model.set(e,l)});n.dataSource.insert(++s,r)},_directoryKeyDown:function(n){n.keyCode==13&&n.currentTarget.blur()},_directoryBlur:function(){this.listView.save()},_nameExists:function(n,t){for(var r=this.dataSource.data(),o=u,s=f,i=0,e=r.length;i<e;i++)if(r[i].get(o)==="d"&&r[i].get(s).toLowerCase()===n.toLowerCase()&&r[i].uid!==t)return!0;return!1},_nameDirectory:function(){for(var i="New folder",r=this.dataSource.data(),e=[],c=u,s=f,o,t=0,h=r.length;t<h;t++)r[t].get(c)==="d"&&r[t].get(s).toLowerCase().indexOf(i.toLowerCase())>-1&&e.push(r[t].get(s));if(n.inArray(i,e)>-1){t=2;do o=i+" ("+t+")",t++;while(n.inArray(o,e)>-1);i=o}return i},orderBy:function(n){this.dataSource.sort([{field:u,dir:"asc"},{field:n,dir:"asc"}])},search:function(n){this.dataSource.filter({field:f,operator:"contains",value:n})},_content:function(){var t=this;t.list=n('<ul class="k-reset k-floats k-tiles" />').appendTo(t.element).on("dblclick"+e,"li",r(t._dblClick,t));t.listView=new i.ui.ListView(t.list,{dataSource:t.dataSource,template:t._itemTmpl(),editTemplate:t._editTmpl(),selectable:!0,autoBind:!1,dataBinding:function(n){t.toolbar.find(".k-delete").parent().addClass("k-state-disabled");(n.action==="remove"||n.action==="sync")&&n.preventDefault()},dataBound:function(){t.dataSource.view().length?t._tiles=this.items().filter("["+i.attr("type")+"=f]"):this.wrapper.append(rt({text:t.options.messages.emptyFolder}))},change:r(t._listViewChange,t)})},_dblClick:function(t){var r=this,u=n(t.currentTarget),e;u.hasClass("k-edit-item")&&r._directoryBlur();u.filter("["+i.attr("type")+"=d]").length?(e=r.dataSource.getByUid(u.attr(i.attr("uid"))),e&&(r.path(nt(r.path(),e.get(f))),r.breadcrumbs.value(r.path()))):u.filter("["+i.attr("type")+"=f]").length&&r.trigger(g)},_listViewChange:function(){var n=this._selectedItem();n&&(this.toolbar.find(".k-delete").parent().removeClass("k-state-disabled"),n.get(u)==="f"&&this.trigger(s))},_dataSource:function(){var n=this,u=n.options,t=u.transport,o=p({},it),s={field:f,dir:"asc"},h,e={type:t.type||"filebrowser",sort:[o,s]};v(t)&&(t.path=r(n.path,n),e.transport=t);v(u.schema)?e.schema=u.schema:t.type&&v(i.data.schemas[t.type])&&(h=i.data.schemas[t.type]);n.dataSource&&n._errorHandler?n.dataSource.unbind(l,n._errorHandler):n._errorHandler=r(n._error,n);n.dataSource=i.data.DataSource.create(e).bind(l,n._errorHandler)},_navigation:function(){var t=this,i=n('<div class="k-floatwrap"><input/><input/><\/div>').appendTo(this.element);t.breadcrumbs=i.find("input:first").kendoBreadcrumbs({value:t.options.path,change:function(){t.path(this.value())}}).data("kendoBreadcrumbs");t.searchBox=i.parent().find("input:last").kendoSearchBox({label:t.options.messages.search,change:function(){t.search(this.value())}}).data("kendoSearchBox")},_error:function(n){var t=this,i;t.trigger(l,n)||(i=n.xhr.status,n.status=="error"?i=="404"?t._showMessage(t.options.messages.directoryNotFound):i!="0"&&t._showMessage("Error! The requested URL returned "+i+" - "+n.xhr.statusText):i=="timeout"&&t._showMessage("Error! Server timeout."))},_showMessage:function(n,t){return window[t||"alert"](n)},refresh:function(){var n=this;n._navigation();n._toolbar();n._content()},_editTmpl:function(){var n='<li class="k-tile k-state-selected" '+i.attr("uid")+'="#=uid#" ';return n+=i.attr("type")+'="${'+u+'}">',n+="#if("+u+' == "d") { #',n+='<div class="k-thumb"><span class="k-icon k-folder"><\/span><\/div>',n+="#}else{#",n+='<div class="k-thumb"><span class="k-icon k-loading"><\/span><\/div>',n+="#}#",n+="#if("+u+' == "d") { #',n+='<input class="k-input" '+i.attr("bind")+'="value:'+f+'"/>',n+="#}#",n+="<\/li>",r(i.template(n),{sizeFormatter:tt})},_itemTmpl:function(){var t=this,n='<li class="k-tile" '+i.attr("uid")+'="#=uid#" ';return n+=i.attr("type")+'="${'+u+'}">',n+="#if("+u+' == "d") { #',n+='<div class="k-thumb"><span class="k-icon k-folder"><\/span><\/div>',n+="#}else{#",n+='<div class="k-thumb"><span class="k-icon k-file"><\/span><\/div>',n+="#}#",n+="<strong>${"+f+"}<\/strong>",n+="#if("+u+' == "f") { # <span class="k-filesize">${this.sizeFormatter('+b+")}<\/span> #}#",n+="<\/li>",r(i.template(n),{sizeFormatter:tt})},path:function(n){var r=this,i=r._path||"";if(n!==t){r._path=n.replace(w,"")+"/";r.dataSource.read({path:r._path});return}return i&&(i=i.replace(w,"")),i==="/"||i===""?"":i+"/"}}),ht=o.extend({init:function(n,t){var i=this;t=t||{};o.fn.init.call(i,n,t);y&&i.element.attr("placeholder",i.options.label);i._wrapper();i.element.on("keydown"+c,r(i._keydown,i)).on("change"+c,r(i._updateValue,i));i.wrapper.on(a+c,"a",r(i._click,i));if(!y)i.element.on("focus"+c,r(i._focus,i)).on("blur"+c,r(i._blur,i))},options:{name:"SearchBox",label:"Search",value:""},events:[s],destroy:function(){var n=this;n.wrapper.add(n.element).add(n.label).off(c);o.fn.destroy.call(n)},_keydown:function(n){n.keyCode===13&&this._updateValue()},_click:function(n){n.preventDefault();this._updateValue()},_updateValue:function(){var n=this,t=n.element.val();t!==n.value()&&(n.value(t),n.trigger(s))},_blur:function(){this._updateValue();this._toggleLabel()},_toggleLabel:function(){y||this.label.toggle(!this.element.val())},_focus:function(){this.label.hide()},_wrapper:function(){var t=this.element,i=t.parents(".k-search-wrap");t[0].style.width="";t.addClass("k-input");i.length||(i=t.wrap(n('<div class="k-widget k-search-wrap k-textbox"/>')).parent(),y||n('<label style="display:block">'+this.options.label+"<\/label>").insertBefore(t),n('<a href="#" class="k-icon k-i-search k-search"/>').appendTo(i));this.wrapper=i;this.label=i.find(">label")},value:function(n){var i=this;if(n!==t){i.options.value=n;i.element.val(n);i._toggleLabel();return}return i.options.value}}),ct=o.extend({init:function(n,t){var i=this;t=t||{};o.fn.init.call(i,n,t);i._wrapper();i.wrapper.on("focus"+h,"input",r(i._focus,i)).on("blur"+h,"input",r(i._blur,i)).on("keydown"+h,"input",r(i._keydown,i)).on(a+h,"a.k-i-arrow-n:first",r(i._rootClick,i)).on(a+h,"a:not(.k-i-arrow-n)",r(i._click,i));i.value(i.options.value)},options:{name:"Breadcrumbs",gap:50},events:[s],destroy:function(){var n=this;o.fn.destroy.call(n);n.wrapper.add(n.wrapper.find("input")).add(n.wrapper.find("a")).off(h)},_update:function(n){n=(n||"").charAt(0)==="/"?n:"/"+(n||"");n!==this.value()&&(this.value(n),this.trigger(s))},_click:function(t){t.preventDefault();this._update(this._path(n(t.target).prevAll("a:not(.k-i-arrow-n)").addBack()))},_rootClick:function(n){n.preventDefault();this._update("")},_focus:function(){var n=this,t=n.element;n.overlay.hide();n.element.val(n.value());setTimeout(function(){t.select()})},_blur:function(){if(!this.overlay.is(":visible")){var n=this,t=n.element,i=t.val().replace(/\/{2,}/g,"/");n.overlay.show();t.val("");n._update(i)}},_keydown:function(n){var t=this;n.keyCode===13&&(t._blur(),setTimeout(function(){t.overlay.find("a:first").focus()}))},_wrapper:function(){var i=this.element,t=i.parents(".k-breadcrumbs"),r;i[0].style.width="";i.addClass("k-input");t.length||(t=i.wrap(n('<div class="k-widget k-breadcrumbs k-textbox"/>')).parent());r=t.find(".k-breadcrumbs-wrap");r.length||(r=n('<div class="k-breadcrumbs-wrap"/>').appendTo(t));this.wrapper=t;this.overlay=r},refresh:function(){var i="",r=this.value(),f,e,u,o;for(r!==t&&r.match(/^\//)||(r="/"+(r||"")),f=r.split("/"),u=0,o=f.length;u<o;u++)e=f[u],e&&(i||(i+='<a href="#" class="k-icon k-i-arrow-n">root<\/a>'),i+='<a class="k-link" href="#">'+f[u]+"<\/a>",i+='<span class="k-icon k-i-arrow-e">&gt;<\/span>');this.overlay.empty().append(n(i));this._adjustSectionWidth()},_adjustSectionWidth:function(){var i=this,f=i.wrapper,r=f.width()-i.options.gap,u=i.overlay.find("a"),t;u.each(function(i){t=n(this);t.parent().width()>r&&(i==u.length-1?t.width(r):t.prev().addBack().hide())})},value:function(n){if(n!==t){this._value=n.replace(/\/{2,}/g,"/");this.refresh();return}return this._value},_path:function(t){return"/"+n.map(t,function(t){return n(t).text()}).join("/")}});i.ui.plugin(st);i.ui.plugin(ct);i.ui.plugin(ht)}(window.kendo.jQuery),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});
//# sourceMappingURL=kendo.filebrowser.min.js.map
