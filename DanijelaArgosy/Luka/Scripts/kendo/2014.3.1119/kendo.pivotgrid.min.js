(function(n,t){t(["./kendo.dom","./kendo.data"],n)})(function(){return function(n,t){function lt(n){var i=typeof n=="string"?[{name:n}]:n,r=h.call(i)==="[object Array]"?i:i!==t?[i]:[];return vt(r,function(n){return typeof n=="string"?{name:n}:{name:n.name,type:n.type}})}function s(n){var i=typeof n=="string"?[{name:[n],expand:!1}]:n,r=h.call(i)==="[object Array]"?i:i!==t?[i]:[];return vt(r,function(n){return typeof n=="string"?{name:[n],expand:!1}:{name:h.call(n.name)==="[object Array]"?n.name.slice():[n.name],expand:n.expand}})}function at(n,t,r,u){var o,f,s,e;if(r||(r=t),u||(u=0),e=r.members[u],e&&!e.measure){if(s=e.children,f=s.length,r===t?n[i.stringify([e.name])]=!!f:f&&(n[i.stringify(tt(r,u))]=!0),f)for(o=0;o<f;o++)at(n,t,s[o],u);at(n,t,r,u+1)}}function er(t){var i={},r,u;t.length&&at(i,t[0]);r=[];for(u in i)r.push({name:n.parseJSON(u),expand:i[u]});return r}function or(n,t){var s=t.tuples||[],e=s[0],r,i,o,f;if(e&&n.length<e.members.length)for(r=e.members,i=0;i<r.length;i++)if(!r[i].measure){for(o=!1,f=0;f<n.length;f++)if(u(n[f]).indexOf(r[i].hierarchy)===0){o=!0;break}o||n.push({name:[r[i].name],expand:!1})}}function sr(n){for(var r=[],i=n.members,t=0;t<i.length;t++)i[t].measure||r.push({name:[i[t].name],expand:i[t].children.length>0});return r}function hr(n,t,i){var u,r;return n=n||{},or(t,n),i.length>1&&t.push({name:"Measures",measure:!0,children:s(i)}),u={members:t},n.tuples&&(r=g(n.tuples,u),r.tuple&&(t=sr(r.tuple))),t}function cr(n,t,r,u,f,e,o){var s,h,y,c,l,w=0,p=t,v,a;for(h in r[u].aggregates)s=r[u].aggregates[h],c=f[h],l=e[h],s=c?c(s):s.accumulator,n[p]={ordinal:p,value:s,fmtValue:l?i.format(l,s):s},++w,p+=o;v=r[u].items;for(y in v){a=v[y].index*w;a=p+a*o;for(h in v[y].aggregates)s=v[y].aggregates[h],c=f[h],l=e[h],s=c?c(s):s.accumulator,n[a]={ordinal:a,value:s,fmtValue:l?i.format(l,s):s},a+=o}}function lr(n,t,r,u,f,e){var o,s,a,h,c,v=0,l,y;for(s in r[u].aggregates)o=r[u].aggregates[s],h=f[s],c=e[s],o=h?h(o):o.accumulator,n[n.length]={ordinal:t++,value:o,fmtValue:c?i.format(c,o):o},++v;l=r[u].items;for(a in l){y=l[a].index*v;for(s in l[a].aggregates)o=l[a].aggregates[s],h=f[s],c=e[s],o=h?h(o):o.accumulator,n[n.length]={ordinal:t+y++,value:o,fmtValue:c?i.format(c,o):o}}}function ar(n){var t=i.getter(n.field,!0);return function(i,r){return n.aggregate(t(i.dataItem),r,i)}}function e(n){return typeof n=="number"&&!isNaN(n)}function ft(n){return n&&n.getTime}function ii(n,t,i){if(n.tuples.length<c(t.tuples,i))return t}function pr(n,t,i,r,u){for(var f,o,s=n.length,l=c(t,r),h=r.length||1,e=0;e<i;e++)for(f=0;f<s;f++)o=ri(n[f],t)*h,o+=f%h,u[e*s+f].ordinal=e*l+o}function wr(n,t,i,r,u){for(var e,o,h=n.length,l=c(t,r),s=r.length||1,f=0;f<h;f++)for(o=ri(n[f],t),o*=s,o+=f%s,e=0;e<i;e++)u[f*i+e].ordinal=o*i+e}function ri(n,t){return g(t,n).index}function c(n,t){if(!n.length)return 0;for(var r=n.slice(),i=r.shift(),u=1;i;)i.members?[].push.apply(r,i.members):i.children&&(i.measure||(u+=i.children.length),[].push.apply(r,i.children)),i=r.shift();return t.length&&(u=u*t.length),u}function et(n){return n||(n={tuples:[]}),n.tuples||(n.tuples=[]),n}function ui(n,t,i){if(!n)return 0;for(var f=Math.max(i.length,1),u=n.members.slice(0,t),r=u.shift();r;)r.children?[].push.apply(u,r.children):(f++,[].push.apply(u,r.members)),r=u.shift();return f}function fi(n,t,i){var u,r,s;if(!t[0])return{parsedRoot:null,tuples:n,memberIndex:0,index:0};if(u=g(n,t[0]),!u.tuple)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};var f=u.tuple.members,e=t[0].members,o=-1;if(f.length!==e.length)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};for(r=0,s=f.length;r<s;r++)!f[r].measure&&e[r].children[0]&&(o==-1&&e[r].children.length&&(o=r),f[r].children=e[r].children);return i=Math.max(i.length,1),{parsedRoot:u.tuple,index:u.index*i,memberIndex:o,tuples:n}}function br(n,t){var r=!0,i,f;for(n=n.members,t=t.members,i=0,f=n.length;i<f;i++)n[i].measure||t[i].measure||(r=r&&u(n[i])===u(t[i]));return r}function g(n,t){for(var i,f,r=0,e,h,o,u=0,s=n.length;u<s;u++){if(i=n[u],br(i,t))return{tuple:i,index:r};for(r++,e=0,h=i.members.length;e<h;e++)if((o=i.members[e],!o.measure)&&(f=g(o.children,t),r+=f.index,f.tuple))return{tuple:f.tuple,index:r}}return{index:r}}function kr(n,t){for(var r,u="",i=0,f=n.length;i<f;i++)r=n[i],u+=r.name,t[u]||(t[u]=r)}function dr(n,t){for(var o=n.members,i,u="",e="",r,f=0,s=o.length;f<s;f++){if(i=o[f],r)if(t[u+i.name]){u+=i.name;r=t[u];continue}else return t[u+i.parentName]?t[u+i.parentName]:(i.parentName&&(e+=i.parentName),t[e]);if(u+=i.name,r=t[i.parentName],!r&&(r=t[u],!r))return null;r&&(e+=r.name)}return r}function gr(n,t){var u,r,i,f;if(t.length===0)return-1;for(u=t[0],r=n.members,i=0,f=r.length;i<f;i++)if(r[i].name==u.name)return i}function nu(i,r){if(!(r<0)){var u={name:"Measures",measure:!0,children:[n.extend({members:[],dataIndex:i.dataIndex},i.members[r])]};i.members.splice(r,1,u);i.dataIndex=t}}function ei(n,t){var r,i,u;if(n.length<1)return[];var e=[],o={},f=gr(n[0],t);for(r=0;r<n.length;r++)i=n[r],i.dataIndex=r,nu(i,f),u=dr(i,o),u?f<0||!u.measure?u.children.push(i):u.children.push(i.members[f].children[0]):e.push(i),kr(i.members,o);return e}function tu(n,t){if(!n||!n.length)return t;for(var e=[],o=oi(n),s=o.length,u=Math.max(t.length/s,1),r,h,c,f,i=0;i<s;i++)for(h=u*i,c=u*o[i],r=0;r<u;r++)f=parseInt(c+r,10),e[parseInt(h+r,10)]=t[f]||{value:"",fmtValue:"",ordinal:f};return e}function iu(n,t){if(!n||!n.length)return t;for(var o=[],s=oi(n),u=s.length,h=Math.max(t.length/u,1),i,f,e,r=0;r<h;r++)for(f=u*r,i=0;i<u;i++)e=s[i]+f,o[f+i]=t[e]||{value:"",fmtValue:"",ordinal:e};return o}function oi(n){n=n.slice();for(var o=[],i=n.shift(),r,s,f,u,e;i;){for(i.dataIndex!==t&&o.push(i.dataIndex),f=0,r=0,s=i.members.length;r<s;r++)e=i.members[r],u=e.children,e.measure?[].splice.apply(n,[0,0].concat(u)):[].splice.apply(n,[f,0].concat(u)),f+=u.length;i=n.shift()}return o}function si(n){var t=n.split(".");return t.length>2?t[0]+"."+t[1]:n}function hi(n,t){var u=n.length-1,i=n[u],r;return r=ru(t,i),r&&r.dir?i="ORDER("+i+".Children,"+r.field+".CurrentMember.MEMBER_CAPTION,"+r.dir+")":i+=".Children",n[u]=i,n}function ru(n,t){for(var i=0,r=n.length;i<r;i++)if(t.indexOf(n[i].field)===0)return n[i];return null}function ci(n){var t="CROSSJOIN({",i;return n.length>2?(i=n.pop(),t+=ci(n)):(t+=n.shift(),i=n.pop()),t+="},{",t+=i,t+"})"}function li(n,t){var i=n.slice(0);return t.length>1&&i.push("{"+ot(t).join(",")+"}"),ci(i)}function ot(n){for(var r=0,f=n.length,u=[],i;r<f;r++)i=n[r],u.push(i.name!==t?i.name:i);return u}function u(n){return n=n.name||n,h.call(n)==="[object Array]"&&(n=n[n.length-1]),n}function uu(n){for(var r=n.length,i=[],t=0;t<r;t++)i.push(n[t].name[0]);return i}function fu(n,t){var r,f,i,u=0,e=n.length,o=t.length;for(t=t.slice(0);u<e;u++)for(r=n[u],i=0;i<o;i++)if(f=si(t[i]),r.indexOf(f)!==-1){t[i]=r;break}return t}function eu(n){for(var r=[],s=[],u=[],t,f,c,e=0,a=n.length,i,l,o;e<a;e++)if(t=n[e],i=t.name,o=!1,h.call(i)!=="[object Array]"&&(t.name=i=[i]),i.length>1)s.push(t);else{for(l=si(i[0]),f=0,c=u.length;f<c;f++)if(u[f].name[0].indexOf(l)===0){o=!0;break}o||u.push(t);t.expand&&r.push(t)}return r=r.concat(s),{root:u,expanded:r}}function ai(n,t,i){var s="";n=n||[];var r=eu(n),l=r.root,f=uu(l),h=[];r=r.expanded;var c=r.length,u=0,e,o=[];if(f.length>1||t.length>1){for(h.push(li(f,t));u<c;u++)e=hi(r[u].name,i),o=fu(e,f),h.push(li(o,t));s+=h.join(",")}else{for(;u<c;u++)e=hi(r[u].name,i),o.push(e[0]);s+=f.concat(o).join(",")}return s}function ou(n){var t="",r=n.value,u=n.field,f=n.operator;return f=="in"?(t+="{",t+=r,t+="}"):(t+="Filter(",t+=u+".Children",t+=i.format(vi[f],u,r),t+=")"),t}function su(n,t){for(var u="",i,f=n.filters,e=f.length,r=e-1;r>=0;r--)i="SELECT (",i+=ou(f[r]),i+=") ON 0",r==e-1?(i+=" FROM ["+t+"]",u=i):u=i+" FROM ( "+u+" )";return u}function yi(n,t,i){var u="",f,r;if(t){u+="<"+n+">";for(r in t)f=t[r],i&&(r=r.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g,"$1_").toUpperCase().replace(/_$/,"")),u+="<"+r+">"+f+"<\/"+r+">";u+="<\/"+n+">"}else u+="<"+n+"/>";return u}function nt(n){if(n==null)return[];var t=h.call(n);return t!=="[object Array]"?[n]:n}function wi(n){for(var f,r,t,e={tuples:[]},o=nt(i.getter("Tuples.Tuple",!0)(n)),s=i.getter("Caption['#text']"),h=i.getter("UName['#text']"),c=i.getter("LName['#text']"),l=i.getter("LNum['#text']"),a=i.getter("CHILDREN_CARDINALITY['#text']",!0),v=i.getter("['@Hierarchy']"),y=i.getter("PARENT_UNIQUE_NAME['#text']",!0),u=0;u<o.length;u++){for(f=[],r=nt(o[u].Member),t=0;t<r.length;t++)f.push({children:[],caption:s(r[t]),name:h(r[t]),levelName:c(r[t]),levelNum:l(r[t]),hasChildren:parseInt(a(r[t]),10)>0,parentName:y(r[t]),hierarchy:v(r[t])});e.tuples.push({members:f})}return e}var i=window.kendo,st=i.ui,w=i.Class,v=st.Widget,b=i.data.DataSource,h={}.toString,o=function(n){return n},vt=n.map,f=n.extend,yt=i.isFunction,a="change",pt="error",wt="progress",ht="stateReset",y="auto",it="<div/>",k=".kendoPivotGrid",rt="__row_total__",bt="dataBinding",kt="dataBound",dt="expandMember",gt="collapseMember",ut="k-i-arrow-s",ct="k-i-arrow-e",ni="#: data.member.caption || data.member.name #",ir='<span class="k-icon k-i-kpi-#=data.dataItem.value > 0 ? "open" : data.dataItem.value < 0 ? "denied" : "hold"#">#:data.dataItem.value#<\/span>',rr='<span class="k-icon k-i-kpi-#=data.dataItem.value > 0 ? "increase" : data.dataItem.value < 0 ? "decrease" : "equal"#">#:data.dataItem.value#<\/span>',ur='#= data.dataItem ? kendo.htmlEncode(data.dataItem.fmtValue || data.dataItem.value) || "&nbsp;" : "&nbsp;" #',fr='<table class="k-pivot-layout"><tr><td><div class="k-pivot-rowheaders"><\/div><\/td><td><div class="k-pivot-table k-state-default"><\/div><\/td><\/tr><\/table>',vr={sum:function(n,t){var i=t.accumulator;return e(i)?e(n)&&(i+=n):i=n,i},count:function(n,t){return(t.accumulator||0)+1},average:{aggregate:function(n,i){var r=i.accumulator;return i.count===t&&(i.count=0),e(r)?e(n)&&(r+=n):r=n,e(n)&&i.count++,r},result:function(n){var t=n.accumulator;return e(t)&&(t=t/n.count),t}},max:function(n,t){var i=t.accumulator;return e(i)||ft(i)||(i=n),i<n&&(e(n)||ft(n))&&(i=n),i},min:function(n,t){var i=t.accumulator;return e(i)||ft(i)||(i=n),i>n&&(e(n)||ft(n))&&(i=n),i}},ti=w.extend({init:function(n){this.options=f({},this.options,n);this.dimensions=this._normalizeDescriptors("field",this.options.dimensions);this.measures=this._normalizeDescriptors("name",this.options.measures)},_normalizeDescriptors:function(n,t){var r,i,u,f;if(t=t||{},r={},h.call(t)==="[object Array]"){for(u=0,f=t.length;u<f;u++)i=t[u],typeof i=="string"?r[i]={}:i[n]&&(r[i[n]]=i);t=r}return t},_asTuples:function(n,i,r){var l;r=r||[];var y=this.dimensions||[],c=[],s,o,a,e,h,f,v=r.length||1;if(i.length||r.length)for(e=0;e<v;e++){for(s={members:[]},o=0,a=i.length;o<a;o++)f=u(i[o].name),s.members[s.members.length]={children:[],caption:(y[f]||{}).caption||"All",name:f,levelName:f,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:f};v>1&&(s.members[s.members.length]={children:[],caption:r[e].caption,name:r[e].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!1,parentName:t,hierarchy:"MEASURES"});c[c.length]=s}for(l in n)for(e=0;e<v;e++){for(h={members:[]},o=0,a=i.length;o<a;o++)f=u(i[o].name),h.members[h.members.length]=n[l].parentName.indexOf(f)===0?{children:[],caption:n[l].value,name:n[l].name,levelName:n[l].name,levelNum:1,hasChildren:!1,parentName:f,hierarchy:f}:{children:[],caption:(y[f]||{}).caption||"All",name:f,levelName:f,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:f};v>1&&(h.members[h.members.length]={children:[],caption:r[e].caption,name:r[e].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!0,parentName:t,hierarchy:"MEASURES"});c[c.length]=h}return c},_toDataArray:function(n,t,i,r,u){var h={},c={},v,f,e,l=0,y=i&&i.length,o,s,a;if(y)for(v=this.measures||{};l<y;l++)e=i[l].name,f=v[e],f.result&&(c[e]=f.result),f.format&&(h[e]=f.format);o=[];s=0;u(o,s,n,rt,c,h,t);for(a in n)a!==rt&&(s+=r,u(o,s,n,a,c,h,t));return o},_matchDescriptors:function(n,t,i,r){for(var e,f,o,s,h;r>0;)if(e=t[--r],f=u(e).split("&"),f.length>1&&(o=f[0],s=f[1],h=i[o],h(n)!=s))return!1;return!0},_isExpanded:function(n){for(var t=0,i=n.length;t<i;t++)if(n[t].expand)return!0;return!1},_calculateAggregate:function(n,t,i){for(var e={},r,f,u=0;u<n.length;u++)f=n[u].descriptor.name,r=i.aggregates[f]||{},r.accumulator=n[u].aggregator(t,r),e[f]=r;return e},_processColumns:function(n,i,r,f,e,o,s,h){for(var l,v,c,y,p,w=e.dataItem,a=0;a<i.length;a++)if(v=i[a],v.expand){if(!this._matchDescriptors(w,i,r,a))continue;c=u(v);l=r[c](w);l=l!==t?l.toString():l;c=c+"&"+l;y=f[c]||{index:s.columnIndex,name:c,parentName:c,value:l};p=o.items[c]||{aggregates:{}};o.items[c]={index:y.index,aggregates:this._calculateAggregate(n,e,p)};h&&(f[c]||s.columnIndex++,f[c]=y)}},_measureAggregators:function(n){var u=n.measures||[],h=this.measures||{},f=[],e,t,r,s,i,o;if(u.length){for(r=0,s=u.length;r<s;r++)if(e=u[r],t=h[e.name],i=null,t){if(o=t.aggregate,typeof o=="string"){if(i=vr[o.toLowerCase()],!i)throw new Error("There is no such aggregate function");t.aggregate=i.aggregate||i;t.result=i.result}f.push({descriptor:e,caption:t.caption,result:t.result,aggregator:ar(t)})}}else f.push({descriptor:{name:"default"},caption:"default",aggregator:function(){return 1}});return f},_buildGetters:function(n){for(var f={},o,t,r,e=0,s=n.length;e<s;e++)o=n[e],r=u(o),t=r.split("&"),t.length>1?f[t[0]]=i.getter(t[0],!0):f[r]=i.getter(r,!0);return f},process:function(n,i){var k,v,ot,y,st,p,w,ht,nt,d,b,tt,ct;n=n||[];i=i||{};var g=i.measures||[],l=i.measuresAxis==="rows",r=(l?i.rows:i.columns)||[],f=(l?i.columns:i.rows)||[];!r.length&&f.length&&(!g.length||g.length&&l)&&(r=f,f=[],l=!1);r.length||f.length||(l=!1);!r.length&&g.length&&(r=s(i.measures));var o={},e={},c={},h,it={columnIndex:0},a=this._measureAggregators(i),ut=this._buildGetters(r),ft=this._buildGetters(f),et=!1;if(r.length||f.length)for(ot=this._isExpanded(f),et=!0,y=0,st=n.length;y<st;y++)for(k=n[y],v={dataItem:k,index:y},p=o[rt]||{items:{},aggregates:{}},this._processColumns(a,r,ut,e,v,p,it,!ot),p.aggregates=this._calculateAggregate(a,v,p),o[rt]=p,w=0,ht=f.length;w<ht;w++)if(nt=f[w],nt.expand){if(!this._matchDescriptors(k,f,ft,w))continue;d=u(nt);h=ft[d](k);h=h!==t?h.toString():h;c[h]={name:d+"&"+h,parentName:d,value:h};b=o[h]||{items:{},aggregates:{}};this._processColumns(a,r,ut,e,v,b,it,!0);b.aggregates=this._calculateAggregate(a,v,b);o[h]=b}return et&&n.length?(a.length>1&&(!i.columns||!i.columns.length)&&(r=[]),e=this._asTuples(e,r,a),c=this._asTuples(c,f,[]),tt=e.length,l&&(tt=1,ct=e,e=c,c=ct),o=this._toDataArray(o,e.length,i.measures,tt,l?cr:lr),o=this._normalizeData(o,e.length,c.length)):o=e=c=[],{axes:{columns:{tuples:e},rows:{tuples:c}},data:o}},_normalizeData:function(n,t,i){var f=(t||1)*(i||1),e=new Array(f),o=n.length,u,r;if(o===f)return n;for(r=0;r<f;r++)e[r]={value:"",fmtValue:"",ordinal:r};for(r=0;r<o;r++)u=n[r],u&&(e[u.ordinal]=u);return e}}),yr=w.extend({init:function(n,t){this.transport=t;this.options=t.options||{};this.transport.discover||yt(n.discover)&&(this.discover=n.discover)},read:function(n){return this.transport.read(n)},update:function(n){return this.transport.update(n)},create:function(n){return this.transport.create(n)},destroy:function(n){return this.transport.destroy(n)},discover:function(n){if(this.transport.discover)return this.transport.discover(n);n.success({})},catalog:function(i){var u=this.options||{},r;if(i===t)return(u.connection||{}).catalog;r=u.connection||{};r.catalog=i;this.options.connection=r;n.extend(this.transport.options,{connection:r})},cube:function(n){var r=this.options||{},i;if(n===t)return(r.connection||{}).cube;i=r.connection||{};i.cube=n;this.options.connection=i;f(!0,this.transport.options,{connection:i})}}),d=b.extend({init:function(t){var i=((t||{}).schema||{}).cube,e="columns",r,u={axes:o,cubes:o,catalogs:o,measures:o,dimensions:o,hierarchies:o,levels:o,members:o};i&&(u=n.extend(u,this._cubeSchema(i)),this.cubeBuilder=new ti(i));b.fn.init.call(this,f(!0,{},{schema:u},t));this.transport=new yr(this.options.transport||{},this.transport);this._columns=s(this.options.columns);this._rows=s(this.options.rows);r=this.options.measures||[];this.options.measures!==null&&h.call(this.options.measures)==="[object Object]"&&(r=this.options.measures.values||[],e=this.options.measures.axis||"columns");this._measures=lt(r||[]);this._measuresAxis=e;this._axes={}},_cubeSchema:function(n){return{dimensions:function(){var i=[],r=n.dimensions;for(var t in r)i.push({name:t,caption:r[t].caption||t,uniqueName:t,defaultHierarchy:t,type:1});return n.measures&&i.push({name:"Measures",caption:"Measures",uniqueName:"Measures",type:2}),i},hierarchies:function(){return[]},measures:function(){var i=[],r=n.measures;for(var t in r)i.push({name:t,caption:t,uniqueName:t,aggregator:t});return i}}},options:{serverSorting:!0,serverPaging:!0,serverFiltering:!0,serverGrouping:!0,serverAggregates:!0},catalog:function(n){if(n===t)return this.transport.catalog();this.transport.catalog(n);this._mergeState({});this._axes={};this.data([])},cube:function(n){if(n===t)return this.transport.cube();this.transport.cube(n);this._axes={};this._mergeState({});this.data([])},axes:function(){return this._axes},columns:function(n){if(n===t)return this._columns;this._clearAxesData=!0;this._columns=s(n);this.query({columns:n,rows:this.rowsAxisDescriptors(),measures:this.measures()})},rows:function(n){if(n===t)return this._rows;this._clearAxesData=!0;this._rows=s(n);this.query({columns:this.columnsAxisDescriptors(),rows:n,measures:this.measures()})},measures:function(n){if(n===t)return this._measures;this._clearAxesData=!0;this.query({columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:lt(n)})},measuresAxis:function(){return this._measuresAxis||"columns"},_expandPath:function(n,t){var e=t==="columns"?"columns":"rows",o=t==="columns"?"rows":"columns",i=s(n),c=u(i[i.length-1]),r,h,f;for(this._lastExpanded=e,i=hr(this.axes()[e],i,this.measures()),r=0;r<i.length;r++)if(h=u(i[r]),h===c){if(i[r].expand)return;i[r].expand=!0}else i[r].expand=!1;f={};f[e]=i;f[o]=this._descriptorsForAxis(o);this._query(f)},_descriptorsForAxis:function(n){var t=this.axes(),i=this[n]()||[];return t&&t[n]&&t[n].tuples&&t[n].tuples[0]&&(i=er(t[n].tuples||[])),i},columnsAxisDescriptors:function(){return this._descriptorsForAxis("columns")},rowsAxisDescriptors:function(){return this._descriptorsForAxis("rows")},_process:function(n,t){this._view=n;t=t||{};t.items=t.items||this._view;this.trigger(a,t)},_query:function(n){var t=this;return n||(this._clearAxesData=!0),t.query(f({},{page:t.page(),pageSize:t.pageSize(),sort:t.sort(),filter:t.filter(),group:t.group(),aggregate:t.aggregate(),columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:this.measures()},n))},query:function(t){var i=this._mergeState(t);return this._data.length&&this.cubeBuilder?(this._params(i),this._updateLocalData(this._pristineData),n.Deferred().resolve().promise()):this.read(i)},_mergeState:function(n){return n=b.fn._mergeState.call(this,n),n!==t&&(this._measures=lt(n.measures),n.columns?n.columns=s(n.columns):n.columns||(this._columns=[]),n.rows?n.rows=s(n.rows):n.rows||(this._rows=[])),n},filter:function(n){if(n===t)return this._filter;this._clearAxesData=!0;this._query({filter:n,page:1})},expandColumn:function(n){this._expandPath(n,"columns")},expandRow:function(n){this._expandPath(n,"rows")},success:function(n){var t;this.cubeBuilder&&(t=(this.reader.data(n)||[]).slice(0));b.fn.success.call(this,n);t&&(this._pristineData=t)},_processResult:function(n,t){var f,o;this.cubeBuilder&&(f=this.cubeBuilder.process(n,this._requestData),n=f.data,t=f.axes);var s,h,u,i,r,e,l=this.columns().length,a=this.rows().length,v=t.columns&&t.columns.tuples;return!l&&a&&v&&(this._rowMeasures().length||!this.measures().length)&&(t={columns:{},rows:t.columns}),l||a||this.measuresAxis()!=="rows"||!v||(t={columns:{},rows:t.columns}),this._axes={columns:et(this._axes.columns),rows:et(this._axes.rows)},t={columns:et(t.columns),rows:et(t.rows)},s=this._normalizeTuples(t.columns.tuples,this._axes.columns.tuples,this._columnMeasures()),h=this._normalizeTuples(t.rows.tuples,this._axes.rows.tuples,this._rowMeasures()),this.cubeBuilder||(n=this._normalizeData({columnsLength:t.columns.tuples.length,rowsLength:t.rows.tuples.length,columnIndexes:s,rowIndexes:h,data:n})),this._lastExpanded=="rows"?(u=t.columns.tuples,r=this._columnMeasures(),i=ii(t.columns,this._axes.columns,r),i&&(e="columns",t.columns=i,pr(u,i.tuples,t.rows.tuples.length,r,n),n=this._normalizeData({columnsLength:c(t.columns.tuples,r),rowsLength:t.rows.tuples.length,data:n}))):this._lastExpanded=="columns"&&(u=t.rows.tuples,r=this._rowMeasures(),i=ii(t.rows,this._axes.rows,r),i&&(e="rows",t.rows=i,wr(u,i.tuples,t.columns.tuples.length,r,n),n=this._normalizeData({columnsLength:c(t.rows.tuples,r),rowsLength:t.columns.tuples.length,data:n}))),this._lastExpanded=null,o=this._mergeAxes(t,n,e),this._axes=o.axes,o.data},_readData:function(n){var t=this.reader.axes(n),i=this.reader.data(n);return this._processResult(i,t)},_createTuple:function(n,t,i){var f,r,u,c=n.members,l=c.length,o={members:[]},e,s,h=0;for(t&&(l-=1);h<l;h++)r=c[h],e=Number(r.levelNum),f=r.name,u=r.parentName,s=r.caption||f,i&&(s="All",e===0?u=r.name:e-=1,f=u),o.members.push({name:f,children:[],caption:s,levelName:u,levelNum:e.toString(),hasChildren:i,hierarchy:u,parentName:i?"":u});return t&&o.members.push({name:t.name,children:[]}),o},_hasRoot:function(n,t){var r,f,u,e,i,o;if(t.length)return g(t,n).tuple;for(r=n.members,u=!0,i=0,o=r.length;i<o;i++)if(f=r[i],e=Number(f.levelNum)||0,e!==0){u=!1;break}return u},_mergeAxes:function(n,t,i){var f=this._columnMeasures(),s=this._rowMeasures(),u=this.axes(),h,r,a=n.rows.tuples.length,v=c(u.columns.tuples,f),l=n.columns.tuples.length,e,o,y;return i=="columns"?(l=v,r=n.columns.tuples):(r=ei(n.columns.tuples,f),t=iu(r,t)),e=fi(u.columns.tuples,r,f),i=="rows"?(a=c(n.rows.tuples,s),r=n.rows.tuples):(r=ei(n.rows.tuples,s),t=tu(r,t)),o=fi(u.rows.tuples,r,s),u.columns.tuples=e.tuples,u.rows.tuples=o.tuples,v!==c(u.columns.tuples,f)?(h=e.index+ui(e.parsedRoot,e.memberIndex,f),y=v+l,t=this._mergeColumnData(t,h,a,l,y)):(h=o.index+ui(o.parsedRoot,o.memberIndex,s),t=this._mergeRowData(t,h,a,l)),{axes:u,data:t}},_mergeColumnData:function(n,t,i,r,u){var e=this.data().toJSON(),f,s,h=0,o,c=Math.max(this._columnMeasures().length,1);for(i=Math.max(i,1),e.length>0&&(h=c,u-=c),f=0;f<i;f++)s=t+f*u,o=n.splice(0,r),o.splice(0,h),[].splice.apply(e,[s,0].concat(o));return e},_mergeRowData:function(n,t,i,r){var f=this.data().toJSON(),u,e,o,s=Math.max(this._rowMeasures().length,1);for(r=Math.max(r,1),f.length>0&&(i-=s,n.splice(0,r*s)),u=0;u<i;u++)o=n.splice(0,r),e=t*r+u*r,[].splice.apply(f,[e,0].concat(o));return f},_columnMeasures:function(){var n=this.measures(),t=[];return this.measuresAxis()==="columns"&&(this.columns().length===0?t=n:n.length>1&&(t=n)),t},_rowMeasures:function(){var n=this.measures(),t=[];return this.measuresAxis()==="rows"&&(this.rows().length===0?t=n:n.length>1&&(t=n)),t},_updateLocalData:function(n,t){this.cubeBuilder&&(t&&(this._requestData=t),n=this._processResult(n));this._data=this._observe(n);this._ranges=[];this._addRange(this._data);this._total=this._data.length;this._pristineTotal=this._total;this._process(this._data)},data:function(n){var i=this;if(n!==t)this._pristineData=n.slice(0),this._updateLocalData(n,{columns:this.columns(),rows:this.rows(),measures:this.measures()});else return i._data},_normalizeTuples:function(n,t,i){var e=i.length||1,r=0,c=[],o={},f=0,u,s,h;if(n.length){if(!this._hasRoot(n[0],t)){for(;r<e;r++)c.push(this._createTuple(n[0],i[r],!0)),o[r]=r;n.splice.apply(n,[0,n.length].concat(c).concat(n));r=e}if(i.length)for(h=u=n[r],s=u.members.length-1;u;){if(f>=e&&(f=0),u.members[s].name!==i[f].name&&(n.splice(r,0,this._createTuple(u,i[f])),o[r]=r),r+=1,f+=1,u=n[r],e>f&&(!u||tr(h,s-1)!==tr(u,s-1))){for(;f<e;f++)n.splice(r,0,this._createTuple(h,i[f])),o[r]=r,r+=1;u=n[r]}h=u}return o}},_normalizeData:function(n){var o=n.data,l=n.columnIndexes||{},a=n.rowIndexes||{},e=n.columnsLength||1,s=e*(n.rowsLength||1),i=0,c=0,f=0,r,h,u=new Array(s);if(o.length===s)return o;for(;i<s;i++){if(a[parseInt(i/e,10)]!==t)for(h=0;h<e;h++)u[i]={value:"",fmtValue:"",ordinal:i},i+=1;if(l[i%e]!==t&&(u[i]={value:"",fmtValue:"",ordinal:i},i+=1),r=o[c],r){if(r.ordinal-f>1)for(f+=1;f<r.ordinal;f++)u[i]={value:"",fmtValue:"",ordinal:i},i+=1;f=r.ordinal;r.ordinal=i;u[i]=r;c+=1}else u[i]={value:"",fmtValue:"",ordinal:i}}return u},discover:function(t,i){var r=this,u=r.transport;return n.Deferred(function(n){u.discover(f({success:function(t){(t=r.reader.parse(t),r._handleCustomErrors(t))||(i&&(t=i(t)),n.resolve(t))},error:function(t,i,u){n.reject(t);r.error(t,i,u)}},t))}).promise().done(function(){r.trigger("schemaChange")})},schemaMeasures:function(){var n=this;return n.discover({data:{command:"schemaMeasures",restrictions:{catalogName:n.transport.catalog(),cubeName:n.transport.cube()}}},function(t){return n.reader.measures(t)})},schemaKPIs:function(){var n=this;return n.discover({data:{command:"schemaKPIs",restrictions:{catalogName:n.transport.catalog(),cubeName:n.transport.cube()}}},function(t){return n.reader.kpis(t)})},schemaDimensions:function(){var n=this;return n.discover({data:{command:"schemaDimensions",restrictions:{catalogName:n.transport.catalog(),cubeName:n.transport.cube()}}},function(t){return n.reader.dimensions(t)})},schemaHierarchies:function(n){var t=this;return t.discover({data:{command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:n}}},function(n){return t.reader.hierarchies(n)})},schemaLevels:function(n){var t=this;return t.discover({data:{command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:n}}},function(n){return t.reader.levels(n)})},schemaCubes:function(){var n=this;return n.discover({data:{command:"schemaCubes",restrictions:{catalogName:n.transport.catalog()}}},function(t){return n.reader.cubes(t)})},schemaCatalogs:function(){var n=this;return n.discover({data:{command:"schemaCatalogs"}},function(t){return n.reader.catalogs(t)})},schemaMembers:function(n){var t=this;return t.discover({data:{command:"schemaMembers",restrictions:f({catalogName:t.transport.catalog(),cubeName:t.transport.cube()},n)}},function(n){return t.reader.members(n)})},_params:function(n){this._clearAxesData&&(this._axes={},this._data=this._observe([]),this._clearAxesData=!1,this.trigger(ht));var t=b.fn._params.call(this,n);return t=f({measures:this.measures(),measuresAxis:this.measuresAxis(),columns:this.columns(),rows:this.rows()},t),this.cubeBuilder&&(this._requestData=t),t}}),vi,di,gi;d.create=function(n){n=n&&n.push?{data:n}:n;var t=n||{},r=t.data;if(t.data=r,!(t instanceof d)&&t instanceof i.data.DataSource)throw new Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof d?t:new d(t)};vi={contains:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") > 0',doesnotcontain:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") = 0',startswith:', Left({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',endswith:', Right({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',eq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',neq:', NOT {0}.CurrentMember.MEMBER_CAPTION = "{1}"'};var hu={schemaCubes:"MDSCHEMA_CUBES",schemaCatalogs:"DBSCHEMA_CATALOGS",schemaMeasures:"MDSCHEMA_MEASURES",schemaDimensions:"MDSCHEMA_DIMENSIONS",schemaHierarchies:"MDSCHEMA_HIERARCHIES",schemaLevels:"MDSCHEMA_LEVELS",schemaMembers:"MDSCHEMA_MEMBERS",schemaKPIs:"MDSCHEMA_KPIS"},cu={read:function(n){var t='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement>SELECT NON EMPTY {';var f=n.columns||[],r=n.rows||[],i=n.measures||[],u=n.measuresAxis==="rows",e=n.sort||[];return!f.length&&r.length&&(!i.length||i.length&&u)&&(f=r,r=[],u=!1),f.length||r.length||(u=!1),f.length?t+=ai(f,u?[]:i,e):i.length&&!u&&(t+=ot(i).join(",")),t+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS",(r.length||u&&i.length>1)&&(t+=", NON EMPTY {",t+=r.length?ai(r,u?i:[],e):ot(i).join(","),t+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS"),n.filter?(t+=" FROM ",t+="(",t+=su(n.filter,n.connection.cube),t+=")"):t+=" FROM ["+n.connection.cube+"]",i.length==1&&f.length&&(t+=" WHERE ("+ot(i).join(",")+")"),t+="<\/Statement><\/Command><Properties><PropertyList><Catalog>"+n.connection.catalog+"<\/Catalog><Format>Multidimensional<\/Format><\/PropertyList><\/Properties><\/Execute><\/Body><\/Envelope>",t.replace(/\&/g,"&amp;")},discover:function(t){t=t||{};var i='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis">';return i+="<RequestType>"+(hu[t.command]||t.command)+"<\/RequestType>",i+="<Restrictions>"+yi("RestrictionList",t.restrictions,!0)+"<\/Restrictions>",t.connection&&t.connection.catalog&&(t.properties=n.extend({},{Catalog:t.connection.catalog},t.properties)),i+="<Properties>"+yi("PropertyList",t.properties)+"<\/Properties>",i+"<\/Discover><\/Body><\/Envelope>"}},pi=i.data.RemoteTransport.extend({init:function(n){var t=n;n=this.options=f(!0,{},this.options,n);i.data.RemoteTransport.call(this,n);yt(t.discover)?this.discover=t.discover:typeof t.discover=="string"?this.options.discover={url:t.discover}:t.discover||(this.options.discover=this.options.read)},setup:function(t,r){return t.data=t.data||{},n.extend(!0,t.data,{connection:this.options.connection}),i.data.RemoteTransport.fn.setup.call(this,t,r)},options:{read:{dataType:"text",contentType:"text/xml",type:"POST"},discover:{dataType:"text",contentType:"text/xml",type:"POST"},parameterMap:function(n,t){return cu[t](n,t)}},discover:function(t){return n.ajax(this.setup(t,"discover"))}});var l={cubes:{name:i.getter("CUBE_NAME['#text']",!0),caption:i.getter("CUBE_CAPTION['#text']",!0),description:i.getter("DESCRIPTION['#text']",!0),type:i.getter("CUBE_TYPE['#text']",!0)},catalogs:{name:i.getter("CATALOG_NAME['#text']",!0),description:i.getter("DESCRIPTION['#text']",!0)},measures:{name:i.getter("MEASURE_NAME['#text']",!0),caption:i.getter("MEASURE_CAPTION['#text']",!0),uniqueName:i.getter("MEASURE_UNIQUE_NAME['#text']",!0),description:i.getter("DESCRIPTION['#text']",!0),aggregator:i.getter("MEASURE_AGGREGATOR['#text']",!0),groupName:i.getter("MEASUREGROUP_NAME['#text']",!0),displayFolder:i.getter("MEASURE_DISPLAY_FOLDER['#text']",!0),defaultFormat:i.getter("DEFAULT_FORMAT_STRING['#text']",!0)},kpis:{name:i.getter("KPI_NAME['#text']",!0),caption:i.getter("KPI_CAPTION['#text']",!0),value:i.getter("KPI_VALUE['#text']",!0),goal:i.getter("KPI_GOAL['#text']",!0),status:i.getter("KPI_STATUS['#text']",!0),trend:i.getter("KPI_TREND['#text']",!0),statusGraphic:i.getter("KPI_STATUS_GRAPHIC['#text']",!0),trendGraphic:i.getter("KPI_TREND_GRAPHIC['#text']",!0),description:i.getter("KPI_DESCRIPTION['#text']",!0),groupName:i.getter("MEASUREGROUP_NAME['#text']",!0)},dimensions:{name:i.getter("DIMENSION_NAME['#text']",!0),caption:i.getter("DIMENSION_CAPTION['#text']",!0),description:i.getter("DESCRIPTION['#text']",!0),uniqueName:i.getter("DIMENSION_UNIQUE_NAME['#text']",!0),defaultHierarchy:i.getter("DEFAULT_HIERARCHY['#text']",!0),type:i.getter("DIMENSION_TYPE['#text']",!0)},hierarchies:{name:i.getter("HIERARCHY_NAME['#text']",!0),caption:i.getter("HIERARCHY_CAPTION['#text']",!0),description:i.getter("DESCRIPTION['#text']",!0),uniqueName:i.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),dimensionUniqueName:i.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:i.getter("HIERARCHY_DISPLAY_FOLDER['#text']",!0),origin:i.getter("HIERARCHY_ORIGIN['#text']",!0),defaultMember:i.getter("DEFAULT_MEMBER['#text']",!0)},levels:{name:i.getter("LEVEL_NAME['#text']",!0),caption:i.getter("LEVEL_CAPTION['#text']",!0),description:i.getter("DESCRIPTION['#text']",!0),uniqueName:i.getter("LEVEL_UNIQUE_NAME['#text']",!0),dimensionUniqueName:i.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:i.getter("LEVEL_DISPLAY_FOLDER['#text']",!0),orderingProperty:i.getter("LEVEL_ORDERING_PROPERTY['#text']",!0),origin:i.getter("LEVEL_ORIGIN['#text']",!0),hierarchyUniqueName:i.getter("HIERARCHY_UNIQUE_NAME['#text']",!0)},members:{name:i.getter("MEMBER_NAME['#text']",!0),caption:i.getter("MEMBER_CAPTION['#text']",!0),uniqueName:i.getter("MEMBER_UNIQUE_NAME['#text']",!0),dimensionUniqueName:i.getter("DIMENSION_UNIQUE_NAME['#text']",!0),hierarchyUniqueName:i.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),levelUniqueName:i.getter("LEVEL_UNIQUE_NAME['#text']",!0),childrenCardinality:i.getter("CHILDREN_CARDINALITY['#text']",!0)}},bi=["axes","catalogs","cubes","dimensions","hierarchies","levels","measures"],ki=i.data.XmlDataReader.extend({init:function(n){i.data.XmlDataReader.call(this,n);this._extend(n)},_extend:function(n){for(var i=0,u=bi.length,r,t;i<u;i++)r=bi[i],t=n[r],t&&t!==o&&(this[r]=t)},parse:function(n){var t=i.data.XmlDataReader.fn.parse(n.replace(/<(\/?)(\w|-)+:/g,"<$1"));return i.getter("['Envelope']['Body']",!0)(t)},errors:function(n){var t=i.getter("['Fault']",!0)(n);return t?[{faultstring:i.getter("faultstring['#text']",!0)(t),faultcode:i.getter("faultcode['#text']",!0)(t)}]:null},axes:function(n){n=i.getter("ExecuteResponse.return.root",!0)(n);var t=nt(i.getter("Axes.Axis",!0)(n)),u=wi(t[0]),r={};return t.length>2&&(r=wi(t[1])),{columns:u,rows:r}},data:function(n){var t;n=i.getter("ExecuteResponse.return.root",!0)(n);var r=nt(i.getter("CellData.Cell",!0)(n)),u=[],f=i.getter("['@CellOrdinal']"),e=i.getter("Value['#text']"),o=i.getter("FmtValue['#text']");for(t=0;t<r.length;t++)u.push({value:e(r[t]),fmtValue:o(r[t]),ordinal:parseInt(f(r[t]),10)});return u},_mapSchema:function(n,t){var u,f,r,e,o;for(n=i.getter("DiscoverResponse.return.root",!0)(n),u=nt(i.getter("row",!0)(n)),f=[],r=0;r<u.length;r++){e={};for(o in t)e[o]=t[o](u[r]);f.push(e)}return f},measures:function(n){return this._mapSchema(n,l.measures)},kpis:function(n){return this._mapSchema(n,l.kpis)},hierarchies:function(n){return this._mapSchema(n,l.hierarchies)},levels:function(n){return this._mapSchema(n,l.levels)},dimensions:function(n){return this._mapSchema(n,l.dimensions)},cubes:function(n){return this._mapSchema(n,l.cubes)},catalogs:function(n){return this._mapSchema(n,l.catalogs)},members:function(n){return this._mapSchema(n,l.members)}});f(!0,i.data,{PivotDataSource:d,XmlaTransport:pi,XmlaDataReader:ki,PivotCubeBuilder:ti,transports:{xmla:pi},readers:{xmla:ki}});di=function(n,t){if(!n)return null;for(var i=0,r=n.length;i<r;i++)if(n[i].field===t)return n[i];return null};gi=function(n,t){for(var r=[],i=0,u=n.length;i<u;i++)n[i].field!==t&&r.push(n[i]);return r};i.ui.PivotSettingTarget=v.extend({init:function(t,r){var u=this;v.fn.init.call(u,t,r);u.element.addClass("k-pivot-setting");u.dataSource=i.data.PivotDataSource.create(r.dataSource);u._refreshHandler=n.proxy(u.refresh,u);u.dataSource.first(a,u._refreshHandler);r.template||(u.options.template="<div data-"+i.ns+'name="${data.name || data}">${data.name || data}'+(u.options.enabled?'<a class="k-button k-button-icon k-button-bare"><span class="k-icon k-setting-delete"><\/span><\/a>':"")+"<\/div>");u.template=i.template(u.options.template);u.emptyTemplate=i.template(u.options.emptyTemplate);u._sortable();u.element.on("click"+k,".k-button,.k-item",function(t){var r=n(t.target),f=r.closest("["+i.attr("name")+"]").attr(i.attr("name"));f&&(r.hasClass("k-setting-delete")?u.remove(f):u.options.sortable&&r[0]===t.currentTarget&&u.sort({field:f,dir:r.find(".k-i-sort-asc")[0]?"desc":"asc"}))});(r.filterable||r.sortable)&&(u.fieldMenu=new st.PivotFieldMenu(u.element,{messages:u.options.messages.fieldMenu,filter:".k-setting-fieldmenu",filterable:r.filterable,sortable:r.sortable,dataSource:u.dataSource}));u.refresh()},options:{name:"PivotSettingTarget",template:null,filterable:!1,sortable:!1,emptyTemplate:"<div class='k-empty'>${data}<\/div>",setting:"columns",enabled:!0,messages:{empty:"Drop Fields Here"}},setDataSource:function(n){this.dataSource.unbind(a,this._refreshHandler);this.dataSource=this.options.dataSource=n;this.fieldMenu&&this.fieldMenu.setDataSource(n);n.first(a,this._refreshHandler);this.refresh()},_sortable:function(){var n=this;n.options.enabled&&(this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,filter:">:not(.k-empty)",hint:n.options.hint,cursor:"move",start:function(n){n.item.focus().blur()},change:function(t){var r=t.item.attr(i.attr("name"));t.action=="receive"?n.add(r):t.action=="remove"?n.remove(r):t.action=="sort"&&n.move(r,t.newIndex)}}).data("kendoSortable"))},_indexOf:function(n,t){for(var f=-1,i=0,r=t.length;i<r;i++)if(u(t[i])===n){f=i;break}return f},_isKPI:function(n){return n.type==="kpi"||n.measure},validate:function(n){var r=n.type==2||"aggregator"in n||this._isKPI(n),t,i;return r?this.options.setting==="measures":this.options.setting==="measures"?r:(t=this.dataSource[this.options.setting](),i=n.defaultHierarchy||n.uniqueName,this._indexOf(i,t)>-1)?!1:(t=this.dataSource[this.options.setting==="columns"?"rows":"columns"](),this._indexOf(i,t)>-1)?!1:!0},add:function(t){var r=this.dataSource[this.options.setting](),i,u;for(t=n.isArray(t)?t.slice(0):[t],i=0,u=t.length;i<u;i++)this._indexOf(t[i],r)!==-1&&(t.splice(i,1),i-=1,u-=1);t.length&&(r=r.concat(t),this.dataSource[this.options.setting](r))},move:function(n,t){var i=this.dataSource[this.options.setting](),r=this._indexOf(n,i);r>-1&&(n=i.splice(r,1)[0],i.splice(t,0,n),this.dataSource[this.options.setting](i))},remove:function(n){var t=this.dataSource[this.options.setting](),i=this._indexOf(n,t);i>-1&&(t.splice(i,1),this.dataSource[this.options.setting](t))},sort:function(n){var i=this.options.sortable,u=i===!0||i.allowUnsort,f=u&&n.dir==="asc",r=this.dataSource.sort()||[],t=gi(r,n.field);f&&r.length!==t.length&&(n=null);n&&t.push(n);this.dataSource.sort(t)},refresh:function(){var i="",u=this.dataSource[this.options.setting](),e=u.length,r=0,n;if(e)for(;r<e;r++)n=u[r],n=n.name===t?{name:n}:n,i+=this.template(f({sortIcon:this._sortIcon(n.name)},n));else i=this.emptyTemplate(this.options.messages.empty);this.element.html(i)},destroy:function(){v.fn.destroy.call(this);this.dataSource.unbind(a,this._refreshHandler);this.element.off(k);this.sortable&&this.sortable.destroy();this.fieldMenu&&this.fieldMenu.destroy();this.element=null;this._refreshHandler=null},_sortIcon:function(n){var r=this.dataSource.sort(),t=di(r,u(n)),i="";return t&&(i="k-i-sort-"+t.dir),i}});var lu=v.extend({init:function(r,u){var f=this,e,o;v.fn.init.call(f,r,u);f._dataSource();f._bindConfigurator();f._wrapper();f._createLayout();f._columnBuilder=e=new au;f._rowBuilder=o=new vu;f._contentBuilder=new yu;f._templates();f.columnsHeader.add(f.rowsHeader).on("click","span.k-icon",function(){var u=n(this),s=e,l="expandColumn",a,h=u.attr(i.attr("path")),c={axis:"columns",path:n.parseJSON(h)};u.parent().is("td")&&(s=o,l="expandRow",c.axis="rows");var r=u.hasClass(ut),v=s.metadata[h],y=v.expanded===t;(a=r?gt:dt,f.trigger(a,c))||(s.metadata[h].expanded=!r,u.toggleClass(ut,!r).toggleClass(ct,r),!r&&y?f.dataSource[l](c.path):f.refresh())});f._scrollable();f.options.autoBind&&f.dataSource.fetch();i.notify(f)},events:[bt,kt,dt,gt],options:{name:"PivotGrid",autoBind:!0,reorderable:!0,filterable:!1,sortable:!1,height:null,columnWidth:100,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null,kpiStatusTemplate:null,kpiTrendTemplate:null,messages:{measureFields:"Drop Data Fields Here",columnFields:"Drop Column Fields Here",rowFields:"Drop Rows Fields Here"}},_templates:function(){var n=this.options.columnHeaderTemplate,t=this.options.rowHeaderTemplate,r=this.options.dataCellTemplate,u=this.options.kpiStatusTemplate,f=this.options.kpiTrendTemplate;this._columnBuilder.template=i.template(n||ni,{useWithBlock:!!n});this._contentBuilder.dataTemplate=i.template(r||ur,{useWithBlock:!!r});this._contentBuilder.kpiStatusTemplate=i.template(u||ir,{useWithBlock:!!u});this._contentBuilder.kpiTrendTemplate=i.template(f||rr,{useWithBlock:!!f});this._rowBuilder.template=i.template(t||ni,{useWithBlock:!!t})},_bindConfigurator:function(){var t=this.options.configurator;t&&n(t).kendoPivotConfigurator("setDataSource",this.dataSource)},cellInfoByElement:function(t){return t=n(t),this.cellInfo(t.index(),t.parent("tr").index())},cellInfo:function(n,t){var u=this._contentBuilder,i=u.columnIndexes[n||0],r=u.rowIndexes[t||0],f;return!i||!r?null:(f=r.index*u.rowLength+i.index,{columnTuple:i.tuple,rowTuple:r.tuple,measure:i.measure||r.measure,dataItem:this.dataSource.view()[f]})},setDataSource:function(n){this.options.dataSource=n;this._dataSource();this.measuresTarget&&this.measuresTarget.setDataSource(n);this.rowsTarget&&this.rowsTarget.setDataSource(n);this.columnsTarget&&this.columnsTarget.setDataSource(n);this._bindConfigurator();this.options.autoBind&&n.fetch()},setOptions:function(n){v.fn.setOptions.call(this,n);this._templates()},_dataSource:function(){var t=this,r=t.options.dataSource;r=n.isArray(r)?{data:r}:r;t.dataSource&&this._refreshHandler?t.dataSource.unbind(a,t._refreshHandler).unbind(ht,t._stateResetHandler).unbind(wt,t._progressHandler).unbind(pt,t._errorHandler):(t._refreshHandler=n.proxy(t.refresh,t),t._progressHandler=n.proxy(t._requestStart,t),t._stateResetHandler=n.proxy(t._stateReset,t),t._errorHandler=n.proxy(t._error,t));t.dataSource=i.data.PivotDataSource.create(r).bind(a,t._refreshHandler).bind(wt,t._progressHandler).bind(ht,t._stateResetHandler).bind(pt,t._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_stateReset:function(){this._columnBuilder.reset();this._rowBuilder.reset()},_wrapper:function(){var n=this.options.height;this.wrapper=this.element.addClass("k-widget k-pivot");n&&this.wrapper.css("height",n)},_measureFields:function(){this.measureFields=n(it).addClass("k-pivot-toolbar k-header k-settings-measures");this.measuresTarget=this._createSettingTarget(this.measureFields,{setting:"measures",messages:{empty:this.options.messages.measureFields}})},_createSettingTarget:function(t,r){var f='<span tabindex="0" class="k-button" data-'+i.ns+'name="${data.name}">${data.name}',e=r.sortable,u="";return e&&(u+="#if (data.sortIcon) {#",u+='<span class="k-icon ${data.sortIcon} k-setting-sort"><\/span>',u+="#}#"),(r.filterable||e)&&(u+='<span class="k-icon k-i-arrowhead-s k-setting-fieldmenu"><\/span>'),this.options.reorderable&&(u+='<span class="k-icon k-si-close k-setting-delete"><\/span>'),u&&(f+='<span class="k-field-actions">'+u+"<\/span>"),f+="<\/span>",new i.ui.PivotSettingTarget(t,n.extend({template:f,emptyTemplate:'<span class="k-empty">${data}<\/span>',enabled:this.options.reorderable,dataSource:this.dataSource},r))},_initSettingTargets:function(){this.columnsTarget=this._createSettingTarget(this.columnFields,{connectWith:this.rowFields,setting:"columns",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.columnFields,fieldMenu:this.options.messages.fieldMenu}});this.rowsTarget=this._createSettingTarget(this.rowFields,{connectWith:this.columnFields,setting:"rows",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.rowFields,fieldMenu:this.options.messages.fieldMenu}})},_createLayout:function(){var t=this,r=n(fr),u=r.find(".k-pivot-rowheaders"),e=r.find(".k-pivot-table"),f=n(it).addClass("k-grid k-widget");t._measureFields();t.columnFields=n(it).addClass("k-pivot-toolbar k-header k-settings-columns");t.rowFields=n(it).addClass("k-pivot-toolbar k-header k-settings-rows");t.columnsHeader=n('<div class="k-grid-header-wrap" />').wrap('<div class="k-grid-header" />');t.columnsHeader.parent().css("padding-right",i.support.scrollbar());t.rowsHeader=n('<div class="k-grid k-widget k-alt"/>');t.content=n('<div class="k-grid-content" />');u.append(t.measureFields);u.append(t.rowFields);u.append(t.rowsHeader);f.append(t.columnsHeader.parent());f.append(t.content);e.append(t.columnFields);e.append(f);t.wrapper.append(r);t.columnsHeaderTree=new i.dom.Tree(t.columnsHeader[0]);t.rowsHeaderTree=new i.dom.Tree(t.rowsHeader[0]);t.contentTree=new i.dom.Tree(t.content[0]);t._initSettingTargets()},_progress:function(n){i.ui.progress(this.wrapper,n)},_resize:function(){var n=this.columnsHeader.children("table");this.content[0].firstChild&&(this._setSectionsWidth(),this._setSectionsHeight(),this._setContentWidth(),this._setContentHeight(),n.css("table-layout",y),clearTimeout(this._layoutTimeout),this._layoutTimeout=setTimeout(function(){n.css("table-layout","fixed")}))},_setSectionsWidth:function(){var t=this.rowsHeader,i=t.parent(".k-pivot-rowheaders").width(y),n;n=Math.max(this.measureFields.outerWidth(),this.rowFields.outerWidth());n=Math.max(t.children("table").width(),n);i.width(n)},_setSectionsHeight:function(){var t=this.measureFields.height(y).height(),i=this.columnFields.height(y).height(),n=this.rowFields.height(y).innerHeight(),r=this.columnsHeader.height(y).innerHeight(),e=n-this.rowFields.height(),u=i>t?i:t,f=r>n?r:n;this.measureFields.height(u);this.columnFields.height(u);this.rowFields.height(f-e);this.columnsHeader.height(f)},_setContentWidth:function(){var n=this.content.find("table"),t=this.content.width(),u=n.children("colgroup").children().length,i=100,r=u*this.options.columnWidth;t<r&&(i=Math.ceil(r/t*100));n.add(this.columnsHeader.children("table")).css("min-width",i+"%")},_setContentHeight:function(){var r=this,u=r.content,e=r.rowsHeader,n=r.wrapper.innerHeight(),t=i.support.scrollbar(),f=u[0].offsetHeight===u[0].clientHeight;if(r.wrapper.is(":visible")){if(!n){f&&(t=0);e.height(u.height()-t);return}n-=r.columnFields.outerHeight();n-=r.columnsHeader.outerHeight();n<=t*2&&(n=t*2+1,f||(n+=t));u.height(n);f&&(t=0);e.height(n-t)}},_axisMeasures:function(n){var r=[],i=this.dataSource,t=i.measures(),u=t.length>1||t[0]&&t[0].type;return i.measuresAxis()===n&&(i[n]().length===0||u)&&(r=t),r},refresh:function(){var n=this,f=n.dataSource,e=f.axes(),h=(e.columns||{}).tuples||[],c=(e.rows||{}).tuples||[],t=n._columnBuilder,u=n._rowBuilder,o={},s={},r;n.trigger(bt,{action:"rebind"})||(t.measures=this._axisMeasures("columns"),n.columnsHeaderTree.render(t.build(h)),n.rowsHeaderTree.render(u.build(c)),o={indexes:t._indexes,measures:t.measures,metadata:t.metadata},s={indexes:u._indexes,measures:this._axisMeasures("rows"),metadata:u.metadata},n.contentTree.render(n._contentBuilder.build(f.view(),o,s)),n._resize(),n.touchScroller?n.touchScroller.contentResized():(r=i.touchScroller(n.content),r&&r.movable&&(n.touchScroller=r,r.movable.bind("change",function(t){n.columnsHeader.scrollLeft(-t.sender.x);n.rowsHeader.scrollTop(-t.sender.y)}))),n._progress(!1),n.trigger(kt))},_scrollable:function(){var t=this,r=t.columnsHeader,i=t.rowsHeader;t.content.scroll(function(){r.scrollLeft(this.scrollLeft);i.scrollTop(this.scrollTop)});i.bind("DOMMouseScroll"+k+" mousewheel"+k,n.proxy(t._wheelScroll,t))},_wheelScroll:function(t){if(!t.ctrlKey){var r=i.wheelDeltaY(t),u=this.content.scrollTop();if(r){t.preventDefault();n(t.currentTarget).one("wheel"+k,!1);this.rowsHeader.scrollTop(u+-r);this.content.scrollTop(u+-r)}}}}),r=i.dom.element,p=i.dom.html,bu=i.dom.text,nr=function(n,t){return{maxChildren:0,children:0,maxMembers:0,members:0,measures:1,levelNum:n,parentMember:t!==0}},tt=function(n,t){for(var r=[],i=0;i<=t;i++)r.push(n.members[i].name);return r},tr=function(n,t){for(var r="",i=0;i<=t;i++)r+=n.members[i].name;return r},au=w.extend({init:function(){this.measures=1;this.metadata={}},build:function(n){var t=this._tbody(n),i=this._colGroup();return[r("table",null,[i,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var i=this._rowLength(),n=[],t=0;t<i;t++)n.push(r("col",null));return r("colgroup",null,n)},_tbody:function(n){var t=n[0];return this.map={},this.rows=[],this.rootTuple=t,this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(r("tr",null,[r("th",null,[p("&nbsp;")])])),r("tbody",null,this.rows)},_normalize:function(){for(var f=this.rows,o=f.length,i=0,n,e,t,r,u;i<o;i++)if(n=f[i],n.rowSpan!==1)for(r=n.children,t=0,e=r.length;t<e;t++)u=r[t],u.tupleAll&&(u.attr.rowSpan=n.rowSpan)},_rowIndex:function(n){for(var i=this.rows,r=i.length,t=0;t<r;t++)if(i[t]===n)break;return t},_rowLength:function(){var i=this.rows[0]?this.rows[0].children:[],r=i.length,n=0,t=0;if(r)for(;t<r;t++)n+=i[t].attr.colSpan||1;return n||(n=this.measures),n},_row:function(n,t,i){var s=this.rootTuple.members[t].name,h=n.members[t].levelNum,c=s+h,e=this.map,f,o,u=e[c];return u?(u.notFirst=!1,u.parentMember&&u.parentMember===i||(u.parentMember=i,u.colSpan=0)):(u=r("tr",null,[]),u.parentMember=i,u.colSpan=0,u.rowSpan=1,e[c]=u,f=e[s+(Number(h)-1)],f&&(o=f.children,u.notFirst=o[1]&&o[1].attr.className.indexOf("k-alt")===-1?!0:f.notFirst),this.rows.splice(this._rowIndex(f)+1,0,u)),u},_measures:function(n,t,i){var o=this.map,u=o.measureRow,s,f,e;for(u||(u=r("tr",null,[]),o.measureRow=u,this.rows.push(u)),f=0,e=n.length;f<e;f++)s=n[f],u.children.push(r("th",{className:"k-header"+(i||"")},[this._content(s,t)]));return e},_content:function(n,t){return p(this.template({member:n,tuple:t}))},_cell:function(n,t){return r("th",{className:"k-header"+n},t)},_buildRows:function(n,t,u){var d=n.members,s=d[t],h=d[t+1],o,y,p,c,l,v,w,b=[],a,k=0,e,f;if(s.measure){this._measures(s.children,n);return}if(a=i.stringify(tt(n,t)),o=this._row(n,t,u),p=s.children,c=p.length,f=this.metadata[a],f||(this.metadata[a]=f=nr(Number(s.levelNum),t)),this._indexes.push({path:a,tuple:n}),s.hasChildren&&(f.expanded===!1&&(c=0,f.children=0),w={className:"k-icon "+(c?ut:ct)},w[i.attr("path")]=a,b.push(r("span",w))),b.push(this._content(s,n)),l=this._cell(o.notFirst?" k-first":"",b),o.children.push(l),o.colSpan+=1,c){for(v=this._cell(" k-alt",[this._content(s,n)]),o.children.push(v);k<c;k++)y=this._buildRows(p[k],t,s);e=y.colSpan;l.attr.colSpan=e;f.children=e;f.members=1;o.colSpan+=e;o.rowSpan=y.rowSpan+1;h&&(e=h.measure?this._measures(h.children,n," k-alt"):this._buildRows(n,t+1).colSpan,v.attr.colSpan=e,e-=1,f.members+=e,o.colSpan+=e)}else h&&(e=h.measure?this._measures(h.children,n):this._buildRows(n,t+1).colSpan,f.members=e,e>1&&(l.attr.colSpan=e,o.colSpan+=e-1));return f.maxChildren<f.children&&(f.maxChildren=f.children),f.maxMembers<f.members&&(f.maxMembers=f.members),(v||l).tupleAll=!0,o}}),vu=w.extend({init:function(){this.metadata={}},build:function(n){var t=this._tbody(n),i=this._colGroup();return[r("table",null,[i,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var i=this.rows[0].children.length,n=[],t=0;t<i;t++)n.push(r("col",null));return r("colgroup",null,n)},_tbody:function(n){var t=n[0];return this.rootTuple=t,this.rows=[],this.map={},this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(r("tr",null,[r("td",null,[p("&nbsp;")])])),r("tbody",null,this.rows)},_normalize:function(){for(var o=this.rows,c=o.length,r=0,u=this.rootTuple.members,s=u[0].name,l=u.length,n=0,t,i,f,h=this.map,e;r<c;r++)for(t=o[r],n=0;n<l;n++)f=this[u[n].name],i=t.colSpan["dim"+n],i&&i.levelNum<f&&(i.attr.colSpan=f-i.levelNum+1);t=h[s];e=h[s+"all"];t&&(t.children[0].attr.className="k-first");e&&(e.children[0].attr.className+=" k-first")},_row:function(n){var t=r("tr",null,n);return t.rowSpan=1,t.colSpan={},this.rows.push(t),t},_content:function(n,t){return p(this.template({member:n,tuple:t}))},_buildRows:function(n,t){var p=this.map,a,it=n.members,e=it[t],rt=it[t+1],w=e.children,s=w.length,v=Number(e.levelNum)+1,b=this.rootTuple.members[t].name,k=tt(n,t-1).join(""),ft=k+(e.parentName||""),u=p[ft+"all"]||p[ft],y,h,f,d,g=[],c,l,nt,o;if(!u||u.hasChild?u=this._row():u.hasChild=!0,e.measure){for(nt={className:u.allCell?"k-grid-footer":""},u.children.push(r("td",nt,[this._content(w[0],n)])),u.rowSpan=s,o=1;o<s;o++)this._row([r("td",nt,[this._content(w[o],n)])]);return u}if(p[k+e.name]=u,a=i.stringify(tt(n,t)),f=this.metadata[a],f||(this.metadata[a]=f=nr(v-1,t)),this._indexes.push({path:a,tuple:n}),e.hasChildren&&(f.expanded===!1&&(s=0,f.children=0),d={className:"k-icon "+(s?ut:ct)},d[i.attr("path")]=a,g.push(r("span",d))),g.push(this._content(e,n)),l=r("td",{className:u.allCell&&!s?"k-grid-footer":""},g),l.levelNum=v,u.children.push(l),u.colSpan["dim"+t]=l,(!this[b]||this[b]<v)&&(this[b]=v),s){for(u.allCell=!1,u.hasChild=!1,o=0;o<s;o++)y=this._buildRows(w[o],t),u!==y&&(u.rowSpan+=y.rowSpan);u.rowSpan>1&&(l.attr.rowSpan=u.rowSpan);f.children=u.rowSpan;c=r("td",{className:"k-grid-footer"},[this._content(e,n)]);c.levelNum=v;h=this._row([c]);h.colSpan["dim"+t]=c;h.allCell=!0;p[k+e.name+"all"]=h;rt&&(y=this._buildRows(n,t+1),c.attr.rowSpan=y.rowSpan);u.rowSpan+=h.rowSpan;f.members=h.rowSpan}else rt&&(u.hasChild=!1,this._buildRows(n,t+1),(c||l).attr.rowSpan=u.rowSpan,f.members=u.rowSpan);return f.maxChildren<f.children&&(f.maxChildren=f.children),f.maxMembers<f.members&&(f.maxMembers=f.members),u}}),yu=w.extend({init:function(){this.columnAxis={};this.rowAxis={}},build:function(n,i,u){var e=i.indexes[0],f=i.metadata[e?e.path:t],o,s;return this.columnAxis=i,this.rowAxis=u,this.data=n,this.rowLength=f?f.maxChildren+f.maxMembers:i.measures.length||1,this.rowLength||(this.rowLength=1),o=this._tbody(),s=this._colGroup(),[r("table",null,[s,o])]},_colGroup:function(){var n=this.columnAxis.measures.length||1,t=[],i=0;for(this.rows[0]&&(n=this.rows[0].children.length);i<n;i++)t.push(r("col",null));return r("colgroup",null,t)},_tbody:function(){return this.rows=[],this.data[0]?(this.columnIndexes=this._indexes(this.columnAxis),this.rowIndexes=this._indexes(this.rowAxis),this._buildRows()):this.rows.push(r("tr",null,[r("td",null,[p("&nbsp;")])])),r("tbody",null,this.rows)},_indexes:function(n){var f=[],e,v=n.indexes,p=n.metadata,o=n.measures,s=o.length||1,r,h=0,c=0,l=0,y=v.length,i,u,a;if(!y){for(i=0;i<s;i++)f[i]={index:i,measure:o[i],tuple:null};return f}for(;l<y;l++){if(e=v[l],r=p[e.path],u=r.children+r.members,a=0,u&&(u-=s),r.expanded===!1&&r.children!==r.maxChildren&&(a=r.maxChildren),r.parentMember&&r.levelNum===0&&(u=-1),u>-1){for(i=0;i<s;i++)f[u+c+i]={children:u,index:h,measure:o[i],tuple:e.tuple},h+=1;while(f[c]!==t)c+=1}h+=a}return f},_buildRows:function(){for(var t=this.rowIndexes,i=t.length,n=0;n<i;n++)this.rows.push(this._buildRow(t[n]))},_buildRow:function(n){for(var l=n.index*this.rowLength,h=this.columnIndexes,a=h.length,f,c=[],o=0,e,t,i,s,u;o<a;o++)f=h[o],i={},f.children&&(i.className="k-alt"),t="",s=this.data[l+f.index],u=f.measure||n.measure,e={columnTuple:f.tuple,rowTuple:n.tuple,measure:u,dataItem:s},s.value!==""&&u&&u.type&&(u.type==="status"?t=this.kpiStatusTemplate(e):u.type==="trend"&&(t=this.kpiTrendTemplate(e))),t||(t=this.dataTemplate(e)),c.push(r("td",i,[p(t)]));return i={},n.children&&(i.className="k-grid-footer"),r("tr",i,c)}});st.plugin(lu)}(window.kendo.jQuery),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});
//# sourceMappingURL=kendo.pivotgrid.min.js.map
