(function(n,t){t(["./kendo.core","./kendo.data"],n)})(function(){return function(n,t){t.ExcelExporter=t.Class.extend({init:function(i){i.columns=this._trimColumns(i.columns||[]);this.columns=n.map(this._leafColumns(i.columns||[]),this._prepareColumn);this.options=i;var r=i.dataSource;this.dataSource=r instanceof t.data.DataSource?new r.constructor(n.extend({},r.options,{page:i.allPages?0:r.page(),filter:r.filter(),pageSize:i.allPages?r.total():r.pageSize(),sort:r.sort(),group:r.group(),aggregate:r.aggregate()})):t.data.DataSource.create(r);r instanceof t.data.TreeListDataSource&&this.dataSource.data(r.view().toJSON())},_trimColumns:function(t){var i=this;return n.grep(t,function(n){var t=!(!n.field||n.hidden);return!t&&n.columns&&(t=i._trimColumns(n.columns).length>0),t})},_leafColumns:function(n){for(var i=[],t=0;t<n.length;t++){if(!n[t].columns){i.push(n[t]);continue}i=i.concat(this._leafColumns(n[t].columns))}return i},workbook:function(){var t=this.dataSource.fetch();return t.then(n.proxy(function(){return{sheets:[{columns:this._columns(),rows:this._rows(),freezePane:this._freezePane(),filter:this._filter()}]}},this))},_prepareColumn:function(i){if(i.field&&!i.hidden)return n.extend({},i,{groupHeaderTemplate:t.template(i.groupHeaderTemplate||"${title}: ${value}"),groupFooterTemplate:i.groupFooterTemplate?t.template(i.groupFooterTemplate):null,footerTemplate:i.footerTemplate?t.template(i.footerTemplate):null})},_filter:function(){if(!this.options.filterable)return null;var n=this._depth();return{from:n,to:n+this.columns.length-1}},_dataRows:function(t,i){var r=this._depth();return n.map(t,n.proxy(function(t){var f,e,o;if(this._hierarchical()&&(i=this.dataSource.level(t)+1),f=n.map(new Array(i),function(){return{background:"#dfdfdf",color:"#333"}}),r&&t.items){var u=n.grep(this.columns,function(n){return n.field==t.field})[0],s=u&&u.title?u.title:t.field,h=u?u.groupHeaderTemplate:null,c=s+": "+t.value,l=n.extend({title:s,field:t.field,value:t.value,aggregates:t.aggregates},t.aggregates[t.field]);return h&&(c=h(l)),f.push({value:c,background:"#dfdfdf",color:"#333",colSpan:this.columns.length+r-i}),e=this._dataRows(t.items,i+1),e.unshift({type:"group-header",cells:f}),e.concat(this._footer(t,i+1))}return o=n.map(this.columns,n.proxy(this._cell,this,t)),this._hierarchical()&&(o[0].colSpan=r-i+1),{type:"data",cells:f.concat(o)}},this))},_footer:function(t,i){var r=[],u=!1,f=n.map(this.columns,function(n){return n.groupFooterTemplate?(u=!0,{background:"#dfdfdf",color:"#333",value:n.groupFooterTemplate(t.aggregates[n.field])}):{background:"#dfdfdf",color:"#333"}});return u&&r.push({type:"group-footer",cells:n.map(new Array(i),function(){return{background:"#dfdfdf",color:"#333"}}).concat(f)}),r},_isColumnVisible:function(n){return this._visibleColumns([n]).length>0&&(n.field||n.columns)},_visibleColumns:function(t){var i=this;return n.grep(t,function(n){var t=!n.hidden;return t&&n.columns&&(t=i._visibleColumns(n.columns).length>0),t})},_headerRow:function(t,i){var r=n.map(t.cells,function(n){return{background:"#7a7a7a",color:"#fff",value:n.title,colSpan:n.colSpan>1?n.colSpan:1,rowSpan:t.rowSpan>1&&!n.colSpan?t.rowSpan:1}});return this._hierarchical()&&(r[0].colSpan=this._depth()+1),{type:"header",cells:n.map(new Array(i.length),function(){return{background:"#7a7a7a",color:"#fff"}}).concat(r)}},_prependHeaderRows:function(n){var r=this.dataSource.group(),i=[{rowSpan:1,cells:[],index:0}],t;for(this._prepareHeaderRows(i,this.options.columns),t=i.length-1;t>=0;t--)n.unshift(this._headerRow(i[t],r))},_prepareHeaderRows:function(n,t,i,r){for(var e=r||n[n.length-1],o=n[e.index+1],h=0,u,f,s=0;s<t.length;s++)u=t[s],this._isColumnVisible(u)&&(f={title:u.title||u.field,colSpan:0},e.cells.push(f),u.columns&&u.columns.length&&(o||(o={rowSpan:0,cells:[],index:n.length},n.push(o)),f.colSpan=this._trimColumns(this._visibleColumns(u.columns)).length,this._prepareHeaderRows(n,u.columns,f,o),h+=f.colSpan-1,e.rowSpan=n.length-e.index));i&&(i.colSpan+=h)},_rows:function(){var u=this.dataSource.group(),t=this._dataRows(this.dataSource.view(),0),i,r;return this.columns.length&&(this._prependHeaderRows(t),i=!1,r=n.map(this.columns,n.proxy(function(n){return n.footerTemplate?(i=!0,{background:"#dfdfdf",color:"#333",value:n.footerTemplate(this.dataSource.aggregates()[n.field])}):{background:"#dfdfdf",color:"#333"}},this)),i&&t.push({type:"footer",cells:n.map(new Array(u.length),function(){return{background:"#dfdfdf",color:"#333"}}).concat(r)})),t},_headerDepth:function(n){for(var r,i=0,t=0;t<n.length;t++)n[t].columns&&(r=this._headerDepth(n[t].columns),r>i&&(i=r));return 1+i},_freezePane:function(){var t=this._visibleColumns(this.options.columns||[]),i=this._trimColumns(this._leafColumns(n.grep(t,function(n){return n.locked}))).length;return{rowSplit:this._headerDepth(t),colSplit:i?i+this.dataSource.group().length:0}},_cell:function(n,t){if(t.field)return{value:n.get(t.field)}},_hierarchical:function(){return this.options.hierarchy&&this.dataSource.level},_depth:function(){var i=this.dataSource,n=0,r,t,u;if(this._hierarchical()){for(r=i.view(),t=0;t<r.length;t++)u=i.level(r[t]),u>n&&(n=u);n++}else n=i.group().length;return n},_columns:function(){var t=this._depth(),i=n.map(new Array(t),function(){return{width:20}});return i.concat(n.map(this.columns,function(n){return{width:parseInt(n.width,10),autoWidth:n.width?!1:!0}}))}});t.ExcelMixin={extend:function(t){t.events.push("preExcelExport");t.events.push("postExcelExport");t.events.push("excelExport");t.options.excel=n.extend(t.options.excel,this.options);t.saveAsExcel=this.saveAsExcel},options:{proxyURL:"",allPages:!1,filterable:!1,fileName:"Export.xlsx"},saveAsExcel:function(){var i=this.options.excel||{},r=this,u;r.trigger("preExcelExport",r)||(u=new t.ExcelExporter({columns:this.columns,dataSource:this.dataSource,allPages:i.allPages,filterable:i.filterable,hierarchy:i.hierarchy}),u.workbook().then(n.proxy(function(n){if(!this.trigger("excelExport",{workbook:n})){var u=new t.ooxml.Workbook(n);t.saveAs({dataURI:u.toDataURL(),fileName:n.fileName||i.fileName,proxyURL:i.proxyURL,forceProxy:i.forceProxy});r.trigger("postExcelExport",r)}},this)))}}}(kendo.jQuery,kendo),window.kendo},typeof define=="function"&&define.amd?define:function(n,t){t()});
//# sourceMappingURL=kendo.excel.min.js.map
