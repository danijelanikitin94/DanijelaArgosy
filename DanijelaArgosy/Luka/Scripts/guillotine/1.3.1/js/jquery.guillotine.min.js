(function(){"use strict";var n,s,u,h,i,f,c,e,t,r,l,a,v,o=function(n,t){return function(){return n.apply(t,arguments)}},y=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};n=jQuery;t="guillotine";r="guillotine";i={start:"touchstart."+r+" mousedown."+r,move:"touchmove."+r+" mousemove."+r,stop:"touchend."+r+" mouseup."+r};h={width:400,height:300,zoomStep:.1,init:null,eventOnChange:null,onChange:null};l=/touch/i;e=function(n){return l.test(n.type)};a=function(n){return e(n)?n.originalEvent.changedTouches.length===1:n.which===1};f=function(n){return e(n)&&(n=n.originalEvent.touches[0]),{x:n.pageX,y:n.pageY}};u=function(){var e,n,o,s,h,t,i,r,f,c;for(e=!1,s=["webkit","Moz","O","ms","Khtml"],i={transform:"transform"},f=0,c=s.length;f<c;f++)o=s[f],i[o+"Transform"]="-"+o.toLowerCase()+"-transform";n=document.createElement("img");document.body.insertBefore(n,null);for(t in i)if((h=i[t],n.style[t]!==void 0)&&(n.style[t]="rotate(90deg)",r=window.getComputedStyle(n).getPropertyValue(h),r!=null&&r.length&&r!=="none")){e=!0;break}return document.body.removeChild(n),u=e?function(){return!0}:function(){return!1},u()};c=function(t){return n(t).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})};s=function(){function r(r,u){this._drag=o(this._drag,this);this._unbind=o(this._unbind,this);this._start=o(this._start,this);this.op=n.extend(!0,{},h,u,n(r).data(t));this.enabled=!0;this.zoomInFactor=1+this.op.zoomStep;this.zoomOutFactor=1/this.zoomInFactor;this.glltRatio=this.op.height/this.op.width;this.width=this.height=this.left=this.top=this.angle=0;this.data={scale:1,angle:0,x:0,y:0,w:this.op.width,h:this.op.height};this._wrap(r);this.op.init!=null&&this._init();(this.width<1||this.height<1)&&this._fit()&&this._center();c(this.$el);this.$el.on(i.start,this._start)}return r.prototype._wrap=function(t){var r,i,u,f,o,e;return i=n(t),t.tagName==="IMG"?t.naturalWidth?(e=t.naturalWidth,f=t.naturalHeight):(i.addClass("guillotine-sample"),e=i.width(),f=i.height(),i.removeClass("guillotine-sample")):(e=i.width(),f=i.height()),this.width=e/this.op.width,this.height=f/this.op.height,r=n("<div>").addClass("guillotine-canvas"),r.css({width:this.width*100+"%",height:this.height*100+"%",top:0,left:0}),r=i.wrap(r).parent(),o=this.op.height/this.op.width*100+"%",u=n("<div>").addClass("guillotine-window"),u.css({width:"100%",height:"auto","padding-top":o}),u=r.wrap(u).parent(),this.$el=i,this.el=i[0],this.$canvas=r,this.canvas=r[0],this.$gllt=u,this.gllt=u[0],this.$document=n(t.ownerDocument),this.$body=n("body",this.$document)},r.prototype._unwrap=function(){return this.$el.removeAttr("style"),this.$el.insertBefore(this.gllt),this.$gllt.remove()},r.prototype._init=function(){var t,n,i;return n=this.op.init,(i=parseFloat(n.scale))&&this._zoom(i),(t=parseInt(n.angle))&&this._rotate(t),this._offset(parseInt(n.x)/this.op.width||0,parseInt(n.y)/this.op.height||0)},r.prototype._start=function(n){if((this.enabled&&a(n)))return n.preventDefault(),n.stopImmediatePropagation(),this.p=f(n),this._bind()},r.prototype._bind=function(){this.$body.addClass("guillotine-dragging");this.$document.on(i.move,this._drag);return this.$document.on(i.stop,this._unbind)},r.prototype._unbind=function(n){return this.$body.removeClass("guillotine-dragging"),this.$document.off(i.move,this._drag),this.$document.off(i.stop,this._unbind),n!=null?this._trigger("drag"):void 0},r.prototype._trigger=function(n){return this.op.eventOnChange!=null&&this.$el.trigger(this.op.eventOnChange,[this.data,n]),typeof this.op.onChange=="function"?this.op.onChange.call(this.el,this.data,n):void 0},r.prototype._drag=function(n){var i,r,u,t,e;return n.preventDefault(),n.stopImmediatePropagation(),t=f(n),i=t.x-this.p.x,r=t.y-this.p.y,this.p=t,u=i===0?null:this.left-i/this.gllt.clientWidth,e=r===0?null:this.top-r/this.gllt.clientHeight,this._offset(u,e)},r.prototype._offset=function(n,t){return(n||n===0)&&(n<0&&(n=0),n>this.width-1&&(n=this.width-1),this.canvas.style.left=(-n*100).toFixed(2)+"%",this.left=n,this.data.x=Math.round(n*this.op.width)),t||t===0?(t<0&&(t=0),t>this.height-1&&(t=this.height-1),this.canvas.style.top=(-t*100).toFixed(2)+"%",this.top=t,this.data.y=Math.round(t*this.op.height)):void 0},r.prototype._zoom=function(n){var i,r,u,t;if(!(n<=0)&&n!==1)return t=this.width,i=this.height,t*n>1&&i*n>1?(this.width*=n,this.height*=n,this.canvas.style.width=(this.width*100).toFixed(2)+"%",this.canvas.style.height=(this.height*100).toFixed(2)+"%",this.data.scale*=n):(this._fit(),n=this.width/t),r=(this.left+.5)*n-.5,u=(this.top+.5)*n-.5,this._offset(r,u)},r.prototype._fit=function(){var t,n;return t=this.width,n=this.height/this.width,n>1?(this.width=1,this.height=n):(this.width=1/n,this.height=1),this.canvas.style.width=(this.width*100).toFixed(2)+"%",this.canvas.style.height=(this.height*100).toFixed(2)+"%",this.data.scale*=this.width/t},r.prototype._center=function(){return this._offset((this.width-1)/2,(this.height-1)/2)},r.prototype._rotate=function(n){var f,t,i,r,e,o,s;if(u())return(n!==0&&n%90==0)?(this.angle=(this.angle+n)%360,this.angle<0&&(this.angle=360+this.angle),n%180!=0&&(t=this.op.height/this.op.width,e=[this.height*t,this.width/t],this.width=e[0],this.height=e[1],this.width>=1&&this.height>=1?(this.canvas.style.width=this.width*100+"%",this.canvas.style.height=this.height*100+"%"):this._fit()),o=[1,1],r=o[0],i=o[1],this.angle%180!=0&&(f=this.height/this.width*t,s=[f,1/f],r=s[0],i=s[1]),this.el.style.width=r*100+"%",this.el.style.height=i*100+"%",this.el.style.left=(1-r)*50+"%",this.el.style.top=(1-i)*50+"%",this.$el.css({transform:"rotate("+this.angle+"deg)"}),this._center(),this.data.angle=this.angle):void 0},r.prototype.rotateLeft=function(){return this.enabled&&(this._rotate(-90),this._trigger("rotateLeft"))},r.prototype.rotateRight=function(){return this.enabled&&(this._rotate(90),this._trigger("rotateRight"))},r.prototype.center=function(){return this.enabled&&(this._center(),this._trigger("center"))},r.prototype.fit=function(){return this.enabled&&(this._fit(),this._center(),this._trigger("fit"))},r.prototype.zoomIn=function(){return this.enabled&&(this._zoom(this.zoomInFactor),this._trigger("zoomIn"))},r.prototype.zoomOut=function(){return this.enabled&&(this._zoom(this.zoomOutFactor),this._trigger("zoomOut"))},r.prototype.getData=function(){return this.data},r.prototype.enable=function(){return this.enabled=!0},r.prototype.disable=function(){return this.enabled=!1},r.prototype.remove=function(){return this._unbind(),this._unwrap(),this.disable(),this.$el.off(i.start,this._start),this.$el.removeData(t+"Instance")},r}();v=["rotateLeft","rotateRight","center","fit","zoomIn","zoomOut","instance","getData","enable","disable","remove"];n.fn[t]=function(i){return typeof i!="string"?this.each(function(){var r;if(!n.data(this,t+"Instance"))return r=new s(this,i),n.data(this,t+"Instance",r)}):y.call(v,i)>=0?i==="instance"?n.data(this[0],t+"Instance"):i==="getData"?n.data(this[0],t+"Instance")[i]():this.each(function(){var r;return r=n.data(this,t+"Instance"),r?r[i]():void 0}):void 0}}).call(this);
//# sourceMappingURL=jquery.guillotine.min.js.map
